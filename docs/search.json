[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Biomedical competition 2025",
    "section": "",
    "text": "Acknowledgements\nWe extend our heartfelt thanks to Dr. Mu He for his invaluable guidance and for facilitating our communication with the Tigermed team. His support has been instrumental in providing us with the opportunity to learn and engage in meaningful discussions. Additionally, we are deeply appreciative of the consistent and well-processed data provided by Tigermed, which has been crucial for our analysis Besides, thanks to our hard work and enthusiasm about biomedical statistics"
  },
  {
    "objectID": "mainCode.html",
    "href": "mainCode.html",
    "title": "Tigermed-data-about-depression-clinical-trial",
    "section": "",
    "text": "# 将SITEID分为5组\nlibrary(dplyr)\n\n\nAttaching package: 'dplyr'\n\n\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n\n\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n\nlibrary(dplyr)\nlibrary(compareGroups)\nlibrary(readxl)\ndata0 &lt;- read_excel(\"/Users/luyu/Desktop/3.xlsx\")\n\n# 将SITEID转换为数值型变量\ndata0 &lt;- data0 %&gt;%\n  mutate(SITEID_num = as.numeric(factor(SITEID)))\n\n# 使用ntile函数分组\ndata0 &lt;- data0 %&gt;%\n  mutate(SITEID_group = paste0(\"Group\", ntile(SITEID_num, 5)))\n\n\ndata0$SITEID_group &lt;- as.factor(data0$SITEID_group)\n\n\n\ndata0$madrsc &lt;- ifelse(data0$BASE &gt; 40, \"MADRS SCORE ≥ 40\",\" MADRS SCORE &lt; 40\")\n\ndata0$TRT01A &lt;- as.factor(data0$TRT01A)\ndata0$TRT01A &lt;- relevel(data0$TRT01A, ref = \"Dummy A\")\ndata0$SEX &lt;- as.factor(data0$SEX)\ndata0$RACE &lt;- as.factor(data0$RACE)\ndata0$RACE &lt;- relevel(data0$RACE, ref = \"WHITE\")\n\n\n\n# 选择变量并创建表格\ndata_table1 &lt;- data0 %&gt;%\n  select(madrsc, AGE, SEX, RACE, TRT01A, PCHG, CHG, BASE, AVAL,SITEID_group )\n\n# 检查变量类型\nstr(data_table1)\n\ntibble [3,243 × 10] (S3: tbl_df/tbl/data.frame)\n $ madrsc      : chr [1:3243] \"MADRS SCORE ≥ 40\" \"MADRS SCORE ≥ 40\" \"MADRS SCORE ≥ 40\" \"MADRS SCORE ≥ 40\" ...\n $ AGE         : num [1:3243] 37 37 37 37 37 37 37 53 53 53 ...\n $ SEX         : Factor w/ 2 levels \"F\",\"M\": 1 1 1 1 1 1 1 1 1 1 ...\n $ RACE        : Factor w/ 8 levels \"WHITE\",\"AMERICAN INDIAN OR ALASKA NATIVE\",..: 1 1 1 1 1 1 1 1 1 1 ...\n $ TRT01A      : Factor w/ 3 levels \"Dummy A\",\"Dummy B\",..: 1 1 1 1 1 1 1 2 2 2 ...\n $ PCHG        : num [1:3243] NA -19.57 -8.7 -6.52 -8.7 ...\n $ CHG         : num [1:3243] NA -9 -4 -3 -4 -3 -3 NA -17 -10 ...\n $ BASE        : num [1:3243] 46 46 46 46 46 46 46 35 35 35 ...\n $ AVAL        : num [1:3243] 46 37 42 43 42 43 43 35 18 25 ...\n $ SITEID_group: Factor w/ 5 levels \"Group1\",\"Group2\",..: 1 1 1 1 1 1 1 1 1 1 ...\n\n# 检查样本量\ntable(data_table1$madrsc)\n\n\n MADRS SCORE &lt; 40  MADRS SCORE ≥ 40 \n             2525               716 \n\n# 创建比较表格\ntable1 &lt;- compareGroups(madrsc~., data = data_table1)\n\nWarning: glm.fit: algorithm did not converge\n\n\nWarning: glm.fit: fitted probabilities numerically 0 or 1 occurred\n\n# 如果仍然出现警告，可以尝试使用其他方法来处理变量的尺度差异\n# 或者检查数据是否存在数据分离问题等\ntable1 &lt;- createTable(table1, show.all = TRUE, hide.no = \"no\",\n                      show.p.overall=TRUE)\ntable1\n\n\n--------Summary descriptives table by 'madrsc'---------\n\n________________________________________________________________________________________________________ \n                                                  [ALL]      MADRS SCORE &lt; 40 MADRS SCORE ≥ 40 p.overall \n                                                 N=3241          N=2525            N=716                 \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ \nAGE                                            45.2 (14.0)     45.5 (14.5)      44.4 (12.3)      0.045   \nSEX:                                                                                             0.006   \n    F                                         1928 (59.5%)    1470 (58.2%)      458 (64.0%)              \n    M                                         1313 (40.5%)    1055 (41.8%)      258 (36.0%)              \nRACE:                                                                                              .     \n    WHITE                                     2788 (86.0%)    2177 (86.2%)      611 (85.3%)              \n    AMERICAN INDIAN OR ALASKA NATIVE            6 (0.19%)       6 (0.24%)        0 (0.00%)               \n    ASIAN                                      97 (2.99%)      83 (3.29%)        14 (1.96%)              \n    BLACK OR AFRICAN AMERICAN                  241 (7.44%)     185 (7.33%)       56 (7.82%)              \n    MULTIPLE                                   60 (1.85%)      46 (1.82%)        14 (1.96%)              \n    NATIVE HAWAIIAN OR OTHER PACIFIC ISLANDER  14 (0.43%)       7 (0.28%)        7 (0.98%)               \n    NOT REPORTED                               28 (0.86%)      21 (0.83%)        7 (0.98%)               \n    UNKNOWN                                     7 (0.22%)       0 (0.00%)        7 (0.98%)               \nTRT01A:                                                                                          0.429   \n    Dummy A                                   1610 (49.7%)    1252 (49.6%)      358 (50.0%)              \n    Dummy B                                    819 (25.3%)     650 (25.7%)      169 (23.6%)              \n    Dummy C                                    812 (25.1%)     623 (24.7%)      189 (26.4%)              \nPCHG                                          -24.64 (29.4)   -24.71 (29.8)    -24.39 (27.9)     0.802   \nCHG                                           -8.82 (10.4)    -8.31 (9.82)     -10.61 (12.2)    &lt;0.001   \nBASE                                           35.4 (6.36)     33.1 (5.09)      43.6 (2.26)      0.000   \nAVAL                                           27.9 (11.1)     26.0 (10.0)      34.5 (12.1)     &lt;0.001   \nSITEID_group:                                                                                   &lt;0.001   \n    Group1                                     649 (20.0%)     486 (19.2%)      163 (22.8%)              \n    Group2                                     649 (20.0%)     516 (20.4%)      133 (18.6%)              \n    Group3                                     647 (20.0%)     430 (17.0%)      217 (30.3%)              \n    Group4                                     648 (20.0%)     552 (21.9%)       96 (13.4%)              \n    Group5                                     648 (20.0%)     541 (21.4%)      107 (14.9%)              \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ \n\nsummary(table1)\n\n\n\n\n---Available data----\n\n_________________________________________________________________________________________ \n             [ALL]  MADRS SCORE &lt; 40 MADRS SCORE ≥ 40      method       select Fact OR/HR \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ \nAGE          3241        2525              716        continuous-normal  ALL       1      \nSEX          3241        2525              716           categorical     ALL       --     \nRACE         3241        2525              716           categorical     ALL       --     \nTRT01A       3241        2525              716           categorical     ALL       --     \nPCHG         2765        2153              612        continuous-normal  ALL       1      \nCHG          2765        2153              612        continuous-normal  ALL       1      \nBASE         3241        2525              716        continuous-normal  ALL       1      \nAVAL         3241        2525              716        continuous-normal  ALL       1      \nSITEID_group 3241        2525              716           categorical     ALL       --     \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ \n\n?compareGroups\n\n\nlibrary(dplyr)\nlibrary(compareGroups)\ndata0 &lt;- read_excel(\"/Users/luyu/Desktop/3.xlsx\")\n\ndata0$madrsc &lt;- ifelse(data0$BASE &gt; 40, \"MADRS SCORE ≥ 40\",\" MADRS SCORE &lt; 40\")\n\ndata0$AGE &lt;- scale(data0$AGE)\ndata0$AVAL &lt;- scale(data0$AVAL)\ndata0$BASE &lt;- scale(data0$BASE)\ndata0$TRT01A &lt;- as.factor(data0$TRT01A)\ndata0$TRT01A &lt;- relevel(data0$TRT01A, ref = \"Dummy A\")\ndata0$SEX &lt;- as.factor(data0$SEX)\ndata0$RACE &lt;- as.factor(data0$RACE)\ndata0$RACE &lt;- relevel(data0$RACE, ref = \"WHITE\")\n\n\ndata0$PCHG &lt;- scale(data0$PCHG)\n\ndata_table1 &lt;- data0 %&gt;%\n  select(madrsc, AGE, SEX, RACE, TRT01A, PCHG, CHG, BASE, AVAL)\n\ntable1 &lt;- compareGroups(madrsc~., data = data_table1)\n\nWarning: glm.fit: algorithm did not converge\n\n\nWarning: glm.fit: fitted probabilities numerically 0 or 1 occurred\n\ntable1 &lt;- createTable(table1, show.all = TRUE, hide.no = \"no\",\n                      show.p.overall=TRUE)\ntable1\n\n\n--------Summary descriptives table by 'madrsc'---------\n\n_______________________________________________________________________________________________________ \n                                                 [ALL]      MADRS SCORE &lt; 40 MADRS SCORE ≥ 40 p.overall \n                                                 N=3241         N=2525            N=716                 \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ \nAGE                                           0.00 (1.00)     0.02 (1.03)      -0.06 (0.88)     0.045   \nSEX:                                                                                            0.006   \n    F                                         1928 (59.5%)   1470 (58.2%)      458 (64.0%)              \n    M                                         1313 (40.5%)   1055 (41.8%)      258 (36.0%)              \nRACE:                                                                                             .     \n    WHITE                                     2788 (86.0%)   2177 (86.2%)      611 (85.3%)              \n    AMERICAN INDIAN OR ALASKA NATIVE           6 (0.19%)       6 (0.24%)        0 (0.00%)               \n    ASIAN                                      97 (2.99%)     83 (3.29%)        14 (1.96%)              \n    BLACK OR AFRICAN AMERICAN                 241 (7.44%)     185 (7.33%)       56 (7.82%)              \n    MULTIPLE                                   60 (1.85%)     46 (1.82%)        14 (1.96%)              \n    NATIVE HAWAIIAN OR OTHER PACIFIC ISLANDER  14 (0.43%)      7 (0.28%)        7 (0.98%)               \n    NOT REPORTED                               28 (0.86%)     21 (0.83%)        7 (0.98%)               \n    UNKNOWN                                    7 (0.22%)       0 (0.00%)        7 (0.98%)               \nTRT01A:                                                                                         0.429   \n    Dummy A                                   1610 (49.7%)   1252 (49.6%)      358 (50.0%)              \n    Dummy B                                   819 (25.3%)     650 (25.7%)      169 (23.6%)              \n    Dummy C                                   812 (25.1%)     623 (24.7%)      189 (26.4%)              \nPCHG                                          0.00 (1.00)     0.00 (1.01)      0.01 (0.95)      0.802   \nCHG                                           -8.82 (10.4)   -8.31 (9.82)     -10.61 (12.2)    &lt;0.001   \nBASE                                          0.00 (1.00)    -0.37 (0.80)      1.29 (0.36)      0.000   \nAVAL                                          0.00 (1.00)    -0.17 (0.90)      0.60 (1.09)     &lt;0.001   \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ \n\nsummary(table1)\n\n\n\n\n---Available data----\n\n___________________________________________________________________________________ \n       [ALL]  MADRS SCORE &lt; 40 MADRS SCORE ≥ 40      method       select Fact OR/HR \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ \nAGE    3241        2525              716        continuous-normal  ALL       1      \nSEX    3241        2525              716           categorical     ALL       --     \nRACE   3241        2525              716           categorical     ALL       --     \nTRT01A 3241        2525              716           categorical     ALL       --     \nPCHG   2765        2153              612        continuous-normal  ALL       1      \nCHG    2765        2153              612        continuous-normal  ALL       1      \nBASE   3241        2525              716        continuous-normal  ALL       1      \nAVAL   3241        2525              716        continuous-normal  ALL       1      \n¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯"
  },
  {
    "objectID": "mainCode.html#to-24-young-adults",
    "href": "mainCode.html#to-24-young-adults",
    "title": "Tigermed-data-about-depression-clinical-trial",
    "section": "≥18 to 24 young adults",
    "text": "≥18 to 24 young adults\n# 加载必要的包\nlibrary(readxl)\nlibrary(mmrm)\nlibrary(ggplot2)\n\n?mmrm\n# 读取数据\nadmadrs &lt;- read_excel(\"/Users/qiujiahui/Desktop/≥18 to 24 young adults.xlsx\", \n                      sheet = \"Sheet1\", col_names = TRUE, \n                      col_types = NULL, na = \"\", skip = 0)\nhead(admadrs)\n\n# 删除重复的时间点\nadmadrs &lt;- admadrs[!duplicated(admadrs[c(\"USUBJID\", \"AVISIT\")]), ]\n\n# 将相关列转换为因子\nadmadrs$USUBJID &lt;- factor(admadrs$USUBJID)\nadmadrs$AVISITN &lt;- factor(admadrs$AVISITN)\nadmadrs$ADY &lt;- as.factor(admadrs$ADY)\nadmadrs$SITEID &lt;- as.factor(admadrs$SITEID)\nadmadrs$TRTSEQA &lt;- as.factor(admadrs$TRTSEQA)\nadmadrs$BASE &lt;- as.numeric(admadrs$BASE)\n\n# 将 TRT01A 转换为因子，并重新编码参考水平\nadmadrs$TRT01A &lt;- as.factor(admadrs$TRT01A)\nadmadrs$TRT01A &lt;- relevel(admadrs$TRT01A, ref = \"Dummy A\")\n\n#admadrs$AVISITN &lt;- relevel(admadrs$AVISITN, ref = \"\")\n\n# 对数值型变量进行归一化处理\n\n\nstr(admadrs$BASE)\n\n# 拟合模型\nfit &lt;- mmrm(\n  formula = AVAL ~ AVISITN:TRT01A + TRT01A+ SEX + RACE + SITEID  + us(AVISITN | USUBJID),\n  data = admadrs\n)\n\n# 查看模型结果\nmodel_summary &lt;- summary(fit)\nprint(model_summary)"
  },
  {
    "objectID": "mainCode.html#to-24-young-adults-分析",
    "href": "mainCode.html#to-24-young-adults-分析",
    "title": "Tigermed-data-about-depression-clinical-trial",
    "section": "≥18 to 24 young adults 分析",
    "text": "≥18 to 24 young adults 分析\n\n# 加载必要的包\nlibrary(emmeans)\nlibrary(ggplot2)\nlibrary(dplyr)\n\n############## 年龄组分析 ##############\ncat(\"\\n### 年龄组分析 ###\\n\")\n\n# 重新计算边际均值\nemm_young &lt;- emmeans(fit, ~ AVISITN | TRT01A)\nprint(emm_young)\n\n# 基线和时间点设置\nbaseline_level &lt;- \"0\"  # 假设基线是0，请调整为实际值\n\n# 获取AVISITN的水平\navisitn_levels &lt;- levels(admadrs$AVISITN)\ntime_points &lt;- avisitn_levels[avisitn_levels != baseline_level]\n\n# 如果AVISITN是数值而不是因子\nif(length(avisitn_levels) == 0) {\n  cat(\"AVISITN似乎不是因子或没有水平，尝试获取唯一值...\\n\")\n  avisitn_values &lt;- sort(unique(admadrs$AVISITN))\n  avisitn_values &lt;- as.character(avisitn_values)\n  baseline_level &lt;- as.character(min(as.numeric(avisitn_values)))\n  time_points &lt;- avisitn_values[avisitn_values != baseline_level]\n}\n\ncat(\"基线:\", baseline_level, \"\\n\")\ncat(\"比较时间点:\", time_points, \"\\n\")\n\n# 执行对比分析\ntryCatch({\n  # 对每个治疗组，计算各时间点与基线的对比\n  comparisons_young &lt;- contrast(emm_young, method = \"revpairwise\", by = \"TRT01A\")\n  cat(\"\\n年轻成人组的时间点比较:\\n\")\n  print(comparisons_young)\n  \n  # 保存结果\n  results_young &lt;- as.data.frame(comparisons_young)\n  results_young$AgeGroup &lt;- \"Young Adults (18-24)\"\n  \n}, error = function(e) {\n  cat(\"年轻成人组的对比分析出错:\", conditionMessage(e), \"\\n\")\n  results_young &lt;- data.frame()\n})"
  },
  {
    "objectID": "mainCode.html#middle-aged-adults-24-to-55-years",
    "href": "mainCode.html#middle-aged-adults-24-to-55-years",
    "title": "Tigermed-data-about-depression-clinical-trial",
    "section": "middle-aged adults (≥24 to 55 years)",
    "text": "middle-aged adults (≥24 to 55 years)\n# 加载必要的包\nlibrary(readxl)\nlibrary(mmrm)\nlibrary(ggplot2)\n\n?mmrm\n# 读取数据\nadmadrs &lt;- read_excel(\"/Users/qiujiahui/Desktop/≥24 to 55 middle-aged adults.xlsx\", \n                      sheet = \"Sheet1\", col_names = TRUE, \n                      col_types = NULL, na = \"\", skip = 0)\nhead(admadrs)\n\n# 删除重复的时间点\nadmadrs &lt;- admadrs[!duplicated(admadrs[c(\"USUBJID\", \"AVISIT\")]), ]\n\n# 将相关列转换为因子\nadmadrs$USUBJID &lt;- factor(admadrs$USUBJID)\nadmadrs$AVISITN &lt;- factor(admadrs$AVISITN)\nadmadrs$ADY &lt;- as.factor(admadrs$ADY)\nadmadrs$SITEID &lt;- as.factor(admadrs$SITEID)\nadmadrs$TRTSEQA &lt;- as.factor(admadrs$TRTSEQA)\nadmadrs$BASE &lt;- as.numeric(admadrs$BASE)\n\n# 将 TRT01A 转换为因子，并重新编码参考水平\nadmadrs$TRT01A &lt;- as.factor(admadrs$TRT01A)\nadmadrs$TRT01A &lt;- relevel(admadrs$TRT01A, ref = \"Dummy A\")\n\n#admadrs$AVISITN &lt;- relevel(admadrs$AVISITN, ref = \"\")\n\n# 对数值型变量进行归一化处理\n\n\nstr(admadrs$BASE)\n\n# 拟合模型\nfit &lt;- mmrm(\n  formula = AVAL ~ AVISITN:TRT01A + TRT01A+ SEX + RACE + SITEID  + us(AVISITN | USUBJID),\n  data = admadrs\n)\n\n# 查看模型结果\nmodel_summary &lt;- summary(fit)\nprint(model_summary)"
  },
  {
    "objectID": "mainCode.html#middle-aged-adults-24-to-55-years分析",
    "href": "mainCode.html#middle-aged-adults-24-to-55-years分析",
    "title": "Tigermed-data-about-depression-clinical-trial",
    "section": "middle-aged adults (≥24 to 55 years)分析",
    "text": "middle-aged adults (≥24 to 55 years)分析\n\n############## 中年成人分析 ##############\n# 读取中年成人数据并拟合模型\n# (假设这里已经完成)\n\ncat(\"\\n### 中年成人组分析 ###\\n\")\n\n# 重新计算边际均值\nemm_middle &lt;- emmeans(fit, ~ AVISITN | TRT01A)\nprint(emm_middle)\n\n# 执行对比分析\ntryCatch({\n  # 对每个治疗组，计算各时间点与基线的对比\n  comparisons_middle &lt;- contrast(emm_middle, method = \"revpairwise\", by = \"TRT01A\")\n  cat(\"\\n中年成人组的时间点比较:\\n\")\n  print(comparisons_middle)\n  \n  # 保存结果\n  results_middle &lt;- as.data.frame(comparisons_middle)\n  results_middle$AgeGroup &lt;- \"Middle-Aged Adults (24-55)\"\n  \n}, error = function(e) {\n  cat(\"中年成人组的对比分析出错:\", conditionMessage(e), \"\\n\")\n  results_middle &lt;- data.frame()\n})"
  },
  {
    "objectID": "mainCode.html#older-adults",
    "href": "mainCode.html#older-adults",
    "title": "Tigermed-data-about-depression-clinical-trial",
    "section": "≥55 older adults",
    "text": "≥55 older adults\n# 加载必要的包\nlibrary(readxl)\nlibrary(mmrm)\nlibrary(ggplot2)\n\n?mmrm\n# 读取数据\nadmadrs &lt;- read_excel(\"/Users/qiujiahui/Desktop/≥55 older adults.xlsx\", \n                      sheet = \"Sheet1\", col_names = TRUE, \n                      col_types = NULL, na = \"\", skip = 0)\nhead(admadrs)\n\n# 删除重复的时间点\nadmadrs &lt;- admadrs[!duplicated(admadrs[c(\"USUBJID\", \"AVISIT\")]), ]\n\n# 将相关列转换为因子\nadmadrs$USUBJID &lt;- factor(admadrs$USUBJID)\nadmadrs$AVISITN &lt;- factor(admadrs$AVISITN)\nadmadrs$ADY &lt;- as.factor(admadrs$ADY)\nadmadrs$SITEID &lt;- as.factor(admadrs$SITEID)\nadmadrs$TRTSEQA &lt;- as.factor(admadrs$TRTSEQA)\nadmadrs$BASE &lt;- as.numeric(admadrs$BASE)\n\n# 将 TRT01A 转换为因子，并重新编码参考水平\nadmadrs$TRT01A &lt;- as.factor(admadrs$TRT01A)\nadmadrs$TRT01A &lt;- relevel(admadrs$TRT01A, ref = \"Dummy A\")\n\n#admadrs$AVISITN &lt;- relevel(admadrs$AVISITN, ref = \"\")\n\n# 对数值型变量进行归一化处理\n\n\nstr(admadrs$BASE)\n\n# 拟合模型\nfit &lt;- mmrm(\n  formula = AVAL ~ AVISITN:TRT01A + TRT01A+ SEX + RACE + SITEID  + us(AVISITN | USUBJID),\n  data = admadrs\n)\n\n# 查看模型结果\nmodel_summary &lt;- summary(fit)\nprint(model_summary)"
  },
  {
    "objectID": "mainCode.html#older-adults-分析",
    "href": "mainCode.html#older-adults-分析",
    "title": "Tigermed-data-about-depression-clinical-trial",
    "section": "≥55 older adults 分析",
    "text": "≥55 older adults 分析\n############## 老年成人分析 ##############\n# 读取老年成人数据并拟合模型\n# (假设这里已经完成)\n\ncat(\"\\n### 老年成人组分析 ###\\n\")\n\n# 重新计算边际均值\nemm_older &lt;- emmeans(fit, ~ AVISITN | TRT01A)\nprint(emm_older)\n\n# 执行对比分析\ntryCatch({\n  # 对每个治疗组，计算各时间点与基线的对比\n  comparisons_older &lt;- contrast(emm_older, method = \"revpairwise\", by = \"TRT01A\")\n  cat(\"\\n老年成人组的时间点比较:\\n\")\n  print(comparisons_older)\n  \n  # 保存结果\n  results_older &lt;- as.data.frame(comparisons_older)\n  results_older$AgeGroup &lt;- \"Older Adults (55+)\"\n  \n}, error = function(e) {\n  cat(\"老年成人组的对比分析出错:\", conditionMessage(e), \"\\n\")\n  results_older &lt;- data.frame()\n})"
  },
  {
    "objectID": "mainCode.html#年龄组疗效",
    "href": "mainCode.html#年龄组疗效",
    "title": "Tigermed-data-about-depression-clinical-trial",
    "section": "年龄组疗效",
    "text": "年龄组疗效\n############## 比较不同年龄组疗效差异 ##############\ncat(\"\\n### 比较不同年龄组疗效差异 ###\\n\")\n\n# 在合并数据之前确保AgeGroup标签正确\nresults_young$AgeGroup &lt;- \"Young Adults (18-24)\"\nresults_middle$AgeGroup &lt;- \"Middle-Aged Adults (24-55)\"\nresults_older$AgeGroup &lt;- \"Older Adults (55+)\"\n\n# 合并数据\ncombined_results &lt;- rbind(results_young, results_middle, results_older)\n\n# 提取对比信息，并简化时间点标签\ncombined_results$TimeComparison &lt;- gsub(\" - .*$\", \"\", combined_results$contrast)\n# 使用更简洁的时间点标签，例如T1, T2, T3...\ncombined_results$TimePoint &lt;- factor(combined_results$TimeComparison, \n                                    levels = unique(combined_results$TimeComparison),\n                                    labels = paste0(\"T\", seq_along(unique(combined_results$TimeComparison))))\n\n# 创建改进的交互图\np &lt;- ggplot(combined_results, aes(x = TimePoint, y = estimate, color = TRT01A, \n                               group = interaction(TRT01A, AgeGroup), \n                               linetype = AgeGroup)) +\n  geom_line() +\n  geom_point() +\n  geom_errorbar(aes(ymin = estimate - SE, ymax = estimate + SE), width = 0.2) +\n  facet_wrap(~ TRT01A) +\n  labs(title = \"Comparison of Treatment Effects Across Age Groups\",\n       subtitle = \"Changes compared to baseline\",\n       x = \"Time Point\",\n       y = \"Estimated Difference\",\n       color = \"Treatment Group\",\n       linetype = \"Age Group\") +\n  theme_minimal() +\n  # 改进x轴标签显示\n  theme(\n    axis.text.x = element_text(angle = 45, hjust = 1, size = 8),  # 倾斜标签并减小字体\n    legend.position = \"bottom\",  # 将图例放在底部\n    legend.box = \"vertical\"  # 垂直排列图例\n  )\n\n# 打印图表\nprint(p)\n\n# 添加时间点说明表格\ntime_point_table &lt;- data.frame(\n  TimePointLabel = paste0(\"T\", seq_along(unique(combined_results$TimeComparison))),\n  OriginalTimePoint = unique(combined_results$TimeComparison)\n)\n\n# 打印时间点对照表\ncat(\"\\nTime Point Reference Table:\\n\")\nprint(time_point_table)\n\n# 创建一个函数提取特定对比和治疗组的结果\nget_result &lt;- function(results_df, contrast_pattern, trt) {\n  subset(results_df, grepl(contrast_pattern, contrast) & TRT01A == trt)\n}\n\n# 定义要比较的对比模式（如0 vs 2, 0 vs 8等）\ncontrast_patterns &lt;- paste0(baseline_level, \" - \", time_points)\n\n# 创建数据框用于年龄组间比较\n# 年轻成人 vs 中年成人\nyoung_vs_middle_table &lt;- data.frame()\n# 年轻成人 vs 老年成人\nyoung_vs_older_table &lt;- data.frame()\n# 中年成人 vs 老年成人\nmiddle_vs_older_table &lt;- data.frame()\n\nfor(pattern in contrast_patterns) {\n  for(trt in unique(combined_results$TRT01A)) {\n    # 获取三个年龄组的结果\n    young_result &lt;- get_result(results_young, pattern, trt)\n    middle_result &lt;- get_result(results_middle, pattern, trt)\n    older_result &lt;- get_result(results_older, pattern, trt)\n    \n    # 年轻vs中年\n    if(nrow(young_result) &gt; 0 && nrow(middle_result) &gt; 0) {\n      diff_estimate &lt;- young_result$estimate - middle_result$estimate\n      diff_se &lt;- sqrt(young_result$SE^2 + middle_result$SE^2)\n      z_stat &lt;- diff_estimate / diff_se\n      p_value &lt;- 2 * (1 - pnorm(abs(z_stat)))\n      \n      young_vs_middle_table &lt;- rbind(young_vs_middle_table, data.frame(\n        Contrast = pattern,\n        TRT01A = trt,\n        Young_Est = young_result$estimate,\n        Young_SE = young_result$SE,\n        Middle_Est = middle_result$estimate,\n        Middle_SE = middle_result$SE,\n        Diff_Est = diff_estimate,\n        Diff_SE = diff_se,\n        Z_stat = z_stat,\n        P_value = p_value\n      ))\n    }\n    \n    # 年轻vs老年\n    if(nrow(young_result) &gt; 0 && nrow(older_result) &gt; 0) {\n      diff_estimate &lt;- young_result$estimate - older_result$estimate\n      diff_se &lt;- sqrt(young_result$SE^2 + older_result$SE^2)\n      z_stat &lt;- diff_estimate / diff_se\n      p_value &lt;- 2 * (1 - pnorm(abs(z_stat)))\n      \n      young_vs_older_table &lt;- rbind(young_vs_older_table, data.frame(\n        Contrast = pattern,\n        TRT01A = trt,\n        Young_Est = young_result$estimate,\n        Young_SE = young_result$SE,\n        Older_Est = older_result$estimate,\n        Older_SE = older_result$SE,\n        Diff_Est = diff_estimate,\n        Diff_SE = diff_se,\n        Z_stat = z_stat,\n        P_value = p_value\n      ))\n    }\n    \n    # 中年vs老年\n    if(nrow(middle_result) &gt; 0 && nrow(older_result) &gt; 0) {\n      diff_estimate &lt;- middle_result$estimate - older_result$estimate\n      diff_se &lt;- sqrt(middle_result$SE^2 + older_result$SE^2)\n      z_stat &lt;- diff_estimate / diff_se\n      p_value &lt;- 2 * (1 - pnorm(abs(z_stat)))\n      \n      middle_vs_older_table &lt;- rbind(middle_vs_older_table, data.frame(\n        Contrast = pattern,\n        TRT01A = trt,\n        Middle_Est = middle_result$estimate,\n        Middle_SE = middle_result$SE,\n        Older_Est = older_result$estimate,\n        Older_SE = older_result$SE,\n        Diff_Est = diff_estimate,\n        Diff_SE = diff_se,\n        Z_stat = z_stat,\n        P_value = p_value\n      ))\n    }\n  }\n}\n\n# 输出比较结果\ncat(\"\\n年轻成人 vs. 中年成人组疗效比较:\\n\")\nif(nrow(young_vs_middle_table) &gt; 0) {\n  print(young_vs_middle_table)\n} else {\n  cat(\"没有足够数据进行比较\\n\")\n}\n\ncat(\"\\n年轻成人 vs. 老年成人组疗效比较:\\n\")\nif(nrow(young_vs_older_table) &gt; 0) {\n  print(young_vs_older_table)\n} else {\n  cat(\"没有足够数据进行比较\\n\")\n}\n\ncat(\"\\n中年成人 vs. 老年成人组疗效比较:\\n\")\nif(nrow(middle_vs_older_table) &gt; 0) {\n  print(middle_vs_older_table)\n} else {\n  cat(\"没有足够数据进行比较\\n\")\n}\n\n# 添加显著性标记到图表\n# 创建一个数据框，包含所有显著差异的p值&lt;0.05的结果\nsignificant_diffs &lt;- rbind(\n  subset(young_vs_middle_table, P_value &lt; 0.05),\n  subset(young_vs_older_table, P_value &lt; 0.05),\n  subset(middle_vs_older_table, P_value &lt; 0.05)\n)\n\nif(nrow(significant_diffs) &gt; 0) {\n  cat(\"\\n显著性差异总结 (p &lt; 0.05):\\n\")\n  print(significant_diffs)\n}\n# 创建年龄组显著性热图\nif(nrow(young_vs_middle_table) &gt; 0 && nrow(young_vs_older_table) &gt; 0 && nrow(middle_vs_older_table) &gt; 0) {\n  # 准备热图数据\n  heatmap_data &lt;- NULL\n  \n  # 处理各组间比较的p值\n  for(trt in unique(combined_results$TRT01A)) {\n    for(pattern in contrast_patterns) {\n      # 提取各组比较的p值\n      y_m_row &lt;- subset(young_vs_middle_table, Contrast == pattern & TRT01A == trt)\n      y_o_row &lt;- subset(young_vs_older_table, Contrast == pattern & TRT01A == trt)\n      m_o_row &lt;- subset(middle_vs_older_table, Contrast == pattern & TRT01A == trt)\n      \n      if(nrow(y_m_row) &gt; 0 && nrow(y_o_row) &gt; 0 && nrow(m_o_row) &gt; 0) {\n        new_row &lt;- data.frame(\n          TimePoint = pattern,\n          Treatment = trt,\n          Young_vs_Middle_p = y_m_row$P_value,\n          Young_vs_Older_p = y_o_row$P_value,\n          Middle_vs_Older_p = m_o_row$P_value\n        )\n        heatmap_data &lt;- rbind(heatmap_data, new_row)\n      }\n    }\n  }\n  \n  if(!is.null(heatmap_data)) {\n    # 创建长格式数据用于热图\n    heatmap_long &lt;- tidyr::pivot_longer(\n      heatmap_data, \n      cols = c(Young_vs_Middle_p, Young_vs_Older_p, Middle_vs_Older_p),\n      names_to = \"Comparison\", \n      values_to = \"P_Value\"\n    )\n    \n    # 生成热图\n    p_heatmap &lt;- ggplot(heatmap_long, aes(x = TimePoint, y = Comparison, fill = -log10(P_Value))) +\n      geom_tile() +\n      scale_fill_gradient(low = \"white\", high = \"red\") +\n      facet_wrap(~ Treatment) +\n      labs(\n        title = \"Statistical Significance of Age Group Differences\",\n        subtitle = \"-log10(p-value): higher values = more significant\",\n        x = \"Time Point\", \n        y = \"Group Comparison\",\n        fill = \"-log10(p)\"\n      ) +\n      theme_minimal() +\n      theme(axis.text.x = element_text(angle = 45, hjust = 1))\n    \n    print(p_heatmap)\n  }\n}\n\n# 创建各年龄组在各治疗组的治疗效应折线图\n# 将结果按年龄组和治疗方案分组\nage_group_effects &lt;- ggplot(combined_results, \n                           aes(x = TimePoint, y = estimate, \n                               group = AgeGroup, color = AgeGroup)) +\n  geom_line() +\n  geom_point() +\n  geom_errorbar(aes(ymin = estimate - SE, ymax = estimate + SE), width = 0.2) +\n  facet_wrap(~ TRT01A) +\n  labs(title = \"Treatment Effects by Age Group\",\n       x = \"Time Point\", \n       y = \"Estimated Effect\",\n       color = \"Age Group\") +\n  theme_minimal() +\n  theme(legend.position = \"bottom\")\n\nprint(age_group_effects)\n\n# 总结分析\ncat(\"\\n## 年龄组治疗效应总结分析\\n\")\ncat(\"1. 基于以上分析，我们可以观察到不同年龄组对治疗的反应存在以下差异：\\n\")\n\n# 检查是否有显著差异\nif(exists(\"significant_diffs\") && nrow(significant_diffs) &gt; 0) {\n  cat(\"   - 存在显著的年龄组间差异(p &lt; 0.05)，特别是在以下时间点和治疗组：\\n\")\n  for(i in 1:nrow(significant_diffs)) {\n    row &lt;- significant_diffs[i,]\n    cat(paste0(\"     * 时间点 \", row$Contrast, \"，治疗组 \", row$TRT01A, \n               \" (p = \", round(row$P_value, 4), \")\\n\"))\n  }\n} else {\n  cat(\"   - 在分析的时间点和治疗组中未发现显著的年龄组间差异\\n\")\n}\n\n# 药效学差异总结\ncat(\"\\n2. 药效学差异总结：\\n\")\ncat(\"   - young adults (18-24 years)：\\n\")\nyoung_effect &lt;- mean(subset(results_young, TRT01A != \"Dummy A\")$estimate)\ncat(paste0(\"     Mean therapeutic effect: \", round(young_effect, 2), \"\\n\"))\n\ncat(\"   - middle-aged adults (24-55 years)：\\n\")\nmiddle_effect &lt;- mean(subset(results_middle, TRT01A != \"Dummy A\")$estimate)\ncat(paste0(\"     Mean therapeutic effect: \", round(middle_effect, 2), \"\\n\"))\n\ncat(\"   - older adults (&gt;= 55 years)：\\n\")\nolder_effect &lt;- mean(subset(results_older, TRT01A != \"Dummy A\")$estimate)\ncat(paste0(\"     Mean therapeutic effect: \", round(older_effect, 2), \"\\n\"))\n\n# 整体结论\ncat(\"\\n3. 临床意义和建议：\\n\")\n# 比较三组平均效应\ngroups &lt;- c(\"年轻成人\", \"中年成人\", \"老年成人\")\neffects &lt;- c(young_effect, middle_effect, older_effect)\nbest_group_idx &lt;- which.max(abs(effects))\nlowest_group_idx &lt;- which.min(abs(effects))\n\ncat(paste0(\"   - \", groups[best_group_idx], \"组显示出最强的治疗反应\\n\"))\ncat(paste0(\"   - \", groups[lowest_group_idx], \"组显示出最弱的治疗反应\\n\"))\n\n# 最终建议\ncat(\"\\n4. 临床应用建议：\\n\")\ncat(\"   - 根据不同年龄组的反应差异，可能需要考虑针对特定年龄组调整治疗方案\\n\")\ncat(\"   - 特别关注对治疗反应较弱的年龄组，可能需要增加治疗强度或辅助治疗\\n\")\ncat(\"   - 应进一步研究年龄相关的药代动力学和药效学差异，以优化治疗策略\\n\")"
  },
  {
    "objectID": "mainCode.html#主要疗效分析day28",
    "href": "mainCode.html#主要疗效分析day28",
    "title": "Tigermed-data-about-depression-clinical-trial",
    "section": "主要疗效分析（Day28）",
    "text": "主要疗效分析（Day28）\n\nlibrary(emmeans)\n\nmmrm() registered as emmeans extension\n\n\nWelcome to emmeans.\nCaution: You lose important information if you filter this package's results.\nSee '? untidy'\n\nlibrary(readxl)\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(emmeans)\nlibrary(mmrm)\nlibrary(tidyr)\n\n\nAttaching package: 'tidyr'\n\n\nThe following object is masked _by_ '.GlobalEnv':\n\n    table1\n\nlibrary(viridis)\n\nLoading required package: viridisLite\n\nlibrary(grid)\nlibrary(gridExtra)\n\n\nAttaching package: 'gridExtra'\n\n\nThe following object is masked from 'package:dplyr':\n\n    combine\n\n# 获取Day28的最小二乘均值\nemm_day28 &lt;- emmeans(\n  fit, \n  specs = ~ TRT01A | AVISITN,\n  at = list(AVISITN = \"28\") # \"28\"是AVISITN中Day28对应的水平（减20000后）\n)\n\n# 治疗组与安慰剂对比\ncontrast_specs &lt;- list(\n  \"Esk56_vs_Placebo\" = c(-1, 1, 0),\n  \"Esk84_vs_Placebo\" = c(-1, 0, 1)\n)\n\ncontrast_results &lt;- contrast(\n  emm_day28,\n  method = contrast_specs,\n  adjust = \"none\"\n) %&gt;% \n  summary(infer = TRUE) # 包含置信区间和p值\n\n# 显示对比结果\nprint(contrast_results)\n\nAVISITN = 28:\n contrast         estimate     SE  df lower.CL upper.CL t.ratio p.value\n Esk56_vs_Placebo   -0.841 0.0992 651   -1.036   -0.647  -8.482  &lt;.0001\n Esk84_vs_Placebo   -0.798 0.0791 596   -0.954   -0.643 -10.098  &lt;.0001\n\nResults are averaged over the levels of: SEX, SITEID, RACE, base_situation \nConfidence level used: 0.95"
  },
  {
    "objectID": "mainCode.html#疗效趋势可视化及森林图",
    "href": "mainCode.html#疗效趋势可视化及森林图",
    "title": "Tigermed-data-about-depression-clinical-trial",
    "section": "疗效趋势可视化及森林图",
    "text": "疗效趋势可视化及森林图\n\nlibrary(ggplot2)\n# 获取各时间点预测值\n#admadrs$AVISITN &lt;- droplevels(admadrs$AVISITN)\nemm_trend &lt;- emmeans(\n  fit,\n  specs = ~ TRT01A | AVISITN, \n  at = list(AVISITN = levels(admadrs$AVISITN)),# 使用所有时间点\n  nuisance = \"RACE\") %&gt;% # 将RACE设为无关因素保证行数不超过10000\n  summary()\n\n# 绘制疗效趋势图\n(p_trend &lt;- ggplot(emm_trend, aes(x = AVISITN, y = emmean, \n                                 color = TRT01A, group = TRT01A)) +\n  geom_line(linewidth = 1.2) +\n  geom_errorbar(aes(ymin = lower.CL, ymax = upper.CL), \n                width = 0.2, \n                position = position_dodge(0.1)) +\n  geom_point(size = 3) +\n  scale_color_viridis(discrete = TRUE, \n                     labels = c(\"Placebo\", \"56mg\", \"84mg\")) +\n  labs(\n    title = \"Treatment Effect Over Time\",\n    x = \"Study Visit (Day)\", \n    y = \"Adjusted Mean Change from Baseline (LS Means)\", \n    color = \"Treatment Group\"\n  ) +\n  theme_minimal() +\n  theme(\n    legend.position = \"top\",\n    plot.title = element_text(hjust = 0.5, face = \"bold\"),\n    axis.text.x = element_text(angle = 45, hjust = 1)\n  ))\n\n\n\n\n\n\n\n# 绘制森林图\ncontrast_df &lt;- as.data.frame(contrast_results)\ncontrast_df$Comparison &lt;- rownames(contrast_df)\n\n(p_forest &lt;- ggplot(contrast_df, \n                   aes(x = estimate, y = Comparison, \n                       xmin = lower.CL, xmax = upper.CL)) +\n  geom_vline(xintercept = 0, linetype = \"dashed\", color = \"grey50\") +\n  geom_errorbarh(height = 0.2) +\n  geom_point(size = 3, color = \"#440154\") +\n  scale_y_discrete(labels = c(\"56mg vs Placebo\", \"84mg vs Placebo\")) +\n  labs(\n    title = \"Treatment Comparisons at Day 28\",\n    x = \"Treatment Difference (95% CI)\", \n    y = \"\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(hjust = 0.5, face = \"bold\"),\n    panel.grid.major.y = element_blank()\n  ))\n\n\n\n\n\n\n\n# 组合图形\ngrid.arrange(p_trend, p_forest, ncol = 1, heights = c(2, 1))\n\n\n\n\n\n\n\n# 保存图形（PDF格式）\nggsave(\"treatment_analysis.pdf\", \n       arrangeGrob(p_trend, p_forest, ncol = 1), \n       width = 10, height = 8)\n\n# 保存统计结果\nwrite.csv(contrast_results, \"treatment_contrasts.csv\", row.names = FALSE)"
  },
  {
    "objectID": "mainCode.html#治疗组vs安慰剂的估计边际均值和差异计算及可视化",
    "href": "mainCode.html#治疗组vs安慰剂的估计边际均值和差异计算及可视化",
    "title": "Tigermed-data-about-depression-clinical-trial",
    "section": "治疗组vs安慰剂的估计边际均值和差异计算及可视化",
    "text": "治疗组vs安慰剂的估计边际均值和差异计算及可视化\n\n# 将Day 28对应的AVISITN水平赋值\nday28_level &lt;- \"28\" \n\n# 计算Day 28时的估计边际均值\nem_day28 &lt;- emmeans(fit, ~ TRT01A | AVISITN, at = list(AVISITN = day28_level))\nprint(em_day28)\n\nAVISITN = 28:\n TRT01A  emmean    SE   df lower.CL upper.CL\n Dummy A -0.266 0.129  798   -0.519  -0.0126\n Dummy B -1.107 0.157 1000   -1.416  -0.7989\n Dummy C -1.064 0.147  979   -1.352  -0.7764\n\nResults are averaged over the levels of: SEX, SITEID, RACE, base_situation \nConfidence level used: 0.95 \n\n# 计算治疗组vs安慰剂在Day28时的差异\ncontrasts_day28 &lt;- contrast(em_day28, method = \"trt.vs.ctrl\", ref = 1)\nprint(contrasts_day28)\n\nAVISITN = 28:\n contrast          estimate     SE  df t.ratio p.value\n Dummy B - Dummy A   -0.841 0.0992 651  -8.482  &lt;.0001\n Dummy C - Dummy A   -0.798 0.0791 596 -10.098  &lt;.0001\n\nResults are averaged over the levels of: SEX, SITEID, RACE, base_situation \nP value adjustment: dunnettx method for 2 tests \n\n# 计算所有时间点的估计边际均值\nem_all &lt;- emmeans(fit, ~ TRT01A | AVISITN, nuisance = \"RACE\")\nprint(em_all)\n\nAVISITN = 0:\n TRT01A  emmean    SE   df lower.CL upper.CL\n Dummy A  0.304 0.103  416   0.1020   0.5053\n Dummy B  0.305 0.105  417   0.0994   0.5113\n Dummy C  0.353 0.106  417   0.1445   0.5616\n\nAVISITN = 2:\n TRT01A  emmean    SE   df lower.CL upper.CL\n Dummy A -0.703 0.117  634  -0.9325  -0.4728\n Dummy B -1.396 0.149  883  -1.6881  -1.1032\n Dummy C -1.237 0.147  992  -1.5249  -0.9488\n\nAVISITN = 8:\n TRT01A  emmean    SE   df lower.CL upper.CL\n Dummy A -0.631 0.132  823  -0.8899  -0.3720\n Dummy B -1.327 0.155 1028  -1.6310  -1.0222\n Dummy C -1.404 0.150 1035  -1.6972  -1.1103\n\nAVISITN = 15:\n TRT01A  emmean    SE   df lower.CL upper.CL\n Dummy A -0.677 0.132  829  -0.9371  -0.4176\n Dummy B -1.419 0.160 1049  -1.7321  -1.1051\n Dummy C -1.467 0.184  763  -1.8276  -1.1055\n\nAVISITN = 22:\n TRT01A  emmean    SE   df lower.CL upper.CL\n Dummy A -0.347 0.116  614  -0.5746  -0.1202\n Dummy B -1.188 0.152  884  -1.4870  -0.8897\n Dummy C -0.993 0.150  982  -1.2870  -0.6987\n\nAVISITN = 28:\n TRT01A  emmean    SE   df lower.CL upper.CL\n Dummy A -0.266 0.129  798  -0.5193  -0.0126\n Dummy B -1.107 0.157 1000  -1.4157  -0.7989\n Dummy C -1.064 0.147  979  -1.3520  -0.7764\n\nAVISITN = 999:\n TRT01A  emmean    SE   df lower.CL upper.CL\n Dummy A -0.413 0.130  805  -0.6673  -0.1587\n Dummy B -1.114 0.157  980  -1.4215  -0.8068\n Dummy C -1.214 0.184  758  -1.5761  -0.8519\n\nResults are averaged over the levels of: 1 nuisance factors, SEX, SITEID, base_situation \nConfidence level used: 0.95 \n\n# 各组在各时间点的均值比较\ncontrasts_all &lt;- contrast(em_all, method = \"trt.vs.ctrl\", ref = 1)\nprint(contrasts_all)\n\nAVISITN = 0:\n contrast          estimate     SE  df t.ratio p.value\n Dummy B - Dummy A  0.00171 0.0411 415   0.042  0.9972\n Dummy C - Dummy A  0.04943 0.0418 416   1.183  0.3944\n\nAVISITN = 2:\n contrast          estimate     SE  df t.ratio p.value\n Dummy B - Dummy A -0.69297 0.0748 588  -9.270  &lt;.0001\n Dummy C - Dummy A -0.53418 0.0923 670  -5.788  &lt;.0001\n\nAVISITN = 8:\n contrast          estimate     SE  df t.ratio p.value\n Dummy B - Dummy A -0.69563 0.0926 668  -7.511  &lt;.0001\n Dummy C - Dummy A -0.77280 0.0796 596  -9.714  &lt;.0001\n\nAVISITN = 15:\n contrast          estimate     SE  df t.ratio p.value\n Dummy B - Dummy A -0.74127 0.0962 509  -7.705  &lt;.0001\n Dummy C - Dummy A -0.78919 0.0970 516  -8.134  &lt;.0001\n\nAVISITN = 22:\n contrast          estimate     SE  df t.ratio p.value\n Dummy B - Dummy A -0.84093 0.0788 590 -10.675  &lt;.0001\n Dummy C - Dummy A -0.64546 0.0991 657  -6.515  &lt;.0001\n\nAVISITN = 28:\n contrast          estimate     SE  df t.ratio p.value\n Dummy B - Dummy A -0.84138 0.0992 651  -8.482  &lt;.0001\n Dummy C - Dummy A -0.79832 0.0791 596 -10.098  &lt;.0001\n\nAVISITN = 999:\n contrast          estimate     SE  df t.ratio p.value\n Dummy B - Dummy A -0.70119 0.0947 512  -7.401  &lt;.0001\n Dummy C - Dummy A -0.80107 0.0953 515  -8.406  &lt;.0001\n\nResults are averaged over the levels of: 1 nuisance factors, SEX, SITEID, base_situation \nP value adjustment: dunnettx method for 2 tests \n\n# 将结果转换为数据框以便绘图\nem_all_df &lt;- as.data.frame(em_all)\n\n# 创建一个时间轴变量，将AVISITN转换为数值以便绘图\nem_all_df$Time &lt;- as.numeric(as.character(em_all_df$AVISITN))\n\n# 绘制各治疗组随时间的MADRS变化趋势图\nggplot(em_all_df, aes(x = AVISITN, y = emmean, color = TRT01A, group = TRT01A)) +\n  geom_line(linewidth = 1) +\n  geom_point(size = 3) +\n  geom_errorbar(aes(ymin = emmean - SE, ymax = emmean + SE), width = 0.2) +\n  labs(\n    title = \"Change from Baseline in MADRS Total Score Over Time\",\n    x = \"Day\",\n    y = \"Estimated Mean Change from Baseline\",\n    color = \"Treatment Group\"\n  ) +\n  scale_color_viridis(discrete = TRUE, option = \"D\", \n                      labels = c(\"Placebo\", \"Esketamine 56 mg\", \"Esketamine 84 mg\")) +\n  theme_minimal() +\n  theme(\n    legend.position = \"bottom\",\n    panel.grid.minor = element_blank(),\n    axis.title = element_text(face = \"bold\"),\n    plot.title = element_text(hjust = 0.5, face = \"bold\")\n  )\n\n\n\n\n\n\n\n# 保存图片\nggsave(\"MADRS_change_over_time.png\", width = 10, height = 6, dpi = 300)\n\n# 创建Day 28时的柱状图比较\nday28_df &lt;- subset(em_all_df, AVISITN == day28_level)\n\n# 将各组在各时间点的均值比较结果转换为数据框以便绘图\ncontrasts_day28_df &lt;- as.data.frame(contrasts_day28)\n\n# 绘制Day 28时的柱状图\np1 &lt;- ggplot(day28_df, aes(x = TRT01A, y = emmean, fill = TRT01A)) +\n  geom_bar(stat = \"identity\", width = 0.7) +\n  geom_errorbar(aes(ymin = emmean - SE, ymax = emmean + SE), width = 0.2) +\n  labs(\n    title = \"Change from Baseline in MADRS Total Score at Day 28\",\n    x = \"Treatment Group\",\n    y = \"Estimated Mean Change from Baseline\",\n    fill = \"Treatment Group\"\n  ) +\n  scale_fill_viridis(discrete = TRUE, option = \"D\",\n                    labels = c(\"Placebo\", \"Esketamine 56 mg\", \"Esketamine 84 mg\")) +\n  theme_minimal() +\n  theme(\n    legend.position = \"none\",\n    axis.title = element_text(face = \"bold\"),\n    plot.title = element_text(hjust = 0.5, face = \"bold\")\n  )\n\n# 绘制治疗组vs安慰剂的差异图\np2 &lt;- ggplot(contrasts_day28_df, aes(x = contrast, y = estimate, fill = contrast)) +\n  geom_bar(stat = \"identity\", width = 0.7) +\n  geom_errorbar(aes(ymin = estimate - SE, ymax = estimate + SE), width = 0.2) +\n  labs(\n    title = \"Treatment Effect vs Placebo at Day 28\",\n    x = \"Contrast\",\n    y = \"Estimated Difference\",\n    fill = \"Contrast\"\n  ) +\n  scale_fill_viridis(discrete = TRUE, option = \"E\") +\n  theme_minimal() +\n  theme(\n    legend.position = \"none\",\n    axis.title = element_text(face = \"bold\"),\n    plot.title = element_text(hjust = 0.5, face = \"bold\")\n  ) +\n  geom_hline(yintercept = 0, linetype = \"dashed\", color = \"red\")\n\n# 将两个图组合在一起\ncombined_plot &lt;- grid.arrange(p1, p2, ncol = 2)\n\n\n\n\n\n\n\n# 保存组合图\nggsave(\"Day28_treatment_effect.png\", combined_plot, width = 12, height = 6, dpi = 300)\n\n# 创建森林图展示各时间点的治疗效果\ncontrasts_all_df &lt;- as.data.frame(contrasts_all)\ncontrasts_all_df$Time &lt;- as.numeric(as.character(contrasts_all_df$AVISITN))\n\n# 森林图\nggplot(contrasts_all_df, aes(x = AVISITN , y = estimate, color = contrast)) +\n  geom_point(size = 3) +\n  geom_errorbar(aes(ymin = estimate - SE*1.96, ymax = estimate + SE*1.96), width = 0.2) +\n  geom_line(aes(group = contrast), linewidth = 1) +\n  geom_hline(yintercept = 0, linetype = \"dashed\", color = \"red\") +\n  facet_wrap(~ contrast, ncol = 1) +\n  labs(\n    title = \"Treatment Effect vs Placebo Over Time\",\n    x = \"Day\",\n    y = \"Estimated Difference vs Placebo\",\n    color = \"Treatment Group\"\n  ) +\n  scale_color_viridis(discrete = TRUE, option = \"D\") +\n  theme_minimal() +\n  theme(\n    legend.position = \"none\",\n    strip.background = element_rect(fill = \"lightgrey\"),\n    strip.text = element_text(face = \"bold\"),\n    axis.title = element_text(face = \"bold\"),\n    plot.title = element_text(hjust = 0.5, face = \"bold\")\n  )\n\n\n\n\n\n\n\n# 保存森林图\nggsave(\"Treatment_effect_forest_plot.png\", width = 10, height = 8, dpi = 300)\n\n# 创建热图展示p值\n# 提取所有时间点的p值\np_values &lt;- contrasts_all_df\np_values$sig &lt;- ifelse(p_values$p.value &lt; 0.001, \"***\",\n                      ifelse(p_values$p.value &lt; 0.01, \"**\",\n                            ifelse(p_values$p.value &lt; 0.05, \"*\", \"ns\")))\n\n# 处理热图所需数据\np_values_wide &lt;- p_values %&gt;%\n  select(AVISITN, contrast, p.value) %&gt;%\n  pivot_wider(names_from = contrast, values_from = p.value)\n\n# 绘制p值热图\np_values_long &lt;- p_values %&gt;%\n  select(Time, contrast, p.value, sig)\n\nggplot(p_values_long, aes(x = factor(Time), y = contrast, fill = -log10(p.value))) +\n  geom_tile(color = \"white\") +\n  geom_text(aes(label = sig), color = \"white\", size = 5) +\n  scale_fill_viridis(option = \"C\", name = \"-log10(p-value)\") +\n  labs(\n    title = \"Statistical Significance of Treatment Effect vs Placebo\",\n    x = \"Day\",\n    y = \"Treatment Group\",\n    caption = \"* p&lt;0.05, ** p&lt;0.01, *** p&lt;0.001, ns: not significant\"\n  ) +\n  theme_minimal() +\n  theme(\n    axis.title = element_text(face = \"bold\"),\n    plot.title = element_text(hjust = 0.5, face = \"bold\"),\n    legend.position = \"right\"\n  )\n\n\n\n\n\n\n\n# 保存热图\nggsave(\"Treatment_significance_heatmap.png\", width = 10, height = 6, dpi = 300)\n\n# 模型诊断图\n# 提取残差\nresiduals &lt;- residuals(fit)\nfitted_values &lt;- fitted(fit)\n\n# 创建诊断数据框\ndiag_df &lt;- data.frame(\n  Fitted = fitted_values,\n  Residuals = residuals\n)\n\n# 绘制残差图\np3 &lt;- ggplot(diag_df, aes(x = Fitted, y = Residuals)) +\n  geom_point(alpha = 0.5) +\n  geom_hline(yintercept = 0, linetype = \"dashed\", color = \"red\") +\n  geom_smooth(method = \"loess\", se = FALSE, color = \"blue\") +\n  labs(\n    title = \"Residuals vs Fitted Values\",\n    x = \"Fitted Values\",\n    y = \"Residuals\"\n  ) +\n  theme_minimal() +\n  theme(\n    axis.title = element_text(face = \"bold\"),\n    plot.title = element_text(hjust = 0.5, face = \"bold\")\n  )\n\n# 绘制残差的QQ图\np4 &lt;- ggplot(diag_df, aes(sample = Residuals)) +\n  stat_qq() +\n  stat_qq_line() +\n  labs(\n    title = \"Normal Q-Q Plot of Residuals\",\n    x = \"Theoretical Quantiles\",\n    y = \"Sample Quantiles\"\n  ) +\n  theme_minimal() +\n  theme(\n    axis.title = element_text(face = \"bold\"),\n    plot.title = element_text(hjust = 0.5, face = \"bold\")\n  )\n\n# 组合诊断图\ndiag_plot &lt;- grid.arrange(p3, p4, ncol = 2)\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\n\n\n\n\n\n\n# 保存诊断图\nggsave(\"Model_diagnostics.png\", diag_plot, width = 12, height = 6, dpi = 300)"
  },
  {
    "objectID": "mainCode.html#数据可视化有图例和解释",
    "href": "mainCode.html#数据可视化有图例和解释",
    "title": "Tigermed-data-about-depression-clinical-trial",
    "section": "数据可视化（有图例和解释）",
    "text": "数据可视化（有图例和解释）\n\n# 各治疗组随时间的MADRS变化趋势图\n\n# 输出emmeans结果数据\nem_all_df\n\nAVISITN = 0:\n TRT01A      emmean        SE      df   lower.CL   upper.CL Time\n Dummy A  0.3036347 0.1025859  415.71  0.1019829  0.5052865    0\n Dummy B  0.3053490 0.1047895  416.57  0.0993668  0.5113311    0\n Dummy C  0.3530675 0.1061115  416.77  0.1444871  0.5616480    0\n\nAVISITN = 2:\n TRT01A      emmean        SE      df   lower.CL   upper.CL Time\n Dummy A -0.7026543 0.1170686  634.38 -0.9325430 -0.4727655    2\n Dummy B -1.3956254 0.1489953  883.30 -1.6880515 -1.1031993    2\n Dummy C -1.2368376 0.1467976  992.47 -1.5249070 -0.9487683    2\n\nAVISITN = 8:\n TRT01A      emmean        SE      df   lower.CL   upper.CL Time\n Dummy A -0.6309696 0.1319135  823.38 -0.8898959 -0.3720433    8\n Dummy B -1.3266031 0.1551385 1028.50 -1.6310271 -1.0221791    8\n Dummy C -1.4037658 0.1495618 1035.19 -1.6972447 -1.1102869    8\n\nAVISITN = 15:\n TRT01A      emmean        SE      df   lower.CL   upper.CL Time\n Dummy A -0.6773596 0.1323395  828.55 -0.9371198 -0.4175994   15\n Dummy B -1.4186303 0.1597666 1049.01 -1.7321288 -1.1051319   15\n Dummy C -1.4665458 0.1839236  762.97 -1.8276022 -1.1054894   15\n\nAVISITN = 22:\n TRT01A      emmean        SE      df   lower.CL   upper.CL Time\n Dummy A -0.3473856 0.1156954  613.79 -0.5745923 -0.1201788   22\n Dummy B -1.1883160 0.1521635  884.23 -1.4869597 -0.8896723   22\n Dummy C -0.9928504 0.1499149  981.72 -1.2870410 -0.6986599   22\n\nAVISITN = 28:\n TRT01A      emmean        SE      df   lower.CL   upper.CL Time\n Dummy A -0.2659051 0.1290646  798.18 -0.5192512 -0.0125591   28\n Dummy B -1.1072886 0.1571637  999.66 -1.4156972 -0.7988800   28\n Dummy C -1.0642296 0.1466599  979.15 -1.3520335 -0.7764257   28\n\nAVISITN = 999:\n TRT01A      emmean        SE      df   lower.CL   upper.CL Time\n Dummy A -0.4129694 0.1295510  804.86 -0.6672671 -0.1586717  999\n Dummy B -1.1141616 0.1566069  980.15 -1.4214850 -0.8068383  999\n Dummy C -1.2140361 0.1844488  757.54 -1.5761277 -0.8519445  999\n\nResults are averaged over the levels of: 1 nuisance factors, SEX, SITEID, base_situation \nConfidence level used: 0.95 \n\n# 绘图\nggplot(em_all_df, aes(x = AVISITN, y = emmean, color = TRT01A, group = TRT01A)) +\n  geom_line(linewidth = 1) +\n  geom_point(size = 3) +\n  geom_errorbar(aes(ymin = emmean - SE, ymax = emmean + SE), width = 0.2) +\n  labs(\n    title = \"Change from Baseline in MADRS Total Score Over Time\",\n    subtitle = \"Mixed Model for Repeated Measures (MMRM) Analysis\",\n    x = \"Study Day\",\n    y = \"Estimated Mean Change from Baseline\",\n    color = \"Treatment Group\",\n    caption = \"Note: Error bars represent standard errors. Negative values indicate improvement in depressive symptoms.\"\n  ) +\n  scale_color_viridis(discrete = TRUE, option = \"D\", \n                      labels = c(\"Placebo\", \"Esketamine 56 mg\", \"Esketamine 84 mg\")) +\n  theme_minimal() +\n  theme(\n    legend.position = \"bottom\",\n    legend.background = element_rect(fill = \"white\", color = \"grey80\"),\n    legend.title = element_text(face = \"bold\"),\n    panel.grid.minor = element_blank(),\n    axis.title = element_text(face = \"bold\"),\n    plot.title = element_text(hjust = 0.5, face = \"bold\"),\n    plot.subtitle = element_text(hjust = 0.5),\n    plot.caption = element_text(hjust = 0, face = \"italic\")\n  ) +\n  # 添加解释文本\n  annotate(\"text\", x = min(as.numeric(as.character(em_all_df$AVISITN))) + 2, \n           y = min(em_all_df$emmean) * 0.8, \n           label = \"Lower values indicate greater\\nimprovement in depression\", \n           hjust = 0, size = 3.5, fontface = \"italic\")\n\n\n\n\n\n\n\n# 保存图片\nggsave(\"MADRS_change_over_time_with_legend.png\", width = 10, height = 6, dpi = 300)\n\n\n# 输出Day 28时的估计边际均值\nday28_df\n\n    TRT01A AVISITN     emmean        SE       df   lower.CL    upper.CL Time\n16 Dummy A      28 -0.2659051 0.1290646 798.1815 -0.5192512 -0.01255906   28\n17 Dummy B      28 -1.1072886 0.1571637 999.6623 -1.4156972 -0.79888004   28\n18 Dummy C      28 -1.0642296 0.1466599 979.1475 -1.3520335 -0.77642572   28\n\n# Day 28时的柱状图\np1 &lt;- ggplot(day28_df, aes(x = TRT01A, y = emmean, fill = TRT01A)) +\n  geom_bar(stat = \"identity\", width = 0.7, color = \"black\") +\n  geom_errorbar(aes(ymin = emmean - SE, ymax = emmean + SE), width = 0.2) +\n  labs(\n    title = \"Change from Baseline in MADRS Total Score at Day 28\",\n    subtitle = \"Estimated Marginal Means with Standard Errors\",\n    x = \"Treatment Group\",\n    y = \"Estimated Mean Change from Baseline\",\n    fill = \"Treatment Group\",\n    caption = \"Note: Error bars represent standard errors. Negative values indicate improvement in depressive symptoms.\"\n  ) +\n  scale_fill_viridis(discrete = TRUE, option = \"D\",\n                    labels = c(\"Placebo\", \"Esketamine 56 mg\", \"Esketamine 84 mg\")) +\n  theme_minimal() +\n  theme(\n    legend.position = \"bottom\",\n    legend.background = element_rect(fill = \"white\", color = \"grey80\"),\n    legend.title = element_text(face = \"bold\"),\n    axis.title = element_text(face = \"bold\"),\n    plot.title = element_text(hjust = 0.5, face = \"bold\"),\n    plot.subtitle = element_text(hjust = 0.5),\n    plot.caption = element_text(hjust = 0, face = \"italic\"),\n    axis.text.x = element_text(angle = 0, hjust = 0.5)\n  ) +\n  # 添加标签\n  geom_text(aes(label = sprintf(\"%.1f\", emmean)), position = position_dodge(width = 0.7), \n            vjust = -0.5, color = \"black\", fontface = \"bold\")\n\n\n# 输出绘图数据\ncontrasts_day28_df\n\nAVISITN = 28:\n contrast            estimate         SE     df t.ratio p.value\n Dummy B - Dummy A -0.8413835 0.09919806 650.97  -8.482  &lt;.0001\n Dummy C - Dummy A -0.7983245 0.07905644 595.89 -10.098  &lt;.0001\n\nResults are averaged over the levels of: SEX, SITEID, RACE, base_situation \nP value adjustment: dunnettx method for 2 tests \n\n# 绘制治疗组vs安慰剂的差异图\np2 &lt;- ggplot(contrasts_day28_df, aes(x = contrast, y = estimate, fill = contrast)) +\n  geom_bar(stat = \"identity\", width = 0.7, color = \"black\") +\n  geom_errorbar(aes(ymin = estimate - SE, ymax = estimate + SE), width = 0.2) +\n  labs(\n    title = \"Treatment Effect vs Placebo at Day 28\",\n    subtitle = \"Difference in Estimated Means with Standard Errors\",\n    x = \"Treatment Comparison\",\n    y = \"Estimated Difference vs Placebo\",\n    fill = \"Treatment Comparison\",\n    caption = \"Note: Values below zero favor active treatment over placebo.\\nRed dashed line represents no difference from placebo.\"\n  ) +\n  scale_fill_viridis(discrete = TRUE, option = \"E\",\n                    labels = c(\"Esketamine 56 mg vs Placebo\", \"Esketamine 84 mg vs Placebo\")) +\n  theme_minimal() +\n  theme(\n    legend.position = \"bottom\",\n    legend.background = element_rect(fill = \"white\", color = \"grey80\"),\n    legend.title = element_text(face = \"bold\"),\n    axis.title = element_text(face = \"bold\"),\n    plot.title = element_text(hjust = 0.5, face = \"bold\"),\n    plot.subtitle = element_text(hjust = 0.5),\n    plot.caption = element_text(hjust = 0, face = \"italic\"),\n    axis.text.x = element_text(angle = 45, hjust = 1)\n  ) +\n  geom_hline(yintercept = 0, linetype = \"dashed\", color = \"red\") +\n  # 添加p值和效应量标签\n  geom_text(aes(label = sprintf(\"Diff: %.1f\\np = %.3f\", estimate, p.value)), \n            position = position_dodge(width = 0.7), vjust = -0.8, size = 3.5)\n\n# 使用patchwork组合两个图\nlibrary(patchwork)\ncombined_plot &lt;- p1 + p2 + plot_layout(ncol = 2)\ncombined_plot &lt;- combined_plot + plot_annotation(\n  title = \"MADRS Score Change and Treatment Effect at Day 28\",\n  theme = theme(plot.title = element_text(hjust = 0.5, face = \"bold\", size = 16))\n)\n\n# 保存组合图\nggsave(\"Day28_treatment_effect_with_legend.png\", combined_plot, width = 12, height = 6, dpi = 300)\n\n# 输出绘图数据\ncontrasts_all_df\n\nAVISITN = 0:\n contrast            estimate         SE     df t.ratio p.value Time\n Dummy B - Dummy A  0.0017143 0.04113726 415.00   0.042  0.9972    0\n Dummy C - Dummy A  0.0494328 0.04177930 415.89   1.183  0.3944    0\n\nAVISITN = 2:\n contrast            estimate         SE     df t.ratio p.value Time\n Dummy B - Dummy A -0.6929711 0.07475349 588.39  -9.270  &lt;.0001    2\n Dummy C - Dummy A -0.5341834 0.09229578 670.43  -5.788  &lt;.0001    2\n\nAVISITN = 8:\n contrast            estimate         SE     df t.ratio p.value Time\n Dummy B - Dummy A -0.6956335 0.09261148 668.33  -7.511  &lt;.0001    8\n Dummy C - Dummy A -0.7727962 0.07955698 595.88  -9.714  &lt;.0001    8\n\nAVISITN = 15:\n contrast            estimate         SE     df t.ratio p.value Time\n Dummy B - Dummy A -0.7412707 0.09620677 508.54  -7.705  &lt;.0001   15\n Dummy C - Dummy A -0.7891862 0.09702519 515.94  -8.134  &lt;.0001   15\n\nAVISITN = 22:\n contrast            estimate         SE     df t.ratio p.value Time\n Dummy B - Dummy A -0.8409304 0.07877781 589.92 -10.675  &lt;.0001   22\n Dummy C - Dummy A -0.6454649 0.09907534 656.61  -6.515  &lt;.0001   22\n\nAVISITN = 28:\n contrast            estimate         SE     df t.ratio p.value Time\n Dummy B - Dummy A -0.8413835 0.09919806 650.97  -8.482  &lt;.0001   28\n Dummy C - Dummy A -0.7983245 0.07905644 595.89 -10.098  &lt;.0001   28\n\nAVISITN = 999:\n contrast            estimate         SE     df t.ratio p.value Time\n Dummy B - Dummy A -0.7011922 0.09474272 512.36  -7.401  &lt;.0001  999\n Dummy C - Dummy A -0.8010667 0.09530024 514.97  -8.406  &lt;.0001  999\n\nResults are averaged over the levels of: 1 nuisance factors, SEX, SITEID, base_situation \nP value adjustment: dunnettx method for 2 tests \n\n# 创建森林图展示各时间点的治疗效果\nggplot(contrasts_all_df, aes(x = AVISITN, y = estimate, color = contrast)) +\n  geom_point(size = 3) +\n  geom_errorbar(aes(ymin = estimate - SE*1.96, ymax = estimate + SE*1.96), width = 0.2) +\n  geom_line(aes(group = contrast), linewidth = 1) +\n  geom_hline(yintercept = 0, linetype = \"dashed\", color = \"red\") +\n  facet_wrap(~ contrast, ncol = 1) +\n  labs(\n    title = \"Treatment Effect vs Placebo Over Time\",\n    subtitle = \"Estimated Differences with 95% Confidence Intervals\",\n    x = \"Study Day\",\n    y = \"Estimated Difference vs Placebo\",\n    color = \"Treatment Comparison\",\n    caption = paste(\"Note: Points below zero favor active treatment over placebo.\",\n                   \"Error bars represent 95% confidence intervals.\",\n                   \"Non-overlapping confidence intervals with red dashed line (zero) indicate statistical significance.\")\n  ) +\n  scale_color_viridis(discrete = TRUE, option = \"D\",\n                     labels = c(\"Esketamine 56 mg vs Placebo\", \"Esketamine 84 mg vs Placebo\")) +\n  theme_minimal() +\n  theme(\n    legend.position = \"bottom\",\n    legend.background = element_rect(fill = \"white\", color = \"grey80\"),\n    legend.title = element_text(face = \"bold\"),\n    strip.background = element_rect(fill = \"lightgrey\"),\n    strip.text = element_text(face = \"bold\"),\n    axis.title = element_text(face = \"bold\"),\n    plot.title = element_text(hjust = 0.5, face = \"bold\"),\n    plot.subtitle = element_text(hjust = 0.5),\n    plot.caption = element_text(hjust = 0, face = \"italic\")\n  ) +\n  # 添加p值标签\n  geom_text(aes(label = sprintf(\"p = %.3f\", p.value)), \n            position = position_dodge(width = 0.5), vjust = -0.8, \n            color = \"black\", size = 3)\n\n\n\n\n\n\n\n# 保存森林图\nggsave(\"Treatment_effect_forest_plot_with_legend.png\", width = 10, height = 8, dpi = 300)\n\n\n\n\n# 创建热图展示p值\n# 提取所有时间点的p值\np_values &lt;- contrasts_all_df\np_values$sig &lt;- ifelse(p_values$p.value &lt; 0.001, \"***\",\n                     ifelse(p_values$p.value &lt; 0.01, \"**\",\n                          ifelse(p_values$p.value &lt; 0.05, \"*\", \"ns\")))\n\n# 数据准备\np_values_long &lt;- p_values %&gt;%\n  select(Time, contrast, p.value, sig)\n\n# 添加-log10(p值)列\np_values_long$neg_log10_p &lt;- -log10(p_values_long$p.value)\n\np_values_long\n\n   Time          contrast      p.value sig  neg_log10_p\n1     0 Dummy B - Dummy A 9.971599e-01  ns  0.001235183\n2     0 Dummy C - Dummy A 3.943676e-01  ns  0.404098792\n3     2 Dummy B - Dummy A 2.484033e-10 ***  9.604842643\n4     2 Dummy C - Dummy A 2.131253e-08 ***  7.671365020\n5     8 Dummy B - Dummy A 1.882938e-13 *** 12.725163922\n6     8 Dummy C - Dummy A 2.354221e-10 ***  9.628152722\n7    15 Dummy B - Dummy A 8.864287e-11 *** 10.052356187\n8    15 Dummy C - Dummy A 1.091197e-10 ***  9.962096784\n9    22 Dummy B - Dummy A 2.467375e-10 ***  9.607764806\n10   22 Dummy C - Dummy A 1.448419e-10 ***  9.839105738\n11   28 Dummy B - Dummy A 2.220446e-16 *** 15.653559775\n12   28 Dummy C - Dummy A 2.352738e-10 ***  9.628426432\n13  999 Dummy B - Dummy A 1.000091e-10 ***  9.999960428\n14  999 Dummy C - Dummy A 1.063928e-10 ***  9.973087829\n\n# 绘制p值热图\nggplot(p_values_long, aes(x = factor(Time), y = contrast, fill =  -log10(p.value))) +\n  geom_tile(color = \"white\") +\n  # 根据显著性调整文本颜色\n  geom_text(aes(label = sig, color = ifelse(p.value &lt; 0.05, \"white\", \"black\")), size = 5) +\n  # 手动设置文本颜色\n  scale_color_identity() +\n  # 设置小p值(高-log10(p值))为深色\n  scale_fill_viridis(option = \"C\", name = \"-log10(p-value)\", direction = 1) +\n  labs(\n    title = \"Statistical Significance of Treatment Effect vs Placebo\",\n    subtitle = \"p-values Transformed to -log10 Scale for Visual Clarity\",\n    x = \"Study Day\",\n    y = \"Treatment Comparison\",\n    caption = paste(\"* p&lt;0.05, ** p&lt;0.01, *** p&lt;0.001, ns: not significant\",\n                   \"Darker colors represent smaller p-values (higher statistical significance)\",\n                   \"The -log10 transformation converts p=0.05 to 1.3, p=0.01 to 2, p=0.001 to 3, etc.\", sep = \"\\n\")\n  ) +\n  theme_minimal() +\n  theme(\n    axis.title = element_text(face = \"bold\"),\n    plot.title = element_text(hjust = 0.5, face = \"bold\"),\n    plot.subtitle = element_text(hjust = 0.5),\n    plot.caption = element_text(hjust = 0, face = \"italic\"),\n    legend.position = \"right\",\n    legend.title = element_text(face = \"bold\"),\n    legend.background = element_rect(fill = \"white\", color = \"grey80\")\n  )\n\n\n\n\n\n\n\n# 保存热图\nggsave(\"Treatment_significance_heatmap_with_legend.png\", width = 10, height = 6, dpi = 300)\n\n\n\n# 创建模型诊断图\n# 提取残差\nresiduals &lt;- residuals(fit)\nfitted_values &lt;- fitted(fit)\n\n# 创建诊断数据框\ndiag_df &lt;- data.frame(\n  Fitted = fitted_values,\n  Residuals = residuals\n)\n\n\n# 为QQ图准备数据\nqq_data &lt;- qqnorm(residuals, plot.it = FALSE)\nqq_df &lt;- data.frame(Theoretical = qq_data$x, Sample = qq_data$y)\n\n\n# 绘制残差图\np3 &lt;- ggplot(diag_df, aes(x = Fitted, y = Residuals)) +\n  geom_point(alpha = 0.5, color = \"blue\") +\n  geom_hline(yintercept = 0, linetype = \"dashed\", color = \"red\") +\n  geom_smooth(method = \"loess\", se = TRUE, color = \"red\", fill = \"pink\", alpha = 0.3) +\n  labs(\n    title = \"Residuals vs Fitted Values\",\n    subtitle = \"Assessment of Homoscedasticity and Linearity\",\n    x = \"Fitted Values\",\n    y = \"Residuals\",\n    caption = \"Note: Points should be randomly scattered around zero line (red dashed line).\\nThe smooth curve (red) should be approximately horizontal.\"\n  ) +\n  theme_minimal() +\n  theme(\n    axis.title = element_text(face = \"bold\"),\n    plot.title = element_text(hjust = 0.5, face = \"bold\"),\n    plot.subtitle = element_text(hjust = 0.5),\n    plot.caption = element_text(hjust = 0, face = \"italic\")\n  ) +\n  # 添加解释性文本\n  annotate(\"text\", x = min(fitted_values) + 0.1*(max(fitted_values)-min(fitted_values)), \n           y = max(residuals)*0.8, \n           label = \"Ideal pattern: Random scatter\\naround the zero line with no pattern\", \n           hjust = 0, size = 3.5, fontface = \"italic\")\n\n\n\n# 绘制残差的QQ图\np4 &lt;- ggplot(qq_df, aes(x = Theoretical, y = Sample)) +\n  geom_point(alpha = 0.5, color = \"blue\") + \n  geom_abline(intercept = 0, slope = 10, color = \"red\") +\n  labs(\n    title = \"Normal Q-Q Plot of Residuals\",\n    subtitle = \"Assessment of Normality Assumption\",\n    x = \"Theoretical Quantiles\",\n    y = \"Sample Quantiles\",\n  ) +\n  theme_minimal() +\n  theme(\n    axis.title = element_text(face = \"bold\"),\n    plot.title = element_text(hjust = 0.5, face = \"bold\"),\n    plot.subtitle = element_text(hjust = 0.5),\n    plot.caption = element_text(hjust = 0, face = \"italic\")\n  ) \n\n# 使用patchwork组合诊断图\nlibrary(patchwork)\ndiag_plot &lt;- p3 + p4 + plot_layout(ncol = 2)\ndiag_plot &lt;- diag_plot + plot_annotation(\n  title = \"MMRM Model Diagnostic Plots\",\n  subtitle = \"Assessing Model Assumptions for Valid Statistical Inference\",\n  caption = \"These diagnostic plots help validate the assumptions of the Mixed Model for Repeated Measures (MMRM) analysis.\",\n  theme = theme(plot.title = element_text(hjust = 0.5, face = \"bold\", size = 16),\n               plot.subtitle = element_text(hjust = 0.5),\n               plot.caption = element_text(hjust = 0, face = \"italic\"))\n)\n\ndiag_plot\n\n`geom_smooth()` using formula = 'y ~ x'"
  }
]