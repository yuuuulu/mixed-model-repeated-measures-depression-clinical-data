<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>2025 XJTLU Biomedical Competition - Tigermed-data-about-depression-clinical-trial</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">2025 XJTLU Biomedical Competition</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./mainCode.html" aria-current="page"> 
<span class="menu-text">MainCodes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./亚组2.html"> 
<span class="menu-text">Subgroups</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Homepage</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./BioStatComp-Tigermed.pdf"> 
<span class="menu-text">essay</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#intro" id="toc-intro" class="nav-link active" data-scroll-target="#intro">intro</a>
  <ul class="collapse">
  <li><a href="#basic-idea" id="toc-basic-idea" class="nav-link" data-scroll-target="#basic-idea">basic idea</a></li>
  <li><a href="#further-improvement" id="toc-further-improvement" class="nav-link" data-scroll-target="#further-improvement">further improvement</a></li>
  </ul></li>
  <li><a href="#comparegroups" id="toc-comparegroups" class="nav-link" data-scroll-target="#comparegroups">compareGroups</a></li>
  <li><a href="#see-mean" id="toc-see-mean" class="nav-link" data-scroll-target="#see-mean">+++++see mean</a></li>
  <li><a href="#main-result" id="toc-main-result" class="nav-link" data-scroll-target="#main-result">main result</a></li>
  <li><a href="#draw-ci" id="toc-draw-ci" class="nav-link" data-scroll-target="#draw-ci">draw ci</a></li>
  <li><a href="#main-result-with-controling-sex" id="toc-main-result-with-controling-sex" class="nav-link" data-scroll-target="#main-result-with-controling-sex">main result with controling sex</a></li>
  <li><a href="#draw-ci-1" id="toc-draw-ci-1" class="nav-link" data-scroll-target="#draw-ci-1">draw ci</a></li>
  <li><a href="#lm" id="toc-lm" class="nav-link" data-scroll-target="#lm">lm</a></li>
  <li><a href="#draw-subgroups" id="toc-draw-subgroups" class="nav-link" data-scroll-target="#draw-subgroups">draw subgroups</a>
  <ul class="collapse">
  <li><a href="#to-24-young-adults" id="toc-to-24-young-adults" class="nav-link" data-scroll-target="#to-24-young-adults">≥18 to 24 young adults</a></li>
  <li><a href="#to-24-young-adults-分析" id="toc-to-24-young-adults-分析" class="nav-link" data-scroll-target="#to-24-young-adults-分析">≥18 to 24 young adults 分析</a></li>
  <li><a href="#middle-aged-adults-24-to-55-years" id="toc-middle-aged-adults-24-to-55-years" class="nav-link" data-scroll-target="#middle-aged-adults-24-to-55-years">middle-aged adults (≥24 to 55 years)</a></li>
  <li><a href="#middle-aged-adults-24-to-55-years分析" id="toc-middle-aged-adults-24-to-55-years分析" class="nav-link" data-scroll-target="#middle-aged-adults-24-to-55-years分析">middle-aged adults (≥24 to 55 years)分析</a></li>
  <li><a href="#older-adults" id="toc-older-adults" class="nav-link" data-scroll-target="#older-adults">≥55 older adults</a></li>
  <li><a href="#older-adults-分析" id="toc-older-adults-分析" class="nav-link" data-scroll-target="#older-adults-分析">≥55 older adults 分析</a></li>
  <li><a href="#年龄组疗效" id="toc-年龄组疗效" class="nav-link" data-scroll-target="#年龄组疗效">年龄组疗效</a></li>
  <li><a href="#主要疗效分析day28" id="toc-主要疗效分析day28" class="nav-link" data-scroll-target="#主要疗效分析day28">主要疗效分析（Day28）</a></li>
  <li><a href="#疗效趋势可视化及森林图" id="toc-疗效趋势可视化及森林图" class="nav-link" data-scroll-target="#疗效趋势可视化及森林图">疗效趋势可视化及森林图</a></li>
  <li><a href="#治疗组vs安慰剂的估计边际均值和差异计算及可视化" id="toc-治疗组vs安慰剂的估计边际均值和差异计算及可视化" class="nav-link" data-scroll-target="#治疗组vs安慰剂的估计边际均值和差异计算及可视化">治疗组vs安慰剂的估计边际均值和差异计算及可视化</a></li>
  <li><a href="#数据可视化有图例和解释" id="toc-数据可视化有图例和解释" class="nav-link" data-scroll-target="#数据可视化有图例和解释">数据可视化（有图例和解释）</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Tigermed-data-about-depression-clinical-trial</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="intro" class="level1">
<h1>intro</h1>
<section id="basic-idea" class="level2">
<h2 class="anchored" data-anchor-id="basic-idea">basic idea</h2>
<p>Repeated measurements are taken on the same individuals over time.</p>
<p>The primary objective of most longitudinal studies is to characterize changes in a particular outcome variable of interest over time. However, we are not only interested in change itself but also in the factors that may influence this change. These factors could be treatment interventions, such as dummy variables abc, and we want to know whether the treatment has an effect on change over time. Does the intervention lead to greater improvements in the outcome over time? It could also be exposures like sex.</p>
<p>There are two aspects of the data that complicate the analysis, meaning that we cannot use many of the routine regression techniques we are already familiar with. The first is that if you take repeated measurements over time, those measurements will be correlated and are usually positively correlated. For example, if my systolic blood pressure is high today, it provides more information about future measurements. The second is that when you take repeated measurements over time, the variability of those measurements is often heterogeneous over time. This means that the variability of the outcome at the start of the longitudinal study can often be different from the variability of the outcome later on.</p>
<p>Both correlation and variability play important roles in this model, and therefore covariance matrix is particularly significant.</p>
<p>Introduce occasions or time, which are not the same.</p>
<p>This study period is short, just 28 days, which is quicker when computing the unstructure matrix</p>
<p>The data is balanced, meaning that each individual has been measured at the same occasions.</p>
</section>
<section id="further-improvement" class="level2">
<h2 class="anchored" data-anchor-id="further-improvement">further improvement</h2>
<p>The mixed model can be more flexible for smoothing and semi-parametric regression.</p>
</section>
</section>
<section id="comparegroups" class="level1">
<h1>compareGroups</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 将SITEID分为5组</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(compareGroups)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>data0 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"3.xlsx"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 将SITEID转换为数值型变量</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>data0 <span class="ot">&lt;-</span> data0 <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SITEID_num =</span> <span class="fu">as.numeric</span>(<span class="fu">factor</span>(SITEID)))</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用ntile函数分组</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>data0 <span class="ot">&lt;-</span> data0 <span class="sc">%&gt;%</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SITEID_group =</span> <span class="fu">paste0</span>(<span class="st">"Group"</span>, <span class="fu">ntile</span>(SITEID_num, <span class="dv">5</span>)))</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>SITEID_group <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data0<span class="sc">$</span>SITEID_group)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>madrsc <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data0<span class="sc">$</span>BASE <span class="sc">&gt;</span> <span class="dv">40</span>, <span class="st">"MADRS SCORE ≥ 40"</span>,<span class="st">" MADRS SCORE &lt; 40"</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>TRT01A <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data0<span class="sc">$</span>TRT01A)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>TRT01A <span class="ot">&lt;-</span> <span class="fu">relevel</span>(data0<span class="sc">$</span>TRT01A, <span class="at">ref =</span> <span class="st">"Dummy A"</span>)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>SEX <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data0<span class="sc">$</span>SEX)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>RACE <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data0<span class="sc">$</span>RACE)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>RACE <span class="ot">&lt;-</span> <span class="fu">relevel</span>(data0<span class="sc">$</span>RACE, <span class="at">ref =</span> <span class="st">"WHITE"</span>)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 选择变量并创建表格</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>data_table1 <span class="ot">&lt;-</span> data0 <span class="sc">%&gt;%</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(madrsc, AGE, SEX, RACE, TRT01A, PCHG, CHG, BASE, AVAL,SITEID_group )</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="co"># 检查变量类型</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data_table1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [3,243 × 10] (S3: tbl_df/tbl/data.frame)
 $ madrsc      : chr [1:3243] "MADRS SCORE ≥ 40" "MADRS SCORE ≥ 40" "MADRS SCORE ≥ 40" "MADRS SCORE ≥ 40" ...
 $ AGE         : num [1:3243] 37 37 37 37 37 37 37 53 53 53 ...
 $ SEX         : Factor w/ 2 levels "F","M": 1 1 1 1 1 1 1 1 1 1 ...
 $ RACE        : Factor w/ 8 levels "WHITE","AMERICAN INDIAN OR ALASKA NATIVE",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ TRT01A      : Factor w/ 3 levels "Dummy A","Dummy B",..: 1 1 1 1 1 1 1 2 2 2 ...
 $ PCHG        : num [1:3243] NA -19.57 -8.7 -6.52 -8.7 ...
 $ CHG         : num [1:3243] NA -9 -4 -3 -4 -3 -3 NA -17 -10 ...
 $ BASE        : num [1:3243] 46 46 46 46 46 46 46 35 35 35 ...
 $ AVAL        : num [1:3243] 46 37 42 43 42 43 43 35 18 25 ...
 $ SITEID_group: Factor w/ 5 levels "Group1","Group2",..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 检查样本量</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data_table1<span class="sc">$</span>madrsc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 MADRS SCORE &lt; 40  MADRS SCORE ≥ 40 
             2525               716 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建比较表格</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>table1 <span class="ot">&lt;-</span> <span class="fu">compareGroups</span>(madrsc<span class="sc">~</span>., <span class="at">data =</span> data_table1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 如果仍然出现警告，可以尝试使用其他方法来处理变量的尺度差异</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 或者检查数据是否存在数据分离问题等</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>table1 <span class="ot">&lt;-</span> <span class="fu">createTable</span>(table1, <span class="at">show.all =</span> <span class="cn">TRUE</span>, <span class="at">hide.no =</span> <span class="st">"no"</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">show.p.overall=</span><span class="cn">TRUE</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>table1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--------Summary descriptives table by 'madrsc'---------

________________________________________________________________________________________________________ 
                                                  [ALL]      MADRS SCORE &lt; 40 MADRS SCORE ≥ 40 p.overall 
                                                 N=3241          N=2525            N=716                 
¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ 
AGE                                            45.2 (14.0)     45.5 (14.5)      44.4 (12.3)      0.045   
SEX:                                                                                             0.006   
    F                                         1928 (59.5%)    1470 (58.2%)      458 (64.0%)              
    M                                         1313 (40.5%)    1055 (41.8%)      258 (36.0%)              
RACE:                                                                                              .     
    WHITE                                     2788 (86.0%)    2177 (86.2%)      611 (85.3%)              
    AMERICAN INDIAN OR ALASKA NATIVE            6 (0.19%)       6 (0.24%)        0 (0.00%)               
    ASIAN                                      97 (2.99%)      83 (3.29%)        14 (1.96%)              
    BLACK OR AFRICAN AMERICAN                  241 (7.44%)     185 (7.33%)       56 (7.82%)              
    MULTIPLE                                   60 (1.85%)      46 (1.82%)        14 (1.96%)              
    NATIVE HAWAIIAN OR OTHER PACIFIC ISLANDER  14 (0.43%)       7 (0.28%)        7 (0.98%)               
    NOT REPORTED                               28 (0.86%)      21 (0.83%)        7 (0.98%)               
    UNKNOWN                                     7 (0.22%)       0 (0.00%)        7 (0.98%)               
TRT01A:                                                                                          0.429   
    Dummy A                                   1610 (49.7%)    1252 (49.6%)      358 (50.0%)              
    Dummy B                                    819 (25.3%)     650 (25.7%)      169 (23.6%)              
    Dummy C                                    812 (25.1%)     623 (24.7%)      189 (26.4%)              
PCHG                                          -24.64 (29.4)   -24.71 (29.8)    -24.39 (27.9)     0.802   
CHG                                           -8.82 (10.4)    -8.31 (9.82)     -10.61 (12.2)    &lt;0.001   
BASE                                           35.4 (6.36)     33.1 (5.09)      43.6 (2.26)      0.000   
AVAL                                           27.9 (11.1)     26.0 (10.0)      34.5 (12.1)     &lt;0.001   
SITEID_group:                                                                                   &lt;0.001   
    Group1                                     649 (20.0%)     486 (19.2%)      163 (22.8%)              
    Group2                                     649 (20.0%)     516 (20.4%)      133 (18.6%)              
    Group3                                     647 (20.0%)     430 (17.0%)      217 (30.3%)              
    Group4                                     648 (20.0%)     552 (21.9%)       96 (13.4%)              
    Group5                                     648 (20.0%)     541 (21.4%)      107 (14.9%)              
¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ </code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(table1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>


---Available data----

_________________________________________________________________________________________ 
             [ALL]  MADRS SCORE &lt; 40 MADRS SCORE ≥ 40      method       select Fact OR/HR 
¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ 
AGE          3241        2525              716        continuous-normal  ALL       1      
SEX          3241        2525              716           categorical     ALL       --     
RACE         3241        2525              716           categorical     ALL       --     
TRT01A       3241        2525              716           categorical     ALL       --     
PCHG         2765        2153              612        continuous-normal  ALL       1      
CHG          2765        2153              612        continuous-normal  ALL       1      
BASE         3241        2525              716        continuous-normal  ALL       1      
AVAL         3241        2525              716        continuous-normal  ALL       1      
SITEID_group 3241        2525              716           categorical     ALL       --     
¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ </code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>?compareGroups</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(compareGroups)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>data0 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"3.xlsx"</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>madrsc <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data0<span class="sc">$</span>BASE <span class="sc">&gt;</span> <span class="dv">40</span>, <span class="st">"MADRS SCORE ≥ 40"</span>,<span class="st">" MADRS SCORE &lt; 40"</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>AGE <span class="ot">&lt;-</span> <span class="fu">scale</span>(data0<span class="sc">$</span>AGE)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>AVAL <span class="ot">&lt;-</span> <span class="fu">scale</span>(data0<span class="sc">$</span>AVAL)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>BASE <span class="ot">&lt;-</span> <span class="fu">scale</span>(data0<span class="sc">$</span>BASE)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>TRT01A <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data0<span class="sc">$</span>TRT01A)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>TRT01A <span class="ot">&lt;-</span> <span class="fu">relevel</span>(data0<span class="sc">$</span>TRT01A, <span class="at">ref =</span> <span class="st">"Dummy A"</span>)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>SEX <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data0<span class="sc">$</span>SEX)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>RACE <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data0<span class="sc">$</span>RACE)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>RACE <span class="ot">&lt;-</span> <span class="fu">relevel</span>(data0<span class="sc">$</span>RACE, <span class="at">ref =</span> <span class="st">"WHITE"</span>)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>PCHG <span class="ot">&lt;-</span> <span class="fu">scale</span>(data0<span class="sc">$</span>PCHG)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>data_table1 <span class="ot">&lt;-</span> data0 <span class="sc">%&gt;%</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(madrsc, AGE, SEX, RACE, TRT01A, PCHG, CHG, BASE, AVAL)</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>table1 <span class="ot">&lt;-</span> <span class="fu">compareGroups</span>(madrsc<span class="sc">~</span>., <span class="at">data =</span> data_table1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>table1 <span class="ot">&lt;-</span> <span class="fu">createTable</span>(table1, <span class="at">show.all =</span> <span class="cn">TRUE</span>, <span class="at">hide.no =</span> <span class="st">"no"</span>,</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">show.p.overall=</span><span class="cn">TRUE</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>table1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--------Summary descriptives table by 'madrsc'---------

_______________________________________________________________________________________________________ 
                                                 [ALL]      MADRS SCORE &lt; 40 MADRS SCORE ≥ 40 p.overall 
                                                 N=3241         N=2525            N=716                 
¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ 
AGE                                           0.00 (1.00)     0.02 (1.03)      -0.06 (0.88)     0.045   
SEX:                                                                                            0.006   
    F                                         1928 (59.5%)   1470 (58.2%)      458 (64.0%)              
    M                                         1313 (40.5%)   1055 (41.8%)      258 (36.0%)              
RACE:                                                                                             .     
    WHITE                                     2788 (86.0%)   2177 (86.2%)      611 (85.3%)              
    AMERICAN INDIAN OR ALASKA NATIVE           6 (0.19%)       6 (0.24%)        0 (0.00%)               
    ASIAN                                      97 (2.99%)     83 (3.29%)        14 (1.96%)              
    BLACK OR AFRICAN AMERICAN                 241 (7.44%)     185 (7.33%)       56 (7.82%)              
    MULTIPLE                                   60 (1.85%)     46 (1.82%)        14 (1.96%)              
    NATIVE HAWAIIAN OR OTHER PACIFIC ISLANDER  14 (0.43%)      7 (0.28%)        7 (0.98%)               
    NOT REPORTED                               28 (0.86%)     21 (0.83%)        7 (0.98%)               
    UNKNOWN                                    7 (0.22%)       0 (0.00%)        7 (0.98%)               
TRT01A:                                                                                         0.429   
    Dummy A                                   1610 (49.7%)   1252 (49.6%)      358 (50.0%)              
    Dummy B                                   819 (25.3%)     650 (25.7%)      169 (23.6%)              
    Dummy C                                   812 (25.1%)     623 (24.7%)      189 (26.4%)              
PCHG                                          0.00 (1.00)     0.00 (1.01)      0.01 (0.95)      0.802   
CHG                                           -8.82 (10.4)   -8.31 (9.82)     -10.61 (12.2)    &lt;0.001   
BASE                                          0.00 (1.00)    -0.37 (0.80)      1.29 (0.36)      0.000   
AVAL                                          0.00 (1.00)    -0.17 (0.90)      0.60 (1.09)     &lt;0.001   
¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ </code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(table1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>


---Available data----

___________________________________________________________________________________ 
       [ALL]  MADRS SCORE &lt; 40 MADRS SCORE ≥ 40      method       select Fact OR/HR 
¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ 
AGE    3241        2525              716        continuous-normal  ALL       1      
SEX    3241        2525              716           categorical     ALL       --     
RACE   3241        2525              716           categorical     ALL       --     
TRT01A 3241        2525              716           categorical     ALL       --     
PCHG   2765        2153              612        continuous-normal  ALL       1      
CHG    2765        2153              612        continuous-normal  ALL       1      
BASE   3241        2525              716        continuous-normal  ALL       1      
AVAL   3241        2525              716        continuous-normal  ALL       1      
¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ </code></pre>
</div>
</div>
</section>
<section id="see-mean" class="level1">
<h1>+++++see mean</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required libraries</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)  <span class="co"># For reading Excel files</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)   <span class="co"># For data manipulation</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)   <span class="co"># For data manipulation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'tidyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked _by_ '.GlobalEnv':

    table1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the data from the Excel file</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"3.xlsx"</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert AVISIT to a numeric factor to sort by the day of the visit</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>AVISIT <span class="ot">&lt;-</span> <span class="fu">factor</span>(data<span class="sc">$</span>AVISIT, <span class="at">levels =</span> <span class="fu">unique</span>(data<span class="sc">$</span>AVISIT)[<span class="fu">order</span>(<span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"Day </span><span class="sc">\\</span><span class="st">d+ </span><span class="sc">\\</span><span class="st">("</span>, <span class="st">""</span>, <span class="fu">gsub</span>(<span class="st">" </span><span class="sc">\\</span><span class="st">(DB</span><span class="sc">\\</span><span class="st">)"</span>, <span class="st">""</span>, data<span class="sc">$</span>AVISIT)) ))])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in order(as.numeric(gsub("Day \\d+ \\(", "", gsub(" \\(DB\\)", "", :
NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by AVISIT and TRT01A, then calculate mean of AVAL for each group</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(AVISIT, TRT01A) <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_AVAL =</span> <span class="fu">mean</span>(AVAL, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span>  <span class="co"># Remove grouping to allow sorting</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(AVISIT) <span class="sc">%&gt;%</span>  <span class="co"># Sort by AVISIT (now a numeric factor)</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> TRT01A, <span class="at">values_from =</span> mean_AVAL)  <span class="co"># Pivot the table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'AVISIT'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the result</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 4
  AVISIT        `Dummy A` `Dummy B` `Dummy C`
  &lt;fct&gt;             &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 Baseline (DB)      35.0      35.6      35.5
2 Day 2 (DB)         24.0      25.5      24.9
3 Day 8 (DB)         27.9      29.2      27.6
4 Day 15 (DB)        27.5      29.1      27.9
5 Day 22 (DB)        26.2      27.2      25.9
6 Day 28 (DB)        25.4      27.5      26.0
7 Endpoint (DB)      25.7      27.8      26.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#data$mean_AVAL &lt;- mean(data$AVAL, na.rm = TRUE)</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot2 for visualization --3 lines in a plot and y-axis is AVAL, x-axis is AVISIT</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co">#ggplot(data$mean_AVAL ,aes(x = AVISIT)) +</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a> <span class="co"># geom_line(aes(y = `Dummy A`, color = "Dummy A")) +</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_line(aes(y = `Dummy B`, color = "Dummy B")) +</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_line(aes(y = `Dummy C`, color = "Dummy C")) +</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#labs(title = "Mean AVAL by AVISIT and Treatment Group",</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   x = "Visit",</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>     <span class="co">#  y = "Mean AVAL") +</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co">#  theme_minimal() +</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#s#cale_color_manual(values = c("blue", "red", "green")) +</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#theme(legend.title = element_blank())</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required libraries</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="co"># For plotting, keep the data in long format</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(AVISIT, TRT01A) <span class="sc">%&gt;%</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_AVAL =</span> <span class="fu">mean</span>(AVAL, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the plot</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> AVISIT, <span class="at">y =</span> mean_AVAL, <span class="at">color =</span> TRT01A, <span class="at">group =</span> TRT01A)) <span class="sc">+</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Mean AVAL by AVISIT and Treatment Group"</span>,</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Visit"</span>,</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Mean AVAL"</span>) <span class="sc">+</span></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"green"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mainCode_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Optionally, you can write the result to a new Excel file</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(writexl)</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co"># write_xlsx(result, "result.xlsx")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="main-result" class="level1">
<h1>main result</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mmrm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'mmrm' was built under R version 4.4.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>admadrs <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"3.xlsx"</span>, </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sheet =</span> <span class="st">"Sheet1"</span>, <span class="at">col_names =</span> <span class="cn">TRUE</span>, </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">col_types =</span> <span class="cn">NULL</span>, <span class="at">na =</span> <span class="st">""</span>, <span class="at">skip =</span> <span class="dv">0</span>)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建分类变量 base_situation</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>base_situation <span class="ot">&lt;-</span> <span class="fu">cut</span>(</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  admadrs<span class="sc">$</span>BASE,</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="fu">c</span>( <span class="dv">9</span>, <span class="dv">19</span>, <span class="dv">39</span>, <span class="cn">Inf</span>),</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"10-19"</span>, <span class="st">"20-39"</span>, <span class="st">"40+"</span>),</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 将 base_situation 转换为因子类型</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>base_situation <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(admadrs<span class="sc">$</span>base_situation)</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>USUBJID <span class="ot">&lt;-</span> <span class="fu">factor</span>(admadrs<span class="sc">$</span>USUBJID)</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>AVISITN <span class="ot">&lt;-</span> admadrs<span class="sc">$</span>AVISITN <span class="sc">-</span> <span class="dv">20000</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>AVISITN <span class="ot">&lt;-</span> <span class="fu">factor</span>(admadrs<span class="sc">$</span>AVISITN)</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>CHG <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(admadrs<span class="sc">$</span>CHG)</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>base_situation <span class="ot">&lt;-</span> <span class="fu">relevel</span>(admadrs<span class="sc">$</span>base_situation, <span class="at">ref =</span> <span class="st">"40+"</span>)</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Delete a duplicate point in time</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>admadrs <span class="ot">&lt;-</span> admadrs[<span class="sc">!</span><span class="fu">duplicated</span>(admadrs[<span class="fu">c</span>(<span class="st">"USUBJID"</span>, <span class="st">"AVISIT"</span>)]), ]</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a><span class="co"># scale data </span></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>AGE <span class="ot">&lt;-</span> <span class="fu">scale</span>(admadrs<span class="sc">$</span>AGE)</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>AVAL <span class="ot">&lt;-</span> <span class="fu">scale</span>(admadrs<span class="sc">$</span>AVAL)</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a><span class="co"># 更新模型以包括 base_situation</span></span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">mmrm</span>(</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> AVAL <span class="sc">~</span> AVISITN<span class="sc">:</span>TRT01A <span class="sc">+</span>TRT01A <span class="sc">+</span> SITEID<span class="sc">+</span> RACE <span class="sc">+</span> AGE <span class="sc">+</span> base_situation <span class="sc">+</span> <span class="fu">us</span>(AVISITN <span class="sc">|</span> USUBJID),</span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> admadrs)</span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a><span class="co"># 获取模型摘要</span></span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a>model_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(fit)</span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a>model_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>mmrm fit

Formula:     
AVAL ~ AVISITN:TRT01A + TRT01A + SITEID + RACE + AGE + base_situation +  
    us(AVISITN | USUBJID)
Data:        admadrs (used 3214 observations from 476 subjects with maximum 7 
timepoints)
Covariance:  unstructured (28 variance parameters)
Method:      Satterthwaite
Vcov Method: Asymptotic
Inference:   REML

Model selection criteria:
     AIC      BIC   logLik deviance 
  3852.3   3969.0  -1898.2   3796.3 

Coefficients: 
                                                Estimate Std. Error         df
(Intercept)                                     1.806053   0.375454 415.500000
TRT01ADummy B                                   0.001719   0.041133 416.000000
TRT01ADummy C                                   0.048026   0.041752 416.900000
SITEIDUS10002                                   0.076913   0.124708 415.700000
SITEIDUS10004                                  -0.221056   0.172061 415.500000
SITEIDUS10005                                   0.238437   0.362054 415.300000
SITEIDUS10006                                  -0.142527   0.123867 415.700000
SITEIDUS10008                                  -0.555081   0.189226 416.700000
SITEIDUS10009                                  -0.108724   0.134404 415.500000
SITEIDUS10013                                   0.098598   0.120475 415.300000
SITEIDUS10014                                   0.120042   0.135360 417.100000
SITEIDUS10015                                   0.154076   0.121021 415.400000
SITEIDUS10016                                  -0.281098   0.261486 421.100000
SITEIDUS10017                                  -0.126686   0.158631 416.200000
SITEIDUS10019                                  -0.076086   0.134493 415.300000
SITEIDUS10020                                  -0.359461   0.139698 415.400000
SITEIDUS10021                                  -0.156841   0.116689 415.300000
SITEIDUS10023                                  -0.622644   0.258943 415.500000
SITEIDUS10025                                   0.030272   0.158685 415.300000
SITEIDUS10027                                  -0.178228   0.260325 415.300000
SITEIDUS10029                                   0.035942   0.108453 415.500000
SITEIDUS10030                                  -0.061651   0.101481 415.600000
SITEIDUS10031                                  -0.054005   0.151611 415.300000
SITEIDUS10033                                   0.003187   0.155735 433.100000
SITEIDUS10034                                   0.038837   0.171523 415.300000
SITEIDUS10036                                   0.301038   0.125752 415.300000
SITEIDUS10039                                   0.569455   0.361001 415.300000
SITEIDUS10040                                   0.063481   0.190898 415.500000
SITEIDUS10041                                   0.129966   0.157449 415.500000
SITEIDUS10043                                  -0.173603   0.116430 415.800000
SITEIDUS10044                                  -0.083537   0.215919 415.800000
SITEIDUS10045                                  -0.014193   0.188651 415.300000
SITEIDUS10046                                   0.183459   0.159190 415.700000
SITEIDUS10049                                   0.111136   0.158066 415.300000
SITEIDUS10051                                  -0.070450   0.114373 415.300000
SITEIDUS10053                                   0.392623   0.385587 415.400000
SITEIDUS10055                                   0.012793   0.122778 415.400000
SITEIDUS10056                                  -0.386136   0.129926 416.100000
SITEIDUS10057                                   0.068405   0.136772 415.600000
SITEIDUS10058                                  -0.128815   0.120894 415.400000
SITEIDUS10062                                  -0.006573   0.088860 415.600000
SITEIDUS10068                                   0.069483   0.106422 415.300000
SITEIDUS10069                                   0.260331   0.215821 415.300000
SITEIDUS10070                                  -0.093592   0.087621 415.600000
SITEIDUS10071                                  -0.280235   0.160520 415.500000
SITEIDUS10073                                  -0.087786   0.361084 415.200000
SITEIDUS10074                                  -0.125308   0.111749 415.900000
SITEIDUS10075                                  -0.003134   0.088734 415.500000
SITEIDUS10076                                  -0.361377   0.148825 415.800000
RACEASIAN                                      -0.283532   0.381605 415.400000
RACEBLACK OR AFRICAN AMERICAN                  -0.566955   0.373347 415.400000
RACEMULTIPLE                                   -0.648127   0.392952 415.500000
RACENATIVE HAWAIIAN OR OTHER PACIFIC ISLANDER  -0.437063   0.450218 415.500000
RACENOT REPORTED                               -0.271027   0.414808 415.500000
RACEUNKNOWN                                    -0.484391   0.521374 415.500000
RACEWHITE                                      -0.463115   0.367678 415.400000
AGE                                             0.021668   0.018133 417.800000
base_situation10-19                            -2.339846   0.187831 415.600000
base_situation20-39                            -0.857016   0.040751 415.600000
TRT01ADummy A:AVISITN2                         -1.006297   0.059276 468.500000
TRT01ADummy B:AVISITN2                         -0.934629   0.082854 467.300000
TRT01ADummy C:AVISITN2                         -0.981017   0.083632 472.400000
TRT01ADummy A:AVISITN8                         -0.651015   0.056054 463.500000
TRT01ADummy B:AVISITN8                         -0.569553   0.078328 462.100000
TRT01ADummy C:AVISITN8                         -0.716786   0.079153 469.200000
TRT01ADummy A:AVISITN15                        -0.694693   0.059041 464.500000
TRT01ADummy B:AVISITN15                        -0.583654   0.082304 459.400000
TRT01ADummy C:AVISITN15                        -0.697462   0.082969 464.100000
TRT01ADummy A:AVISITN22                        -0.822214   0.065033 470.600000
TRT01ADummy B:AVISITN22                        -0.742937   0.090897 468.700000
TRT01ADummy C:AVISITN22                        -0.838812   0.091607 474.000000
TRT01ADummy A:AVISITN28                        -0.842654   0.064190 470.300000
TRT01ADummy B:AVISITN28                        -0.694904   0.089841 470.400000
TRT01ADummy C:AVISITN28                        -0.843249   0.090264 471.200000
TRT01ADummy A:AVISITN999                       -0.847770   0.064133 470.400000
TRT01ADummy B:AVISITN999                       -0.702906   0.089752 470.300000
TRT01ADummy C:AVISITN999                       -0.850659   0.090181 471.200000
                                              t value Pr(&gt;|t|)    
(Intercept)                                     4.810 2.11e-06 ***
TRT01ADummy B                                   0.042  0.96668    
TRT01ADummy C                                   1.150  0.25070    
SITEIDUS10002                                   0.617  0.53774    
SITEIDUS10004                                  -1.285  0.19959    
SITEIDUS10005                                   0.659  0.51054    
SITEIDUS10006                                  -1.151  0.25054    
SITEIDUS10008                                  -2.933  0.00354 ** 
SITEIDUS10009                                  -0.809  0.41902    
SITEIDUS10013                                   0.818  0.41359    
SITEIDUS10014                                   0.887  0.37568    
SITEIDUS10015                                   1.273  0.20368    
SITEIDUS10016                                  -1.075  0.28299    
SITEIDUS10017                                  -0.799  0.42497    
SITEIDUS10019                                  -0.566  0.57189    
SITEIDUS10020                                  -2.573  0.01042 *  
SITEIDUS10021                                  -1.344  0.17965    
SITEIDUS10023                                  -2.405  0.01663 *  
SITEIDUS10025                                   0.191  0.84880    
SITEIDUS10027                                  -0.685  0.49395    
SITEIDUS10029                                   0.331  0.74050    
SITEIDUS10030                                  -0.608  0.54384    
SITEIDUS10031                                  -0.356  0.72187    
SITEIDUS10033                                   0.020  0.98368    
SITEIDUS10034                                   0.226  0.82098    
SITEIDUS10036                                   2.394  0.01711 *  
SITEIDUS10039                                   1.577  0.11546    
SITEIDUS10040                                   0.333  0.73965    
SITEIDUS10041                                   0.825  0.40959    
SITEIDUS10043                                  -1.491  0.13671    
SITEIDUS10044                                  -0.387  0.69904    
SITEIDUS10045                                  -0.075  0.94007    
SITEIDUS10046                                   1.152  0.24980    
SITEIDUS10049                                   0.703  0.48239    
SITEIDUS10051                                  -0.616  0.53825    
SITEIDUS10053                                   1.018  0.30915    
SITEIDUS10055                                   0.104  0.91706    
SITEIDUS10056                                  -2.972  0.00313 ** 
SITEIDUS10057                                   0.500  0.61724    
SITEIDUS10058                                  -1.066  0.28726    
SITEIDUS10062                                  -0.074  0.94107    
SITEIDUS10068                                   0.653  0.51418    
SITEIDUS10069                                   1.206  0.22841    
SITEIDUS10070                                  -1.068  0.28608    
SITEIDUS10071                                  -1.746  0.08158 .  
SITEIDUS10073                                  -0.243  0.80803    
SITEIDUS10074                                  -1.121  0.26279    
SITEIDUS10075                                  -0.035  0.97184    
SITEIDUS10076                                  -2.428  0.01560 *  
RACEASIAN                                      -0.743  0.45790    
RACEBLACK OR AFRICAN AMERICAN                  -1.519  0.12963    
RACEMULTIPLE                                   -1.649  0.09983 .  
RACENATIVE HAWAIIAN OR OTHER PACIFIC ISLANDER  -0.971  0.33222    
RACENOT REPORTED                               -0.653  0.51387    
RACEUNKNOWN                                    -0.929  0.35339    
RACEWHITE                                      -1.260  0.20853    
AGE                                             1.195  0.23277    
base_situation10-19                           -12.457  &lt; 2e-16 ***
base_situation20-39                           -21.030  &lt; 2e-16 ***
TRT01ADummy A:AVISITN2                        -16.977  &lt; 2e-16 ***
TRT01ADummy B:AVISITN2                        -11.280  &lt; 2e-16 ***
TRT01ADummy C:AVISITN2                        -11.730  &lt; 2e-16 ***
TRT01ADummy A:AVISITN8                        -11.614  &lt; 2e-16 ***
TRT01ADummy B:AVISITN8                         -7.271 1.53e-12 ***
TRT01ADummy C:AVISITN8                         -9.056  &lt; 2e-16 ***
TRT01ADummy A:AVISITN15                       -11.766  &lt; 2e-16 ***
TRT01ADummy B:AVISITN15                        -7.091 5.04e-12 ***
TRT01ADummy C:AVISITN15                        -8.406 5.23e-16 ***
TRT01ADummy A:AVISITN22                       -12.643  &lt; 2e-16 ***
TRT01ADummy B:AVISITN22                        -8.173 2.82e-15 ***
TRT01ADummy C:AVISITN22                        -9.157  &lt; 2e-16 ***
TRT01ADummy A:AVISITN28                       -13.127  &lt; 2e-16 ***
TRT01ADummy B:AVISITN28                        -7.735 6.36e-14 ***
TRT01ADummy C:AVISITN28                        -9.342  &lt; 2e-16 ***
TRT01ADummy A:AVISITN999                      -13.219  &lt; 2e-16 ***
TRT01ADummy B:AVISITN999                       -7.832 3.23e-14 ***
TRT01ADummy C:AVISITN999                       -9.433  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Covariance estimate:
         0      2      8     15     22     28    999
0   0.1287 0.0874 0.0944 0.0802 0.0866 0.0829 0.0830
2   0.0874 0.8628 0.5757 0.5341 0.5563 0.5582 0.5632
8   0.0944 0.5757 0.7903 0.6412 0.6584 0.6251 0.6278
15  0.0802 0.5341 0.6412 0.8388 0.7806 0.7324 0.7313
22  0.0866 0.5563 0.6584 0.7806 1.0243 0.8904 0.8913
28  0.0829 0.5582 0.6251 0.7324 0.8904 1.0050 1.0005
999 0.0830 0.5632 0.6278 0.7313 0.8913 1.0005 1.0039</code></pre>
</div>
</div>
</section>
<section id="draw-ci" class="level1">
<h1>draw ci</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 提取系数估计值和标准误差，并筛选出包含 "SITE" 的系数</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>coef_table <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(model_summary<span class="sc">$</span>coefficients)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算置信区间</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>coef_table<span class="sc">$</span>LowerCI <span class="ot">&lt;-</span> coef_table<span class="sc">$</span>Estimate <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> coef_table<span class="sc">$</span><span class="st">`</span><span class="at">Std. Error</span><span class="st">`</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>coef_table<span class="sc">$</span>UpperCI <span class="ot">&lt;-</span> coef_table<span class="sc">$</span>Estimate <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> coef_table<span class="sc">$</span><span class="st">`</span><span class="at">Std. Error</span><span class="st">`</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 美化P值显示</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>format_pvalue <span class="ot">&lt;-</span> <span class="cf">function</span>(p) {</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(p <span class="sc">&lt;</span> <span class="fl">0.001</span>, <span class="st">"&lt;0.001"</span>, </span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>         <span class="fu">ifelse</span>(p <span class="sc">&lt;</span> <span class="fl">0.01</span>, <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, p),</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>                <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, p)))</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>result_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="fu">rownames</span>(model_summary<span class="sc">$</span>coefficients),</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">Coefficient =</span> <span class="fu">round</span>(coef_table<span class="sc">$</span>Estimate, <span class="dv">3</span>),</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">CI =</span> <span class="fu">paste0</span>(<span class="st">"("</span>, <span class="fu">round</span>(coef_table<span class="sc">$</span>LowerCI, <span class="dv">3</span>), <span class="st">", "</span>, <span class="fu">round</span>(coef_table<span class="sc">$</span>UpperCI, <span class="dv">3</span>), <span class="st">")"</span>),</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">P-value</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sapply</span>(coef_table<span class="sc">$</span><span class="st">`</span><span class="at">Pr(&gt;|t|)</span><span class="st">`</span>, format_pvalue)</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>result_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                        variable Coefficient               CI
1                                    (Intercept)       1.806    (1.07, 2.542)
2                                  TRT01ADummy B       0.002  (-0.079, 0.082)
3                                  TRT01ADummy C       0.048   (-0.034, 0.13)
4                                  SITEIDUS10002       0.077  (-0.168, 0.321)
5                                  SITEIDUS10004      -0.221  (-0.558, 0.116)
6                                  SITEIDUS10005       0.238  (-0.471, 0.948)
7                                  SITEIDUS10006      -0.143    (-0.385, 0.1)
8                                  SITEIDUS10008      -0.555 (-0.926, -0.184)
9                                  SITEIDUS10009      -0.109  (-0.372, 0.155)
10                                 SITEIDUS10013       0.099  (-0.138, 0.335)
11                                 SITEIDUS10014       0.120  (-0.145, 0.385)
12                                 SITEIDUS10015       0.154  (-0.083, 0.391)
13                                 SITEIDUS10016      -0.281  (-0.794, 0.231)
14                                 SITEIDUS10017      -0.127  (-0.438, 0.184)
15                                 SITEIDUS10019      -0.076   (-0.34, 0.188)
16                                 SITEIDUS10020      -0.359 (-0.633, -0.086)
17                                 SITEIDUS10021      -0.157  (-0.386, 0.072)
18                                 SITEIDUS10023      -0.623  (-1.13, -0.115)
19                                 SITEIDUS10025       0.030  (-0.281, 0.341)
20                                 SITEIDUS10027      -0.178  (-0.688, 0.332)
21                                 SITEIDUS10029       0.036  (-0.177, 0.249)
22                                 SITEIDUS10030      -0.062  (-0.261, 0.137)
23                                 SITEIDUS10031      -0.054  (-0.351, 0.243)
24                                 SITEIDUS10033       0.003  (-0.302, 0.308)
25                                 SITEIDUS10034       0.039  (-0.297, 0.375)
26                                 SITEIDUS10036       0.301   (0.055, 0.548)
27                                 SITEIDUS10039       0.569  (-0.138, 1.277)
28                                 SITEIDUS10040       0.063  (-0.311, 0.438)
29                                 SITEIDUS10041       0.130  (-0.179, 0.439)
30                                 SITEIDUS10043      -0.174  (-0.402, 0.055)
31                                 SITEIDUS10044      -0.084   (-0.507, 0.34)
32                                 SITEIDUS10045      -0.014  (-0.384, 0.356)
33                                 SITEIDUS10046       0.183  (-0.129, 0.495)
34                                 SITEIDUS10049       0.111  (-0.199, 0.421)
35                                 SITEIDUS10051      -0.070  (-0.295, 0.154)
36                                 SITEIDUS10053       0.393  (-0.363, 1.148)
37                                 SITEIDUS10055       0.013  (-0.228, 0.253)
38                                 SITEIDUS10056      -0.386 (-0.641, -0.131)
39                                 SITEIDUS10057       0.068    (-0.2, 0.336)
40                                 SITEIDUS10058      -0.129  (-0.366, 0.108)
41                                 SITEIDUS10062      -0.007  (-0.181, 0.168)
42                                 SITEIDUS10068       0.069  (-0.139, 0.278)
43                                 SITEIDUS10069       0.260  (-0.163, 0.683)
44                                 SITEIDUS10070      -0.094  (-0.265, 0.078)
45                                 SITEIDUS10071      -0.280  (-0.595, 0.034)
46                                 SITEIDUS10073      -0.088   (-0.796, 0.62)
47                                 SITEIDUS10074      -0.125  (-0.344, 0.094)
48                                 SITEIDUS10075      -0.003  (-0.177, 0.171)
49                                 SITEIDUS10076      -0.361  (-0.653, -0.07)
50                                     RACEASIAN      -0.284  (-1.031, 0.464)
51                 RACEBLACK OR AFRICAN AMERICAN      -0.567  (-1.299, 0.165)
52                                  RACEMULTIPLE      -0.648  (-1.418, 0.122)
53 RACENATIVE HAWAIIAN OR OTHER PACIFIC ISLANDER      -0.437  (-1.319, 0.445)
54                              RACENOT REPORTED      -0.271  (-1.084, 0.542)
55                                   RACEUNKNOWN      -0.484  (-1.506, 0.538)
56                                     RACEWHITE      -0.463  (-1.184, 0.258)
57                                           AGE       0.022  (-0.014, 0.057)
58                           base_situation10-19      -2.340 (-2.708, -1.972)
59                           base_situation20-39      -0.857 (-0.937, -0.777)
60                        TRT01ADummy A:AVISITN2      -1.006  (-1.122, -0.89)
61                        TRT01ADummy B:AVISITN2      -0.935 (-1.097, -0.772)
62                        TRT01ADummy C:AVISITN2      -0.981 (-1.145, -0.817)
63                        TRT01ADummy A:AVISITN8      -0.651 (-0.761, -0.541)
64                        TRT01ADummy B:AVISITN8      -0.570 (-0.723, -0.416)
65                        TRT01ADummy C:AVISITN8      -0.717 (-0.872, -0.562)
66                       TRT01ADummy A:AVISITN15      -0.695  (-0.81, -0.579)
67                       TRT01ADummy B:AVISITN15      -0.584 (-0.745, -0.422)
68                       TRT01ADummy C:AVISITN15      -0.697  (-0.86, -0.535)
69                       TRT01ADummy A:AVISITN22      -0.822  (-0.95, -0.695)
70                       TRT01ADummy B:AVISITN22      -0.743 (-0.921, -0.565)
71                       TRT01ADummy C:AVISITN22      -0.839 (-1.018, -0.659)
72                       TRT01ADummy A:AVISITN28      -0.843 (-0.968, -0.717)
73                       TRT01ADummy B:AVISITN28      -0.695 (-0.871, -0.519)
74                       TRT01ADummy C:AVISITN28      -0.843  (-1.02, -0.666)
75                      TRT01ADummy A:AVISITN999      -0.848 (-0.973, -0.722)
76                      TRT01ADummy B:AVISITN999      -0.703 (-0.879, -0.527)
77                      TRT01ADummy C:AVISITN999      -0.851 (-1.027, -0.674)
   P.value
1   &lt;0.001
2     0.97
3     0.25
4     0.54
5     0.20
6     0.51
7     0.25
8    0.004
9     0.42
10    0.41
11    0.38
12    0.20
13    0.28
14    0.42
15    0.57
16    0.01
17    0.18
18    0.02
19    0.85
20    0.49
21    0.74
22    0.54
23    0.72
24    0.98
25    0.82
26    0.02
27    0.12
28    0.74
29    0.41
30    0.14
31    0.70
32    0.94
33    0.25
34    0.48
35    0.54
36    0.31
37    0.92
38   0.003
39    0.62
40    0.29
41    0.94
42    0.51
43    0.23
44    0.29
45    0.08
46    0.81
47    0.26
48    0.97
49    0.02
50    0.46
51    0.13
52    0.10
53    0.33
54    0.51
55    0.35
56    0.21
57    0.23
58  &lt;0.001
59  &lt;0.001
60  &lt;0.001
61  &lt;0.001
62  &lt;0.001
63  &lt;0.001
64  &lt;0.001
65  &lt;0.001
66  &lt;0.001
67  &lt;0.001
68  &lt;0.001
69  &lt;0.001
70  &lt;0.001
71  &lt;0.001
72  &lt;0.001
73  &lt;0.001
74  &lt;0.001
75  &lt;0.001
76  &lt;0.001
77  &lt;0.001</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 导出到Excel</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co">#library(writexl)</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co">#write_xlsx(result_table, "mmrm_results.xlsx")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="main-result-with-controling-sex" class="level1">
<h1>main result with controling sex</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mmrm)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>admadrs <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"3.xlsx"</span>, </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sheet =</span> <span class="st">"Sheet1"</span>, <span class="at">col_names =</span> <span class="cn">TRUE</span>, </span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">col_types =</span> <span class="cn">NULL</span>, <span class="at">na =</span> <span class="st">""</span>, <span class="at">skip =</span> <span class="dv">0</span>)</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建分类变量 base_situation</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>base_situation <span class="ot">&lt;-</span> <span class="fu">cut</span>(</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  admadrs<span class="sc">$</span>BASE,</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="fu">c</span>( <span class="dv">9</span>, <span class="dv">19</span>, <span class="dv">39</span>, <span class="cn">Inf</span>),</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"10-19"</span>, <span class="st">"20-39"</span>, <span class="st">"40+"</span>),</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 将 base_situation 转换为因子类型</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>base_situation <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(admadrs<span class="sc">$</span>base_situation)</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>USUBJID <span class="ot">&lt;-</span> <span class="fu">factor</span>(admadrs<span class="sc">$</span>USUBJID)</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>AVISITN <span class="ot">&lt;-</span> admadrs<span class="sc">$</span>AVISITN <span class="sc">-</span> <span class="dv">20000</span></span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>AVISITN <span class="ot">&lt;-</span> <span class="fu">factor</span>(admadrs<span class="sc">$</span>AVISITN)</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>CHG <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(admadrs<span class="sc">$</span>CHG)</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>base_situation <span class="ot">&lt;-</span> <span class="fu">relevel</span>(admadrs<span class="sc">$</span>base_situation, <span class="at">ref =</span> <span class="st">"40+"</span>)</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Delete a duplicate point in time</span></span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>admadrs <span class="ot">&lt;-</span> admadrs[<span class="sc">!</span><span class="fu">duplicated</span>(admadrs[<span class="fu">c</span>(<span class="st">"USUBJID"</span>, <span class="st">"AVISIT"</span>)]), ]</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a><span class="co"># scale data </span></span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>AGE <span class="ot">&lt;-</span> <span class="fu">scale</span>(admadrs<span class="sc">$</span>AGE)</span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>AVAL <span class="ot">&lt;-</span> <span class="fu">scale</span>(admadrs<span class="sc">$</span>AVAL)</span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a><span class="co"># 更新模型以包括 base_situation</span></span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">mmrm</span>(</span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> AVAL <span class="sc">~</span> AVISITN<span class="sc">:</span>TRT01A <span class="sc">+</span>TRT01A <span class="sc">+</span>SEX<span class="sc">+</span> SITEID<span class="sc">+</span> RACE <span class="sc">+</span> AGE <span class="sc">+</span> base_situation <span class="sc">+</span> <span class="fu">us</span>(AVISITN <span class="sc">|</span> USUBJID),</span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> admadrs)</span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a><span class="co"># 获取模型摘要</span></span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a>model_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(fit)</span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a>model_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>mmrm fit

Formula:     AVAL ~ AVISITN:TRT01A + TRT01A + SEX + SITEID + RACE + AGE +  
    base_situation + us(AVISITN | USUBJID)
Data:        admadrs (used 3214 observations from 476 subjects with maximum 7 
timepoints)
Covariance:  unstructured (28 variance parameters)
Method:      Satterthwaite
Vcov Method: Asymptotic
Inference:   REML

Model selection criteria:
     AIC      BIC   logLik deviance 
  3856.3   3972.9  -1900.1   3800.3 

Coefficients: 
                                                Estimate Std. Error         df
(Intercept)                                    1.801e+00  3.756e-01  4.145e+02
TRT01ADummy B                                  1.714e-03  4.114e-02  4.150e+02
TRT01ADummy C                                  4.943e-02  4.178e-02  4.159e+02
SEXM                                          -3.458e-02  3.568e-02  4.151e+02
SITEIDUS10002                                  8.039e-02  1.248e-01  4.147e+02
SITEIDUS10004                                 -2.118e-01  1.723e-01  4.145e+02
SITEIDUS10005                                  2.211e-01  3.625e-01  4.143e+02
SITEIDUS10006                                 -1.343e-01  1.241e-01  4.147e+02
SITEIDUS10008                                 -5.671e-01  1.897e-01  4.157e+02
SITEIDUS10009                                 -1.067e-01  1.344e-01  4.145e+02
SITEIDUS10013                                  1.027e-01  1.206e-01  4.143e+02
SITEIDUS10014                                  1.153e-01  1.354e-01  4.161e+02
SITEIDUS10015                                  1.455e-01  1.213e-01  4.145e+02
SITEIDUS10016                                 -2.962e-01  2.618e-01  4.200e+02
SITEIDUS10017                                 -1.249e-01  1.587e-01  4.152e+02
SITEIDUS10019                                 -6.638e-02  1.350e-01  4.143e+02
SITEIDUS10020                                 -3.592e-01  1.397e-01  4.144e+02
SITEIDUS10021                                 -1.470e-01  1.174e-01  4.144e+02
SITEIDUS10023                                 -6.167e-01  2.590e-01  4.146e+02
SITEIDUS10025                                  2.665e-02  1.587e-01  4.143e+02
SITEIDUS10027                                 -1.780e-01  2.604e-01  4.143e+02
SITEIDUS10029                                  4.001e-02  1.086e-01  4.146e+02
SITEIDUS10030                                 -5.887e-02  1.016e-01  4.146e+02
SITEIDUS10031                                 -5.395e-02  1.517e-01  4.143e+02
SITEIDUS10033                                  4.711e-04  1.558e-01  4.321e+02
SITEIDUS10034                                  3.307e-02  1.716e-01  4.143e+02
SITEIDUS10036                                  3.019e-01  1.258e-01  4.143e+02
SITEIDUS10039                                  5.580e-01  3.613e-01  4.143e+02
SITEIDUS10040                                  7.344e-02  1.912e-01  4.145e+02
SITEIDUS10041                                  1.468e-01  1.584e-01  4.145e+02
SITEIDUS10043                                 -1.695e-01  1.165e-01  4.149e+02
SITEIDUS10044                                 -9.636e-02  2.164e-01  4.147e+02
SITEIDUS10045                                 -1.581e-02  1.888e-01  4.143e+02
SITEIDUS10046                                  1.849e-01  1.592e-01  4.147e+02
SITEIDUS10049                                  1.036e-01  1.582e-01  4.143e+02
SITEIDUS10051                                 -8.296e-02  1.149e-01  4.143e+02
SITEIDUS10053                                  4.168e-01  3.866e-01  4.144e+02
SITEIDUS10055                                  1.125e-02  1.228e-01  4.145e+02
SITEIDUS10056                                 -3.738e-01  1.305e-01  4.151e+02
SITEIDUS10057                                  6.903e-02  1.368e-01  4.146e+02
SITEIDUS10058                                 -1.250e-01  1.210e-01  4.144e+02
SITEIDUS10062                                  1.243e-03  8.932e-02  4.147e+02
SITEIDUS10068                                  7.517e-02  1.066e-01  4.144e+02
SITEIDUS10069                                  2.575e-01  2.159e-01  4.143e+02
SITEIDUS10070                                 -9.618e-02  8.767e-02  4.146e+02
SITEIDUS10071                                 -2.820e-01  1.605e-01  4.145e+02
SITEIDUS10073                                 -1.095e-01  3.614e-01  4.142e+02
SITEIDUS10074                                 -1.269e-01  1.118e-01  4.149e+02
SITEIDUS10075                                 -6.080e-03  8.878e-02  4.145e+02
SITEIDUS10076                                 -3.652e-01  1.489e-01  4.149e+02
RACEASIAN                                     -2.722e-01  3.818e-01  4.145e+02
RACEBLACK OR AFRICAN AMERICAN                 -5.534e-01  3.736e-01  4.144e+02
RACEMULTIPLE                                  -6.407e-01  3.931e-01  4.146e+02
RACENATIVE HAWAIIAN OR OTHER PACIFIC ISLANDER -4.206e-01  4.507e-01  4.146e+02
RACENOT REPORTED                              -2.520e-01  4.152e-01  4.145e+02
RACEUNKNOWN                                   -4.518e-01  5.227e-01  4.146e+02
RACEWHITE                                     -4.490e-01  3.680e-01  4.144e+02
AGE                                            2.227e-02  1.815e-02  4.169e+02
base_situation10-19                           -2.334e+00  1.881e-01  4.146e+02
base_situation20-39                           -8.527e-01  4.104e-02  4.146e+02
TRT01ADummy A:AVISITN2                        -1.006e+00  5.927e-02  4.685e+02
TRT01ADummy B:AVISITN2                        -9.346e-01  8.285e-02  4.673e+02
TRT01ADummy C:AVISITN2                        -9.810e-01  8.363e-02  4.725e+02
TRT01ADummy A:AVISITN8                        -6.510e-01  5.605e-02  4.635e+02
TRT01ADummy B:AVISITN8                        -5.695e-01  7.832e-02  4.621e+02
TRT01ADummy C:AVISITN8                        -7.166e-01  7.915e-02  4.692e+02
TRT01ADummy A:AVISITN15                       -6.947e-01  5.904e-02  4.645e+02
TRT01ADummy B:AVISITN15                       -5.836e-01  8.230e-02  4.594e+02
TRT01ADummy C:AVISITN15                       -6.973e-01  8.296e-02  4.642e+02
TRT01ADummy A:AVISITN22                       -8.222e-01  6.503e-02  4.706e+02
TRT01ADummy B:AVISITN22                       -7.430e-01  9.089e-02  4.687e+02
TRT01ADummy C:AVISITN22                       -8.386e-01  9.160e-02  4.741e+02
TRT01ADummy A:AVISITN28                       -8.426e-01  6.419e-02  4.703e+02
TRT01ADummy B:AVISITN28                       -6.949e-01  8.984e-02  4.704e+02
TRT01ADummy C:AVISITN28                       -8.431e-01  9.026e-02  4.712e+02
TRT01ADummy A:AVISITN999                      -8.478e-01  6.413e-02  4.704e+02
TRT01ADummy B:AVISITN999                      -7.029e-01  8.975e-02  4.703e+02
TRT01ADummy C:AVISITN999                      -8.505e-01  9.018e-02  4.712e+02
                                              t value Pr(&gt;|t|)    
(Intercept)                                     4.797 2.25e-06 ***
TRT01ADummy B                                   0.042  0.96678    
TRT01ADummy C                                   1.183  0.23741    
SEXM                                           -0.969  0.33304    
SITEIDUS10002                                   0.644  0.51993    
SITEIDUS10004                                  -1.229  0.21977    
SITEIDUS10005                                   0.610  0.54227    
SITEIDUS10006                                  -1.082  0.27979    
SITEIDUS10008                                  -2.989  0.00297 ** 
SITEIDUS10009                                  -0.793  0.42801    
SITEIDUS10013                                   0.851  0.39515    
SITEIDUS10014                                   0.851  0.39523    
SITEIDUS10015                                   1.200  0.23089    
SITEIDUS10016                                  -1.131  0.25857    
SITEIDUS10017                                  -0.787  0.43159    
SITEIDUS10019                                  -0.492  0.62330    
SITEIDUS10020                                  -2.570  0.01050 *  
SITEIDUS10021                                  -1.251  0.21150    
SITEIDUS10023                                  -2.381  0.01772 *  
SITEIDUS10025                                   0.168  0.86671    
SITEIDUS10027                                  -0.684  0.49467    
SITEIDUS10029                                   0.368  0.71276    
SITEIDUS10030                                  -0.580  0.56242    
SITEIDUS10031                                  -0.356  0.72223    
SITEIDUS10033                                   0.003  0.99759    
SITEIDUS10034                                   0.193  0.84725    
SITEIDUS10036                                   2.399  0.01686 *  
SITEIDUS10039                                   1.544  0.12327    
SITEIDUS10040                                   0.384  0.70103    
SITEIDUS10041                                   0.927  0.35462    
SITEIDUS10043                                  -1.455  0.14654    
SITEIDUS10044                                  -0.445  0.65633    
SITEIDUS10045                                  -0.084  0.93330    
SITEIDUS10046                                   1.161  0.24619    
SITEIDUS10049                                   0.655  0.51274    
SITEIDUS10051                                  -0.722  0.47075    
SITEIDUS10053                                   1.078  0.28162    
SITEIDUS10055                                   0.092  0.92704    
SITEIDUS10056                                  -2.865  0.00438 ** 
SITEIDUS10057                                   0.505  0.61416    
SITEIDUS10058                                  -1.033  0.30204    
SITEIDUS10062                                   0.014  0.98890    
SITEIDUS10068                                   0.705  0.48119    
SITEIDUS10069                                   1.193  0.23357    
SITEIDUS10070                                  -1.097  0.27325    
SITEIDUS10071                                  -1.756  0.07974 .  
SITEIDUS10073                                  -0.303  0.76212    
SITEIDUS10074                                  -1.135  0.25699    
SITEIDUS10075                                  -0.068  0.94543    
SITEIDUS10076                                  -2.453  0.01458 *  
RACEASIAN                                      -0.713  0.47634    
RACEBLACK OR AFRICAN AMERICAN                  -1.481  0.13936    
RACEMULTIPLE                                   -1.630  0.10385    
RACENATIVE HAWAIIAN OR OTHER PACIFIC ISLANDER  -0.933  0.35130    
RACENOT REPORTED                               -0.607  0.54414    
RACEUNKNOWN                                    -0.864  0.38792    
RACEWHITE                                      -1.220  0.22316    
AGE                                             1.227  0.22045    
base_situation10-19                           -12.409  &lt; 2e-16 ***
base_situation20-39                           -20.780  &lt; 2e-16 ***
TRT01ADummy A:AVISITN2                        -16.977  &lt; 2e-16 ***
TRT01ADummy B:AVISITN2                        -11.280  &lt; 2e-16 ***
TRT01ADummy C:AVISITN2                        -11.730  &lt; 2e-16 ***
TRT01ADummy A:AVISITN8                        -11.615  &lt; 2e-16 ***
TRT01ADummy B:AVISITN8                         -7.272 1.53e-12 ***
TRT01ADummy C:AVISITN8                         -9.054  &lt; 2e-16 ***
TRT01ADummy A:AVISITN15                       -11.767  &lt; 2e-16 ***
TRT01ADummy B:AVISITN15                        -7.091 5.04e-12 ***
TRT01ADummy C:AVISITN15                        -8.405 5.26e-16 ***
TRT01ADummy A:AVISITN22                       -12.644  &lt; 2e-16 ***
TRT01ADummy B:AVISITN22                        -8.174 2.80e-15 ***
TRT01ADummy C:AVISITN22                        -9.155  &lt; 2e-16 ***
TRT01ADummy A:AVISITN28                       -13.128  &lt; 2e-16 ***
TRT01ADummy B:AVISITN28                        -7.735 6.34e-14 ***
TRT01ADummy C:AVISITN28                        -9.341  &lt; 2e-16 ***
TRT01ADummy A:AVISITN999                      -13.220  &lt; 2e-16 ***
TRT01ADummy B:AVISITN999                       -7.832 3.22e-14 ***
TRT01ADummy C:AVISITN999                       -9.432  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Covariance estimate:
         0      2      8     15     22     28    999
0   0.1287 0.0888 0.0953 0.0803 0.0868 0.0823 0.0825
2   0.0888 0.8656 0.5780 0.5356 0.5578 0.5590 0.5641
8   0.0953 0.5780 0.7920 0.6422 0.6594 0.6253 0.6281
15  0.0803 0.5356 0.6422 0.8390 0.7808 0.7318 0.7309
22  0.0868 0.5578 0.6594 0.7808 1.0246 0.8898 0.8910
28  0.0823 0.5590 0.6253 0.7318 0.8898 1.0037 0.9993
999 0.0825 0.5641 0.6281 0.7309 0.8910 0.9993 1.0028</code></pre>
</div>
</div>
</section>
<section id="draw-ci-1" class="level1">
<h1>draw ci</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 提取系数估计值和标准误差，并筛选出包含 "SITE" 的系数</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>coef_table <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(model_summary<span class="sc">$</span>coefficients)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算置信区间</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>coef_table<span class="sc">$</span>LowerCI <span class="ot">&lt;-</span> coef_table<span class="sc">$</span>Estimate <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> coef_table<span class="sc">$</span><span class="st">`</span><span class="at">Std. Error</span><span class="st">`</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>coef_table<span class="sc">$</span>UpperCI <span class="ot">&lt;-</span> coef_table<span class="sc">$</span>Estimate <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> coef_table<span class="sc">$</span><span class="st">`</span><span class="at">Std. Error</span><span class="st">`</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 美化P值显示</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>format_pvalue <span class="ot">&lt;-</span> <span class="cf">function</span>(p) {</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(p <span class="sc">&lt;</span> <span class="fl">0.001</span>, <span class="st">"&lt;0.001"</span>, </span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>         <span class="fu">ifelse</span>(p <span class="sc">&lt;</span> <span class="fl">0.01</span>, <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, p),</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>                <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, p)))</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>result_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="fu">rownames</span>(model_summary<span class="sc">$</span>coefficients),</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">Coefficient =</span> <span class="fu">round</span>(coef_table<span class="sc">$</span>Estimate, <span class="dv">3</span>),</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">CI =</span> <span class="fu">paste0</span>(<span class="st">"("</span>, <span class="fu">round</span>(coef_table<span class="sc">$</span>LowerCI, <span class="dv">3</span>), <span class="st">", "</span>, <span class="fu">round</span>(coef_table<span class="sc">$</span>UpperCI, <span class="dv">3</span>), <span class="st">")"</span>),</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">P-value</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sapply</span>(coef_table<span class="sc">$</span><span class="st">`</span><span class="at">Pr(&gt;|t|)</span><span class="st">`</span>, format_pvalue)</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>result_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                        variable Coefficient               CI
1                                    (Intercept)       1.801   (1.065, 2.538)
2                                  TRT01ADummy B       0.002  (-0.079, 0.082)
3                                  TRT01ADummy C       0.049  (-0.032, 0.131)
4                                           SEXM      -0.035  (-0.105, 0.035)
5                                  SITEIDUS10002       0.080  (-0.164, 0.325)
6                                  SITEIDUS10004      -0.212   (-0.55, 0.126)
7                                  SITEIDUS10005       0.221  (-0.489, 0.932)
8                                  SITEIDUS10006      -0.134  (-0.377, 0.109)
9                                  SITEIDUS10008      -0.567 (-0.939, -0.195)
10                                 SITEIDUS10009      -0.107   (-0.37, 0.157)
11                                 SITEIDUS10013       0.103  (-0.134, 0.339)
12                                 SITEIDUS10014       0.115   (-0.15, 0.381)
13                                 SITEIDUS10015       0.146  (-0.092, 0.383)
14                                 SITEIDUS10016      -0.296  (-0.809, 0.217)
15                                 SITEIDUS10017      -0.125  (-0.436, 0.186)
16                                 SITEIDUS10019      -0.066  (-0.331, 0.198)
17                                 SITEIDUS10020      -0.359 (-0.633, -0.085)
18                                 SITEIDUS10021      -0.147  (-0.377, 0.083)
19                                 SITEIDUS10023      -0.617 (-1.124, -0.109)
20                                 SITEIDUS10025       0.027  (-0.284, 0.338)
21                                 SITEIDUS10027      -0.178  (-0.688, 0.332)
22                                 SITEIDUS10029       0.040  (-0.173, 0.253)
23                                 SITEIDUS10030      -0.059   (-0.258, 0.14)
24                                 SITEIDUS10031      -0.054  (-0.351, 0.243)
25                                 SITEIDUS10033       0.000  (-0.305, 0.306)
26                                 SITEIDUS10034       0.033  (-0.303, 0.369)
27                                 SITEIDUS10036       0.302   (0.055, 0.549)
28                                 SITEIDUS10039       0.558   (-0.15, 1.266)
29                                 SITEIDUS10040       0.073  (-0.301, 0.448)
30                                 SITEIDUS10041       0.147  (-0.164, 0.457)
31                                 SITEIDUS10043      -0.170  (-0.398, 0.059)
32                                 SITEIDUS10044      -0.096  (-0.521, 0.328)
33                                 SITEIDUS10045      -0.016  (-0.386, 0.354)
34                                 SITEIDUS10046       0.185  (-0.127, 0.497)
35                                 SITEIDUS10049       0.104  (-0.206, 0.414)
36                                 SITEIDUS10051      -0.083  (-0.308, 0.142)
37                                 SITEIDUS10053       0.417  (-0.341, 1.175)
38                                 SITEIDUS10055       0.011  (-0.229, 0.252)
39                                 SITEIDUS10056      -0.374  (-0.63, -0.118)
40                                 SITEIDUS10057       0.069  (-0.199, 0.337)
41                                 SITEIDUS10058      -0.125  (-0.362, 0.112)
42                                 SITEIDUS10062       0.001  (-0.174, 0.176)
43                                 SITEIDUS10068       0.075  (-0.134, 0.284)
44                                 SITEIDUS10069       0.258  (-0.166, 0.681)
45                                 SITEIDUS10070      -0.096  (-0.268, 0.076)
46                                 SITEIDUS10071      -0.282  (-0.597, 0.033)
47                                 SITEIDUS10073      -0.109  (-0.818, 0.599)
48                                 SITEIDUS10074      -0.127  (-0.346, 0.092)
49                                 SITEIDUS10075      -0.006   (-0.18, 0.168)
50                                 SITEIDUS10076      -0.365 (-0.657, -0.073)
51                                     RACEASIAN      -0.272  (-1.021, 0.476)
52                 RACEBLACK OR AFRICAN AMERICAN      -0.553  (-1.286, 0.179)
53                                  RACEMULTIPLE      -0.641   (-1.411, 0.13)
54 RACENATIVE HAWAIIAN OR OTHER PACIFIC ISLANDER      -0.421  (-1.304, 0.463)
55                              RACENOT REPORTED      -0.252  (-1.066, 0.562)
56                                   RACEUNKNOWN      -0.452  (-1.476, 0.573)
57                                     RACEWHITE      -0.449   (-1.17, 0.272)
58                                           AGE       0.022  (-0.013, 0.058)
59                           base_situation10-19      -2.334 (-2.702, -1.965)
60                           base_situation20-39      -0.853 (-0.933, -0.772)
61                        TRT01ADummy A:AVISITN2      -1.006  (-1.122, -0.89)
62                        TRT01ADummy B:AVISITN2      -0.935 (-1.097, -0.772)
63                        TRT01ADummy C:AVISITN2      -0.981 (-1.145, -0.817)
64                        TRT01ADummy A:AVISITN8      -0.651 (-0.761, -0.541)
65                        TRT01ADummy B:AVISITN8      -0.570 (-0.723, -0.416)
66                        TRT01ADummy C:AVISITN8      -0.717 (-0.872, -0.561)
67                       TRT01ADummy A:AVISITN15      -0.695  (-0.81, -0.579)
68                       TRT01ADummy B:AVISITN15      -0.584 (-0.745, -0.422)
69                       TRT01ADummy C:AVISITN15      -0.697  (-0.86, -0.535)
70                       TRT01ADummy A:AVISITN22      -0.822  (-0.95, -0.695)
71                       TRT01ADummy B:AVISITN22      -0.743 (-0.921, -0.565)
72                       TRT01ADummy C:AVISITN22      -0.839 (-1.018, -0.659)
73                       TRT01ADummy A:AVISITN28      -0.843 (-0.968, -0.717)
74                       TRT01ADummy B:AVISITN28      -0.695 (-0.871, -0.519)
75                       TRT01ADummy C:AVISITN28      -0.843  (-1.02, -0.666)
76                      TRT01ADummy A:AVISITN999      -0.848 (-0.973, -0.722)
77                      TRT01ADummy B:AVISITN999      -0.703 (-0.879, -0.527)
78                      TRT01ADummy C:AVISITN999      -0.850 (-1.027, -0.674)
   P.value
1   &lt;0.001
2     0.97
3     0.24
4     0.33
5     0.52
6     0.22
7     0.54
8     0.28
9    0.003
10    0.43
11    0.40
12    0.40
13    0.23
14    0.26
15    0.43
16    0.62
17    0.01
18    0.21
19    0.02
20    0.87
21    0.49
22    0.71
23    0.56
24    0.72
25    1.00
26    0.85
27    0.02
28    0.12
29    0.70
30    0.35
31    0.15
32    0.66
33    0.93
34    0.25
35    0.51
36    0.47
37    0.28
38    0.93
39   0.004
40    0.61
41    0.30
42    0.99
43    0.48
44    0.23
45    0.27
46    0.08
47    0.76
48    0.26
49    0.95
50    0.01
51    0.48
52    0.14
53    0.10
54    0.35
55    0.54
56    0.39
57    0.22
58    0.22
59  &lt;0.001
60  &lt;0.001
61  &lt;0.001
62  &lt;0.001
63  &lt;0.001
64  &lt;0.001
65  &lt;0.001
66  &lt;0.001
67  &lt;0.001
68  &lt;0.001
69  &lt;0.001
70  &lt;0.001
71  &lt;0.001
72  &lt;0.001
73  &lt;0.001
74  &lt;0.001
75  &lt;0.001
76  &lt;0.001
77  &lt;0.001
78  &lt;0.001</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 导出到Excel</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co">#library(writexl)</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co">#write_xlsx(result_table, "mmrm_results.xlsx")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="lm" class="level1">
<h1>lm</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用 lm 拟合线性模型</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>fit_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> AVAL <span class="sc">~</span> AVISITN<span class="sc">:</span>TRT01A <span class="sc">+</span>TRT01A <span class="sc">+</span> SITEID<span class="sc">+</span> RACE <span class="sc">+</span> AGE <span class="sc">+</span> base_situation,</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> admadrs</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = AVAL ~ AVISITN:TRT01A + TRT01A + SITEID + RACE + 
    AGE + base_situation, data = admadrs)

Residuals:
    Min      1Q  Median      3Q     Max 
-2.7612 -0.4780  0.1187  0.5814  2.1366 

Coefficients:
                                              Estimate Std. Error t value
(Intercept)                                    1.71542    0.37155   4.617
TRT01ADummy B                                 -0.02879    0.09610  -0.300
TRT01ADummy C                                  0.04646    0.09678   0.480
SITEIDUS10002                                  0.02089    0.11608   0.180
SITEIDUS10004                                  0.12149    0.15902   0.764
SITEIDUS10005                                  0.24366    0.33050   0.737
SITEIDUS10006                                 -0.17280    0.11428  -1.512
SITEIDUS10008                                 -0.34969    0.19240  -1.817
SITEIDUS10009                                  0.24909    0.12509   1.991
SITEIDUS10013                                  0.56116    0.11016   5.094
SITEIDUS10014                                  0.17056    0.12858   1.326
SITEIDUS10015                                  0.03213    0.11271   0.285
SITEIDUS10016                                 -0.30379    0.30909  -0.983
SITEIDUS10017                                 -0.04176    0.15110  -0.276
SITEIDUS10019                                 -0.15188    0.12295  -1.235
SITEIDUS10020                                 -0.38872    0.12855  -3.024
SITEIDUS10021                                  0.27363    0.10667   2.565
SITEIDUS10023                                 -0.29919    0.25405  -1.178
SITEIDUS10025                                  0.31938    0.14496   2.203
SITEIDUS10027                                 -0.33069    0.23768  -1.391
SITEIDUS10029                                  0.03777    0.10003   0.378
SITEIDUS10030                                  0.01878    0.09352   0.201
SITEIDUS10031                                 -0.26735    0.13852  -1.930
SITEIDUS10033                                  0.19930    0.13631   1.462
SITEIDUS10034                                  0.30245    0.15667   1.931
SITEIDUS10036                                 -0.36938    0.11498  -3.213
SITEIDUS10039                                  1.00520    0.32949   3.051
SITEIDUS10040                                  0.12201    0.17742   0.688
SITEIDUS10041                                  0.15199    0.14525   1.046
SITEIDUS10043                                 -0.28370    0.11056  -2.566
SITEIDUS10044                                  0.26565    0.20138   1.319
SITEIDUS10045                                 -0.13825    0.17227  -0.803
SITEIDUS10046                                 -0.09002    0.14859  -0.606
SITEIDUS10049                                  0.28183    0.14436   1.952
SITEIDUS10051                                 -0.09597    0.10495  -0.914
SITEIDUS10053                                 -0.55402    0.35330  -1.568
SITEIDUS10055                                 -0.42579    0.11334  -3.757
SITEIDUS10056                                 -0.31387    0.12409  -2.529
SITEIDUS10057                                  0.47336    0.12656   3.740
SITEIDUS10058                                  0.15978    0.11139   1.434
SITEIDUS10062                                 -0.12712    0.08208  -1.549
SITEIDUS10068                                 -0.30722    0.09731  -3.157
SITEIDUS10069                                  0.79177    0.19707   4.018
SITEIDUS10070                                 -0.02214    0.08083  -0.274
SITEIDUS10071                                 -0.13676    0.14748  -0.927
SITEIDUS10073                                 -0.51585    0.35468  -1.454
SITEIDUS10074                                 -0.15776    0.10491  -1.504
SITEIDUS10075                                 -0.07545    0.08233  -0.916
SITEIDUS10076                                  0.20851    0.13704   1.522
RACEASIAN                                     -0.08511    0.37347  -0.228
RACEBLACK OR AFRICAN AMERICAN                 -0.38612    0.36620  -1.054
RACEMULTIPLE                                  -0.70294    0.38410  -1.830
RACENATIVE HAWAIIAN OR OTHER PACIFIC ISLANDER -0.24321    0.43215  -0.563
RACENOT REPORTED                               0.08491    0.40171   0.211
RACEUNKNOWN                                    0.60616    0.49442   1.226
RACEWHITE                                     -0.43075    0.36130  -1.192
AGE                                            0.07715    0.01666   4.631
base_situation10-19                           -1.69274    0.17404  -9.726
base_situation20-39                           -0.82355    0.03766 -21.871
AVISITN2:TRT01ADummy A                        -1.00458    0.07913 -12.696
AVISITN8:TRT01ADummy A                        -0.65815    0.07929  -8.301
AVISITN15:TRT01ADummy A                       -0.69466    0.07974  -8.711
AVISITN22:TRT01ADummy A                       -0.82964    0.08014 -10.352
AVISITN28:TRT01ADummy A                       -0.86057    0.07967 -10.802
AVISITN999:TRT01ADummy A                      -0.84786    0.07867 -10.777
AVISITN2:TRT01ADummy B                        -0.92254    0.11080  -8.326
AVISITN8:TRT01ADummy B                        -0.57217    0.11103  -5.153
AVISITN15:TRT01ADummy B                       -0.58461    0.11103  -5.265
AVISITN22:TRT01ADummy B                       -0.75172    0.11206  -6.708
AVISITN28:TRT01ADummy B                       -0.72849    0.11229  -6.488
AVISITN999:TRT01ADummy B                      -0.70291    0.11031  -6.372
AVISITN2:TRT01ADummy C                        -0.96668    0.11200  -8.631
AVISITN8:TRT01ADummy C                        -0.72971    0.11249  -6.487
AVISITN15:TRT01ADummy C                       -0.70641    0.11223  -6.294
AVISITN22:TRT01ADummy C                       -0.87271    0.11358  -7.684
AVISITN28:TRT01ADummy C                       -0.88039    0.11251  -7.825
AVISITN999:TRT01ADummy C                      -0.85249    0.11102  -7.679
                                              Pr(&gt;|t|)    
(Intercept)                                   4.05e-06 ***
TRT01ADummy B                                 0.764480    
TRT01ADummy C                                 0.631244    
SITEIDUS10002                                 0.857208    
SITEIDUS10004                                 0.444936    
SITEIDUS10005                                 0.461023    
SITEIDUS10006                                 0.130631    
SITEIDUS10008                                 0.069240 .  
SITEIDUS10009                                 0.046537 *  
SITEIDUS10013                                 3.71e-07 ***
SITEIDUS10014                                 0.184772    
SITEIDUS10015                                 0.775630    
SITEIDUS10016                                 0.325749    
SITEIDUS10017                                 0.782303    
SITEIDUS10019                                 0.216802    
SITEIDUS10020                                 0.002515 ** 
SITEIDUS10021                                 0.010359 *  
SITEIDUS10023                                 0.239007    
SITEIDUS10025                                 0.027647 *  
SITEIDUS10027                                 0.164221    
SITEIDUS10029                                 0.705780    
SITEIDUS10030                                 0.840871    
SITEIDUS10031                                 0.053694 .  
SITEIDUS10033                                 0.143797    
SITEIDUS10034                                 0.053631 .  
SITEIDUS10036                                 0.001328 ** 
SITEIDUS10039                                 0.002302 ** 
SITEIDUS10040                                 0.491681    
SITEIDUS10041                                 0.295448    
SITEIDUS10043                                 0.010332 *  
SITEIDUS10044                                 0.187200    
SITEIDUS10045                                 0.422316    
SITEIDUS10046                                 0.544646    
SITEIDUS10049                                 0.050997 .  
SITEIDUS10051                                 0.360574    
SITEIDUS10053                                 0.116949    
SITEIDUS10055                                 0.000175 ***
SITEIDUS10056                                 0.011475 *  
SITEIDUS10057                                 0.000187 ***
SITEIDUS10058                                 0.151531    
SITEIDUS10062                                 0.121524    
SITEIDUS10068                                 0.001609 ** 
SITEIDUS10069                                 6.01e-05 ***
SITEIDUS10070                                 0.784170    
SITEIDUS10071                                 0.353804    
SITEIDUS10073                                 0.145940    
SITEIDUS10074                                 0.132736    
SITEIDUS10075                                 0.359513    
SITEIDUS10076                                 0.128221    
RACEASIAN                                     0.819740    
RACEBLACK OR AFRICAN AMERICAN                 0.291789    
RACEMULTIPLE                                  0.067334 .  
RACENATIVE HAWAIIAN OR OTHER PACIFIC ISLANDER 0.573612    
RACENOT REPORTED                              0.832604    
RACEUNKNOWN                                   0.220285    
RACEWHITE                                     0.233258    
AGE                                           3.78e-06 ***
base_situation10-19                            &lt; 2e-16 ***
base_situation20-39                            &lt; 2e-16 ***
AVISITN2:TRT01ADummy A                         &lt; 2e-16 ***
AVISITN8:TRT01ADummy A                         &lt; 2e-16 ***
AVISITN15:TRT01ADummy A                        &lt; 2e-16 ***
AVISITN22:TRT01ADummy A                        &lt; 2e-16 ***
AVISITN28:TRT01ADummy A                        &lt; 2e-16 ***
AVISITN999:TRT01ADummy A                       &lt; 2e-16 ***
AVISITN2:TRT01ADummy B                         &lt; 2e-16 ***
AVISITN8:TRT01ADummy B                        2.72e-07 ***
AVISITN15:TRT01ADummy B                       1.49e-07 ***
AVISITN22:TRT01ADummy B                       2.33e-11 ***
AVISITN28:TRT01ADummy B                       1.01e-10 ***
AVISITN999:TRT01ADummy B                      2.14e-10 ***
AVISITN2:TRT01ADummy C                         &lt; 2e-16 ***
AVISITN8:TRT01ADummy C                        1.01e-10 ***
AVISITN15:TRT01ADummy C                       3.52e-10 ***
AVISITN22:TRT01ADummy C                       2.05e-14 ***
AVISITN28:TRT01ADummy C                       6.87e-15 ***
AVISITN999:TRT01ADummy C                      2.13e-14 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.8545 on 3137 degrees of freedom
  (1 observation deleted due to missingness)
Multiple R-squared:  0.2873,    Adjusted R-squared:  0.2701 
F-statistic: 16.64 on 76 and 3137 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(fit_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8188.17</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">BIC</span>(fit_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8662.041</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logLik</span>(fit_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'log Lik.' -4016.085 (df=78)</code></pre>
</div>
</div>
</section>
<section id="draw-subgroups" class="level1">
<h1>draw subgroups</h1>
<section id="to-24-young-adults" class="level2">
<h2 class="anchored" data-anchor-id="to-24-young-adults">≥18 to 24 young adults</h2>
<div class="sourceCode" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 加载必要的包</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mmrm)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>?mmrm</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 读取数据</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>admadrs <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"/Users/qiujiahui/Desktop/≥18 to 24 young adults.xlsx"</span>, </span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sheet =</span> <span class="st">"Sheet1"</span>, <span class="at">col_names =</span> <span class="cn">TRUE</span>, </span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">col_types =</span> <span class="cn">NULL</span>, <span class="at">na =</span> <span class="st">""</span>, <span class="at">skip =</span> <span class="dv">0</span>)</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(admadrs)</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 删除重复的时间点</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>admadrs <span class="ot">&lt;-</span> admadrs[<span class="sc">!</span><span class="fu">duplicated</span>(admadrs[<span class="fu">c</span>(<span class="st">"USUBJID"</span>, <span class="st">"AVISIT"</span>)]), ]</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 将相关列转换为因子</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>USUBJID <span class="ot">&lt;-</span> <span class="fu">factor</span>(admadrs<span class="sc">$</span>USUBJID)</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>AVISITN <span class="ot">&lt;-</span> <span class="fu">factor</span>(admadrs<span class="sc">$</span>AVISITN)</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>ADY <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(admadrs<span class="sc">$</span>ADY)</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>SITEID <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(admadrs<span class="sc">$</span>SITEID)</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>TRTSEQA <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(admadrs<span class="sc">$</span>TRTSEQA)</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>BASE <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(admadrs<span class="sc">$</span>BASE)</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 将 TRT01A 转换为因子，并重新编码参考水平</span></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>TRT01A <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(admadrs<span class="sc">$</span>TRT01A)</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>TRT01A <span class="ot">&lt;-</span> <span class="fu">relevel</span>(admadrs<span class="sc">$</span>TRT01A, <span class="at">ref =</span> <span class="st">"Dummy A"</span>)</span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a><span class="co">#admadrs$AVISITN &lt;- relevel(admadrs$AVISITN, ref = "")</span></span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a><span class="co"># 对数值型变量进行归一化处理</span></span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(admadrs<span class="sc">$</span>BASE)</span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a><span class="co"># 拟合模型</span></span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">mmrm</span>(</span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> AVAL <span class="sc">~</span> AVISITN<span class="sc">:</span>TRT01A <span class="sc">+</span> TRT01A<span class="sc">+</span> SEX <span class="sc">+</span> RACE <span class="sc">+</span> SITEID  <span class="sc">+</span> <span class="fu">us</span>(AVISITN <span class="sc">|</span> USUBJID),</span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> admadrs</span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看模型结果</span></span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a>model_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(fit)</span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(model_summary)</span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="to-24-young-adults-分析" class="level2">
<h2 class="anchored" data-anchor-id="to-24-young-adults-分析">≥18 to 24 young adults 分析</h2>
<div class="sourceCode" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 加载必要的包</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="do">############## 年龄组分析 ##############</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">### 年龄组分析 ###</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 重新计算边际均值</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>emm_young <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(fit, <span class="sc">~</span> AVISITN <span class="sc">|</span> TRT01A)</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(emm_young)</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 基线和时间点设置</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>baseline_level <span class="ot">&lt;-</span> <span class="st">"0"</span>  <span class="co"># 假设基线是0，请调整为实际值</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 获取AVISITN的水平</span></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>avisitn_levels <span class="ot">&lt;-</span> <span class="fu">levels</span>(admadrs<span class="sc">$</span>AVISITN)</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>time_points <span class="ot">&lt;-</span> avisitn_levels[avisitn_levels <span class="sc">!=</span> baseline_level]</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 如果AVISITN是数值而不是因子</span></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(avisitn_levels) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"AVISITN似乎不是因子或没有水平，尝试获取唯一值...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>  avisitn_values <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(admadrs<span class="sc">$</span>AVISITN))</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>  avisitn_values <span class="ot">&lt;-</span> <span class="fu">as.character</span>(avisitn_values)</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>  baseline_level <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">min</span>(<span class="fu">as.numeric</span>(avisitn_values)))</span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>  time_points <span class="ot">&lt;-</span> avisitn_values[avisitn_values <span class="sc">!=</span> baseline_level]</span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"基线:"</span>, baseline_level, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"比较时间点:"</span>, time_points, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a><span class="co"># 执行对比分析</span></span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a><span class="fu">tryCatch</span>({</span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 对每个治疗组，计算各时间点与基线的对比</span></span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>  comparisons_young <span class="ot">&lt;-</span> <span class="fu">contrast</span>(emm_young, <span class="at">method =</span> <span class="st">"revpairwise"</span>, <span class="at">by =</span> <span class="st">"TRT01A"</span>)</span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">年轻成人组的时间点比较:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(comparisons_young)</span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 保存结果</span></span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a>  results_young <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(comparisons_young)</span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a>  results_young<span class="sc">$</span>AgeGroup <span class="ot">&lt;-</span> <span class="st">"Young Adults (18-24)"</span></span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>}, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"年轻成人组的对比分析出错:"</span>, <span class="fu">conditionMessage</span>(e), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a>  results_young <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="middle-aged-adults-24-to-55-years" class="level2">
<h2 class="anchored" data-anchor-id="middle-aged-adults-24-to-55-years">middle-aged adults (≥24 to 55 years)</h2>
<div class="sourceCode" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 加载必要的包</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mmrm)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>?mmrm</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 读取数据</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>admadrs <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"/Users/qiujiahui/Desktop/≥24 to 55 middle-aged adults.xlsx"</span>, </span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sheet =</span> <span class="st">"Sheet1"</span>, <span class="at">col_names =</span> <span class="cn">TRUE</span>, </span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">col_types =</span> <span class="cn">NULL</span>, <span class="at">na =</span> <span class="st">""</span>, <span class="at">skip =</span> <span class="dv">0</span>)</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(admadrs)</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 删除重复的时间点</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>admadrs <span class="ot">&lt;-</span> admadrs[<span class="sc">!</span><span class="fu">duplicated</span>(admadrs[<span class="fu">c</span>(<span class="st">"USUBJID"</span>, <span class="st">"AVISIT"</span>)]), ]</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 将相关列转换为因子</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>USUBJID <span class="ot">&lt;-</span> <span class="fu">factor</span>(admadrs<span class="sc">$</span>USUBJID)</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>AVISITN <span class="ot">&lt;-</span> <span class="fu">factor</span>(admadrs<span class="sc">$</span>AVISITN)</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>ADY <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(admadrs<span class="sc">$</span>ADY)</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>SITEID <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(admadrs<span class="sc">$</span>SITEID)</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>TRTSEQA <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(admadrs<span class="sc">$</span>TRTSEQA)</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>BASE <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(admadrs<span class="sc">$</span>BASE)</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 将 TRT01A 转换为因子，并重新编码参考水平</span></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>TRT01A <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(admadrs<span class="sc">$</span>TRT01A)</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>TRT01A <span class="ot">&lt;-</span> <span class="fu">relevel</span>(admadrs<span class="sc">$</span>TRT01A, <span class="at">ref =</span> <span class="st">"Dummy A"</span>)</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a><span class="co">#admadrs$AVISITN &lt;- relevel(admadrs$AVISITN, ref = "")</span></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a><span class="co"># 对数值型变量进行归一化处理</span></span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(admadrs<span class="sc">$</span>BASE)</span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a><span class="co"># 拟合模型</span></span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">mmrm</span>(</span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> AVAL <span class="sc">~</span> AVISITN<span class="sc">:</span>TRT01A <span class="sc">+</span> TRT01A<span class="sc">+</span> SEX <span class="sc">+</span> RACE <span class="sc">+</span> SITEID  <span class="sc">+</span> <span class="fu">us</span>(AVISITN <span class="sc">|</span> USUBJID),</span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> admadrs</span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看模型结果</span></span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a>model_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(fit)</span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(model_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="middle-aged-adults-24-to-55-years分析" class="level2">
<h2 class="anchored" data-anchor-id="middle-aged-adults-24-to-55-years分析">middle-aged adults (≥24 to 55 years)分析</h2>
<div class="sourceCode" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="do">############## 中年成人分析 ##############</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 读取中年成人数据并拟合模型</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co"># (假设这里已经完成)</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">### 中年成人组分析 ###</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 重新计算边际均值</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>emm_middle <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(fit, <span class="sc">~</span> AVISITN <span class="sc">|</span> TRT01A)</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(emm_middle)</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 执行对比分析</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a><span class="fu">tryCatch</span>({</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 对每个治疗组，计算各时间点与基线的对比</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>  comparisons_middle <span class="ot">&lt;-</span> <span class="fu">contrast</span>(emm_middle, <span class="at">method =</span> <span class="st">"revpairwise"</span>, <span class="at">by =</span> <span class="st">"TRT01A"</span>)</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">中年成人组的时间点比较:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(comparisons_middle)</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 保存结果</span></span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>  results_middle <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(comparisons_middle)</span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>  results_middle<span class="sc">$</span>AgeGroup <span class="ot">&lt;-</span> <span class="st">"Middle-Aged Adults (24-55)"</span></span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>}, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"中年成人组的对比分析出错:"</span>, <span class="fu">conditionMessage</span>(e), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a>  results_middle <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="older-adults" class="level2">
<h2 class="anchored" data-anchor-id="older-adults">≥55 older adults</h2>
<div class="sourceCode" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 加载必要的包</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mmrm)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>?mmrm</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 读取数据</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>admadrs <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"/Users/qiujiahui/Desktop/≥55 older adults.xlsx"</span>, </span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sheet =</span> <span class="st">"Sheet1"</span>, <span class="at">col_names =</span> <span class="cn">TRUE</span>, </span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">col_types =</span> <span class="cn">NULL</span>, <span class="at">na =</span> <span class="st">""</span>, <span class="at">skip =</span> <span class="dv">0</span>)</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(admadrs)</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 删除重复的时间点</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>admadrs <span class="ot">&lt;-</span> admadrs[<span class="sc">!</span><span class="fu">duplicated</span>(admadrs[<span class="fu">c</span>(<span class="st">"USUBJID"</span>, <span class="st">"AVISIT"</span>)]), ]</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 将相关列转换为因子</span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>USUBJID <span class="ot">&lt;-</span> <span class="fu">factor</span>(admadrs<span class="sc">$</span>USUBJID)</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>AVISITN <span class="ot">&lt;-</span> <span class="fu">factor</span>(admadrs<span class="sc">$</span>AVISITN)</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>ADY <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(admadrs<span class="sc">$</span>ADY)</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>SITEID <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(admadrs<span class="sc">$</span>SITEID)</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>TRTSEQA <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(admadrs<span class="sc">$</span>TRTSEQA)</span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>BASE <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(admadrs<span class="sc">$</span>BASE)</span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 将 TRT01A 转换为因子，并重新编码参考水平</span></span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>TRT01A <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(admadrs<span class="sc">$</span>TRT01A)</span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>TRT01A <span class="ot">&lt;-</span> <span class="fu">relevel</span>(admadrs<span class="sc">$</span>TRT01A, <span class="at">ref =</span> <span class="st">"Dummy A"</span>)</span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a><span class="co">#admadrs$AVISITN &lt;- relevel(admadrs$AVISITN, ref = "")</span></span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a><span class="co"># 对数值型变量进行归一化处理</span></span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(admadrs<span class="sc">$</span>BASE)</span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a><span class="co"># 拟合模型</span></span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">mmrm</span>(</span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> AVAL <span class="sc">~</span> AVISITN<span class="sc">:</span>TRT01A <span class="sc">+</span> TRT01A<span class="sc">+</span> SEX <span class="sc">+</span> RACE <span class="sc">+</span> SITEID  <span class="sc">+</span> <span class="fu">us</span>(AVISITN <span class="sc">|</span> USUBJID),</span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> admadrs</span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看模型结果</span></span>
<span id="cb59-42"><a href="#cb59-42" aria-hidden="true" tabindex="-1"></a>model_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(fit)</span>
<span id="cb59-43"><a href="#cb59-43" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(model_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="older-adults-分析" class="level2">
<h2 class="anchored" data-anchor-id="older-adults-分析">≥55 older adults 分析</h2>
<div class="sourceCode" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="do">############## 老年成人分析 ##############</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 读取老年成人数据并拟合模型</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co"># (假设这里已经完成)</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">### 老年成人组分析 ###</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 重新计算边际均值</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>emm_older <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(fit, <span class="sc">~</span> AVISITN <span class="sc">|</span> TRT01A)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(emm_older)</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 执行对比分析</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a><span class="fu">tryCatch</span>({</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 对每个治疗组，计算各时间点与基线的对比</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>  comparisons_older <span class="ot">&lt;-</span> <span class="fu">contrast</span>(emm_older, <span class="at">method =</span> <span class="st">"revpairwise"</span>, <span class="at">by =</span> <span class="st">"TRT01A"</span>)</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">老年成人组的时间点比较:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(comparisons_older)</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 保存结果</span></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>  results_older <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(comparisons_older)</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>  results_older<span class="sc">$</span>AgeGroup <span class="ot">&lt;-</span> <span class="st">"Older Adults (55+)"</span></span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>}, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"老年成人组的对比分析出错:"</span>, <span class="fu">conditionMessage</span>(e), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>  results_older <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="年龄组疗效" class="level2">
<h2 class="anchored" data-anchor-id="年龄组疗效">年龄组疗效</h2>
<div class="sourceCode" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="do">############## 比较不同年龄组疗效差异 ##############</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">### 比较不同年龄组疗效差异 ###</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 在合并数据之前确保AgeGroup标签正确</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>results_young<span class="sc">$</span>AgeGroup <span class="ot">&lt;-</span> <span class="st">"Young Adults (18-24)"</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>results_middle<span class="sc">$</span>AgeGroup <span class="ot">&lt;-</span> <span class="st">"Middle-Aged Adults (24-55)"</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>results_older<span class="sc">$</span>AgeGroup <span class="ot">&lt;-</span> <span class="st">"Older Adults (55+)"</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 合并数据</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>combined_results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(results_young, results_middle, results_older)</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 提取对比信息，并简化时间点标签</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>combined_results<span class="sc">$</span>TimeComparison <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">" - .*$"</span>, <span class="st">""</span>, combined_results<span class="sc">$</span>contrast)</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用更简洁的时间点标签，例如T1, T2, T3...</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>combined_results<span class="sc">$</span>TimePoint <span class="ot">&lt;-</span> <span class="fu">factor</span>(combined_results<span class="sc">$</span>TimeComparison, </span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">levels =</span> <span class="fu">unique</span>(combined_results<span class="sc">$</span>TimeComparison),</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">labels =</span> <span class="fu">paste0</span>(<span class="st">"T"</span>, <span class="fu">seq_along</span>(<span class="fu">unique</span>(combined_results<span class="sc">$</span>TimeComparison))))</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建改进的交互图</span></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(combined_results, <span class="fu">aes</span>(<span class="at">x =</span> TimePoint, <span class="at">y =</span> estimate, <span class="at">color =</span> TRT01A, </span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>                               <span class="at">group =</span> <span class="fu">interaction</span>(TRT01A, AgeGroup), </span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>                               <span class="at">linetype =</span> AgeGroup)) <span class="sc">+</span></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> estimate <span class="sc">-</span> SE, <span class="at">ymax =</span> estimate <span class="sc">+</span> SE), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> TRT01A) <span class="sc">+</span></span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Comparison of Treatment Effects Across Age Groups"</span>,</span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Changes compared to baseline"</span>,</span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Time Point"</span>,</span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Estimated Difference"</span>,</span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Treatment Group"</span>,</span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">linetype =</span> <span class="st">"Age Group"</span>) <span class="sc">+</span></span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 改进x轴标签显示</span></span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">8</span>),  <span class="co"># 倾斜标签并减小字体</span></span>
<span id="cb61-37"><a href="#cb61-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,  <span class="co"># 将图例放在底部</span></span>
<span id="cb61-38"><a href="#cb61-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.box =</span> <span class="st">"vertical"</span>  <span class="co"># 垂直排列图例</span></span>
<span id="cb61-39"><a href="#cb61-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb61-40"><a href="#cb61-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-41"><a href="#cb61-41" aria-hidden="true" tabindex="-1"></a><span class="co"># 打印图表</span></span>
<span id="cb61-42"><a href="#cb61-42" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb61-43"><a href="#cb61-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-44"><a href="#cb61-44" aria-hidden="true" tabindex="-1"></a><span class="co"># 添加时间点说明表格</span></span>
<span id="cb61-45"><a href="#cb61-45" aria-hidden="true" tabindex="-1"></a>time_point_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb61-46"><a href="#cb61-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">TimePointLabel =</span> <span class="fu">paste0</span>(<span class="st">"T"</span>, <span class="fu">seq_along</span>(<span class="fu">unique</span>(combined_results<span class="sc">$</span>TimeComparison))),</span>
<span id="cb61-47"><a href="#cb61-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">OriginalTimePoint =</span> <span class="fu">unique</span>(combined_results<span class="sc">$</span>TimeComparison)</span>
<span id="cb61-48"><a href="#cb61-48" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-49"><a href="#cb61-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-50"><a href="#cb61-50" aria-hidden="true" tabindex="-1"></a><span class="co"># 打印时间点对照表</span></span>
<span id="cb61-51"><a href="#cb61-51" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Time Point Reference Table:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-52"><a href="#cb61-52" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(time_point_table)</span>
<span id="cb61-53"><a href="#cb61-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-54"><a href="#cb61-54" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建一个函数提取特定对比和治疗组的结果</span></span>
<span id="cb61-55"><a href="#cb61-55" aria-hidden="true" tabindex="-1"></a>get_result <span class="ot">&lt;-</span> <span class="cf">function</span>(results_df, contrast_pattern, trt) {</span>
<span id="cb61-56"><a href="#cb61-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(results_df, <span class="fu">grepl</span>(contrast_pattern, contrast) <span class="sc">&amp;</span> TRT01A <span class="sc">==</span> trt)</span>
<span id="cb61-57"><a href="#cb61-57" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-58"><a href="#cb61-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-59"><a href="#cb61-59" aria-hidden="true" tabindex="-1"></a><span class="co"># 定义要比较的对比模式（如0 vs 2, 0 vs 8等）</span></span>
<span id="cb61-60"><a href="#cb61-60" aria-hidden="true" tabindex="-1"></a>contrast_patterns <span class="ot">&lt;-</span> <span class="fu">paste0</span>(baseline_level, <span class="st">" - "</span>, time_points)</span>
<span id="cb61-61"><a href="#cb61-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-62"><a href="#cb61-62" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建数据框用于年龄组间比较</span></span>
<span id="cb61-63"><a href="#cb61-63" aria-hidden="true" tabindex="-1"></a><span class="co"># 年轻成人 vs 中年成人</span></span>
<span id="cb61-64"><a href="#cb61-64" aria-hidden="true" tabindex="-1"></a>young_vs_middle_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb61-65"><a href="#cb61-65" aria-hidden="true" tabindex="-1"></a><span class="co"># 年轻成人 vs 老年成人</span></span>
<span id="cb61-66"><a href="#cb61-66" aria-hidden="true" tabindex="-1"></a>young_vs_older_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb61-67"><a href="#cb61-67" aria-hidden="true" tabindex="-1"></a><span class="co"># 中年成人 vs 老年成人</span></span>
<span id="cb61-68"><a href="#cb61-68" aria-hidden="true" tabindex="-1"></a>middle_vs_older_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb61-69"><a href="#cb61-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-70"><a href="#cb61-70" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(pattern <span class="cf">in</span> contrast_patterns) {</span>
<span id="cb61-71"><a href="#cb61-71" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(trt <span class="cf">in</span> <span class="fu">unique</span>(combined_results<span class="sc">$</span>TRT01A)) {</span>
<span id="cb61-72"><a href="#cb61-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 获取三个年龄组的结果</span></span>
<span id="cb61-73"><a href="#cb61-73" aria-hidden="true" tabindex="-1"></a>    young_result <span class="ot">&lt;-</span> <span class="fu">get_result</span>(results_young, pattern, trt)</span>
<span id="cb61-74"><a href="#cb61-74" aria-hidden="true" tabindex="-1"></a>    middle_result <span class="ot">&lt;-</span> <span class="fu">get_result</span>(results_middle, pattern, trt)</span>
<span id="cb61-75"><a href="#cb61-75" aria-hidden="true" tabindex="-1"></a>    older_result <span class="ot">&lt;-</span> <span class="fu">get_result</span>(results_older, pattern, trt)</span>
<span id="cb61-76"><a href="#cb61-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-77"><a href="#cb61-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 年轻vs中年</span></span>
<span id="cb61-78"><a href="#cb61-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">nrow</span>(young_result) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">nrow</span>(middle_result) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb61-79"><a href="#cb61-79" aria-hidden="true" tabindex="-1"></a>      diff_estimate <span class="ot">&lt;-</span> young_result<span class="sc">$</span>estimate <span class="sc">-</span> middle_result<span class="sc">$</span>estimate</span>
<span id="cb61-80"><a href="#cb61-80" aria-hidden="true" tabindex="-1"></a>      diff_se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(young_result<span class="sc">$</span>SE<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> middle_result<span class="sc">$</span>SE<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb61-81"><a href="#cb61-81" aria-hidden="true" tabindex="-1"></a>      z_stat <span class="ot">&lt;-</span> diff_estimate <span class="sc">/</span> diff_se</span>
<span id="cb61-82"><a href="#cb61-82" aria-hidden="true" tabindex="-1"></a>      p_value <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(<span class="fu">abs</span>(z_stat)))</span>
<span id="cb61-83"><a href="#cb61-83" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb61-84"><a href="#cb61-84" aria-hidden="true" tabindex="-1"></a>      young_vs_middle_table <span class="ot">&lt;-</span> <span class="fu">rbind</span>(young_vs_middle_table, <span class="fu">data.frame</span>(</span>
<span id="cb61-85"><a href="#cb61-85" aria-hidden="true" tabindex="-1"></a>        <span class="at">Contrast =</span> pattern,</span>
<span id="cb61-86"><a href="#cb61-86" aria-hidden="true" tabindex="-1"></a>        <span class="at">TRT01A =</span> trt,</span>
<span id="cb61-87"><a href="#cb61-87" aria-hidden="true" tabindex="-1"></a>        <span class="at">Young_Est =</span> young_result<span class="sc">$</span>estimate,</span>
<span id="cb61-88"><a href="#cb61-88" aria-hidden="true" tabindex="-1"></a>        <span class="at">Young_SE =</span> young_result<span class="sc">$</span>SE,</span>
<span id="cb61-89"><a href="#cb61-89" aria-hidden="true" tabindex="-1"></a>        <span class="at">Middle_Est =</span> middle_result<span class="sc">$</span>estimate,</span>
<span id="cb61-90"><a href="#cb61-90" aria-hidden="true" tabindex="-1"></a>        <span class="at">Middle_SE =</span> middle_result<span class="sc">$</span>SE,</span>
<span id="cb61-91"><a href="#cb61-91" aria-hidden="true" tabindex="-1"></a>        <span class="at">Diff_Est =</span> diff_estimate,</span>
<span id="cb61-92"><a href="#cb61-92" aria-hidden="true" tabindex="-1"></a>        <span class="at">Diff_SE =</span> diff_se,</span>
<span id="cb61-93"><a href="#cb61-93" aria-hidden="true" tabindex="-1"></a>        <span class="at">Z_stat =</span> z_stat,</span>
<span id="cb61-94"><a href="#cb61-94" aria-hidden="true" tabindex="-1"></a>        <span class="at">P_value =</span> p_value</span>
<span id="cb61-95"><a href="#cb61-95" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb61-96"><a href="#cb61-96" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb61-97"><a href="#cb61-97" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-98"><a href="#cb61-98" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 年轻vs老年</span></span>
<span id="cb61-99"><a href="#cb61-99" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">nrow</span>(young_result) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">nrow</span>(older_result) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb61-100"><a href="#cb61-100" aria-hidden="true" tabindex="-1"></a>      diff_estimate <span class="ot">&lt;-</span> young_result<span class="sc">$</span>estimate <span class="sc">-</span> older_result<span class="sc">$</span>estimate</span>
<span id="cb61-101"><a href="#cb61-101" aria-hidden="true" tabindex="-1"></a>      diff_se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(young_result<span class="sc">$</span>SE<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> older_result<span class="sc">$</span>SE<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb61-102"><a href="#cb61-102" aria-hidden="true" tabindex="-1"></a>      z_stat <span class="ot">&lt;-</span> diff_estimate <span class="sc">/</span> diff_se</span>
<span id="cb61-103"><a href="#cb61-103" aria-hidden="true" tabindex="-1"></a>      p_value <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(<span class="fu">abs</span>(z_stat)))</span>
<span id="cb61-104"><a href="#cb61-104" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb61-105"><a href="#cb61-105" aria-hidden="true" tabindex="-1"></a>      young_vs_older_table <span class="ot">&lt;-</span> <span class="fu">rbind</span>(young_vs_older_table, <span class="fu">data.frame</span>(</span>
<span id="cb61-106"><a href="#cb61-106" aria-hidden="true" tabindex="-1"></a>        <span class="at">Contrast =</span> pattern,</span>
<span id="cb61-107"><a href="#cb61-107" aria-hidden="true" tabindex="-1"></a>        <span class="at">TRT01A =</span> trt,</span>
<span id="cb61-108"><a href="#cb61-108" aria-hidden="true" tabindex="-1"></a>        <span class="at">Young_Est =</span> young_result<span class="sc">$</span>estimate,</span>
<span id="cb61-109"><a href="#cb61-109" aria-hidden="true" tabindex="-1"></a>        <span class="at">Young_SE =</span> young_result<span class="sc">$</span>SE,</span>
<span id="cb61-110"><a href="#cb61-110" aria-hidden="true" tabindex="-1"></a>        <span class="at">Older_Est =</span> older_result<span class="sc">$</span>estimate,</span>
<span id="cb61-111"><a href="#cb61-111" aria-hidden="true" tabindex="-1"></a>        <span class="at">Older_SE =</span> older_result<span class="sc">$</span>SE,</span>
<span id="cb61-112"><a href="#cb61-112" aria-hidden="true" tabindex="-1"></a>        <span class="at">Diff_Est =</span> diff_estimate,</span>
<span id="cb61-113"><a href="#cb61-113" aria-hidden="true" tabindex="-1"></a>        <span class="at">Diff_SE =</span> diff_se,</span>
<span id="cb61-114"><a href="#cb61-114" aria-hidden="true" tabindex="-1"></a>        <span class="at">Z_stat =</span> z_stat,</span>
<span id="cb61-115"><a href="#cb61-115" aria-hidden="true" tabindex="-1"></a>        <span class="at">P_value =</span> p_value</span>
<span id="cb61-116"><a href="#cb61-116" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb61-117"><a href="#cb61-117" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb61-118"><a href="#cb61-118" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-119"><a href="#cb61-119" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 中年vs老年</span></span>
<span id="cb61-120"><a href="#cb61-120" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">nrow</span>(middle_result) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">nrow</span>(older_result) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb61-121"><a href="#cb61-121" aria-hidden="true" tabindex="-1"></a>      diff_estimate <span class="ot">&lt;-</span> middle_result<span class="sc">$</span>estimate <span class="sc">-</span> older_result<span class="sc">$</span>estimate</span>
<span id="cb61-122"><a href="#cb61-122" aria-hidden="true" tabindex="-1"></a>      diff_se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(middle_result<span class="sc">$</span>SE<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> older_result<span class="sc">$</span>SE<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb61-123"><a href="#cb61-123" aria-hidden="true" tabindex="-1"></a>      z_stat <span class="ot">&lt;-</span> diff_estimate <span class="sc">/</span> diff_se</span>
<span id="cb61-124"><a href="#cb61-124" aria-hidden="true" tabindex="-1"></a>      p_value <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(<span class="fu">abs</span>(z_stat)))</span>
<span id="cb61-125"><a href="#cb61-125" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb61-126"><a href="#cb61-126" aria-hidden="true" tabindex="-1"></a>      middle_vs_older_table <span class="ot">&lt;-</span> <span class="fu">rbind</span>(middle_vs_older_table, <span class="fu">data.frame</span>(</span>
<span id="cb61-127"><a href="#cb61-127" aria-hidden="true" tabindex="-1"></a>        <span class="at">Contrast =</span> pattern,</span>
<span id="cb61-128"><a href="#cb61-128" aria-hidden="true" tabindex="-1"></a>        <span class="at">TRT01A =</span> trt,</span>
<span id="cb61-129"><a href="#cb61-129" aria-hidden="true" tabindex="-1"></a>        <span class="at">Middle_Est =</span> middle_result<span class="sc">$</span>estimate,</span>
<span id="cb61-130"><a href="#cb61-130" aria-hidden="true" tabindex="-1"></a>        <span class="at">Middle_SE =</span> middle_result<span class="sc">$</span>SE,</span>
<span id="cb61-131"><a href="#cb61-131" aria-hidden="true" tabindex="-1"></a>        <span class="at">Older_Est =</span> older_result<span class="sc">$</span>estimate,</span>
<span id="cb61-132"><a href="#cb61-132" aria-hidden="true" tabindex="-1"></a>        <span class="at">Older_SE =</span> older_result<span class="sc">$</span>SE,</span>
<span id="cb61-133"><a href="#cb61-133" aria-hidden="true" tabindex="-1"></a>        <span class="at">Diff_Est =</span> diff_estimate,</span>
<span id="cb61-134"><a href="#cb61-134" aria-hidden="true" tabindex="-1"></a>        <span class="at">Diff_SE =</span> diff_se,</span>
<span id="cb61-135"><a href="#cb61-135" aria-hidden="true" tabindex="-1"></a>        <span class="at">Z_stat =</span> z_stat,</span>
<span id="cb61-136"><a href="#cb61-136" aria-hidden="true" tabindex="-1"></a>        <span class="at">P_value =</span> p_value</span>
<span id="cb61-137"><a href="#cb61-137" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb61-138"><a href="#cb61-138" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb61-139"><a href="#cb61-139" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb61-140"><a href="#cb61-140" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-141"><a href="#cb61-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-142"><a href="#cb61-142" aria-hidden="true" tabindex="-1"></a><span class="co"># 输出比较结果</span></span>
<span id="cb61-143"><a href="#cb61-143" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">年轻成人 vs. 中年成人组疗效比较:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-144"><a href="#cb61-144" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">nrow</span>(young_vs_middle_table) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb61-145"><a href="#cb61-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(young_vs_middle_table)</span>
<span id="cb61-146"><a href="#cb61-146" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb61-147"><a href="#cb61-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"没有足够数据进行比较</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-148"><a href="#cb61-148" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-149"><a href="#cb61-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-150"><a href="#cb61-150" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">年轻成人 vs. 老年成人组疗效比较:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-151"><a href="#cb61-151" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">nrow</span>(young_vs_older_table) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb61-152"><a href="#cb61-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(young_vs_older_table)</span>
<span id="cb61-153"><a href="#cb61-153" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb61-154"><a href="#cb61-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"没有足够数据进行比较</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-155"><a href="#cb61-155" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-156"><a href="#cb61-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-157"><a href="#cb61-157" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">中年成人 vs. 老年成人组疗效比较:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-158"><a href="#cb61-158" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">nrow</span>(middle_vs_older_table) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb61-159"><a href="#cb61-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(middle_vs_older_table)</span>
<span id="cb61-160"><a href="#cb61-160" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb61-161"><a href="#cb61-161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"没有足够数据进行比较</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-162"><a href="#cb61-162" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-163"><a href="#cb61-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-164"><a href="#cb61-164" aria-hidden="true" tabindex="-1"></a><span class="co"># 添加显著性标记到图表</span></span>
<span id="cb61-165"><a href="#cb61-165" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建一个数据框，包含所有显著差异的p值&lt;0.05的结果</span></span>
<span id="cb61-166"><a href="#cb61-166" aria-hidden="true" tabindex="-1"></a>significant_diffs <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb61-167"><a href="#cb61-167" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(young_vs_middle_table, P_value <span class="sc">&lt;</span> <span class="fl">0.05</span>),</span>
<span id="cb61-168"><a href="#cb61-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(young_vs_older_table, P_value <span class="sc">&lt;</span> <span class="fl">0.05</span>),</span>
<span id="cb61-169"><a href="#cb61-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(middle_vs_older_table, P_value <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb61-170"><a href="#cb61-170" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-171"><a href="#cb61-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-172"><a href="#cb61-172" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">nrow</span>(significant_diffs) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb61-173"><a href="#cb61-173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">显著性差异总结 (p &lt; 0.05):</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-174"><a href="#cb61-174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(significant_diffs)</span>
<span id="cb61-175"><a href="#cb61-175" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建年龄组显著性热图</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">nrow</span>(young_vs_middle_table) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">nrow</span>(young_vs_older_table) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">nrow</span>(middle_vs_older_table) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 准备热图数据</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  heatmap_data <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 处理各组间比较的p值</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(trt <span class="cf">in</span> <span class="fu">unique</span>(combined_results<span class="sc">$</span>TRT01A)) {</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(pattern <span class="cf">in</span> contrast_patterns) {</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>      <span class="co"># 提取各组比较的p值</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>      y_m_row <span class="ot">&lt;-</span> <span class="fu">subset</span>(young_vs_middle_table, Contrast <span class="sc">==</span> pattern <span class="sc">&amp;</span> TRT01A <span class="sc">==</span> trt)</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>      y_o_row <span class="ot">&lt;-</span> <span class="fu">subset</span>(young_vs_older_table, Contrast <span class="sc">==</span> pattern <span class="sc">&amp;</span> TRT01A <span class="sc">==</span> trt)</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>      m_o_row <span class="ot">&lt;-</span> <span class="fu">subset</span>(middle_vs_older_table, Contrast <span class="sc">==</span> pattern <span class="sc">&amp;</span> TRT01A <span class="sc">==</span> trt)</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">nrow</span>(y_m_row) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">nrow</span>(y_o_row) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">nrow</span>(m_o_row) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>        new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">TimePoint =</span> pattern,</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">Treatment =</span> trt,</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">Young_vs_Middle_p =</span> y_m_row<span class="sc">$</span>P_value,</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">Young_vs_Older_p =</span> y_o_row<span class="sc">$</span>P_value,</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">Middle_vs_Older_p =</span> m_o_row<span class="sc">$</span>P_value</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>        heatmap_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(heatmap_data, new_row)</span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(heatmap_data)) {</span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 创建长格式数据用于热图</span></span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>    heatmap_long <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a>      heatmap_data, </span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">cols =</span> <span class="fu">c</span>(Young_vs_Middle_p, Young_vs_Older_p, Middle_vs_Older_p),</span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">names_to =</span> <span class="st">"Comparison"</span>, </span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">values_to =</span> <span class="st">"P_Value"</span></span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 生成热图</span></span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true" tabindex="-1"></a>    p_heatmap <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(heatmap_long, <span class="fu">aes</span>(<span class="at">x =</span> TimePoint, <span class="at">y =</span> Comparison, <span class="at">fill =</span> <span class="sc">-</span><span class="fu">log10</span>(P_Value))) <span class="sc">+</span></span>
<span id="cb62-38"><a href="#cb62-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb62-39"><a href="#cb62-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb62-40"><a href="#cb62-40" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span> Treatment) <span class="sc">+</span></span>
<span id="cb62-41"><a href="#cb62-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb62-42"><a href="#cb62-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Statistical Significance of Age Group Differences"</span>,</span>
<span id="cb62-43"><a href="#cb62-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="st">"-log10(p-value): higher values = more significant"</span>,</span>
<span id="cb62-44"><a href="#cb62-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Time Point"</span>, </span>
<span id="cb62-45"><a href="#cb62-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Group Comparison"</span>,</span>
<span id="cb62-46"><a href="#cb62-46" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">"-log10(p)"</span></span>
<span id="cb62-47"><a href="#cb62-47" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb62-48"><a href="#cb62-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb62-49"><a href="#cb62-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb62-50"><a href="#cb62-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-51"><a href="#cb62-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(p_heatmap)</span>
<span id="cb62-52"><a href="#cb62-52" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb62-53"><a href="#cb62-53" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-54"><a href="#cb62-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-55"><a href="#cb62-55" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建各年龄组在各治疗组的治疗效应折线图</span></span>
<span id="cb62-56"><a href="#cb62-56" aria-hidden="true" tabindex="-1"></a><span class="co"># 将结果按年龄组和治疗方案分组</span></span>
<span id="cb62-57"><a href="#cb62-57" aria-hidden="true" tabindex="-1"></a>age_group_effects <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(combined_results, </span>
<span id="cb62-58"><a href="#cb62-58" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">aes</span>(<span class="at">x =</span> TimePoint, <span class="at">y =</span> estimate, </span>
<span id="cb62-59"><a href="#cb62-59" aria-hidden="true" tabindex="-1"></a>                               <span class="at">group =</span> AgeGroup, <span class="at">color =</span> AgeGroup)) <span class="sc">+</span></span>
<span id="cb62-60"><a href="#cb62-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb62-61"><a href="#cb62-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb62-62"><a href="#cb62-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> estimate <span class="sc">-</span> SE, <span class="at">ymax =</span> estimate <span class="sc">+</span> SE), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb62-63"><a href="#cb62-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> TRT01A) <span class="sc">+</span></span>
<span id="cb62-64"><a href="#cb62-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Treatment Effects by Age Group"</span>,</span>
<span id="cb62-65"><a href="#cb62-65" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Time Point"</span>, </span>
<span id="cb62-66"><a href="#cb62-66" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Estimated Effect"</span>,</span>
<span id="cb62-67"><a href="#cb62-67" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Age Group"</span>) <span class="sc">+</span></span>
<span id="cb62-68"><a href="#cb62-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb62-69"><a href="#cb62-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb62-70"><a href="#cb62-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-71"><a href="#cb62-71" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(age_group_effects)</span>
<span id="cb62-72"><a href="#cb62-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-73"><a href="#cb62-73" aria-hidden="true" tabindex="-1"></a><span class="co"># 总结分析</span></span>
<span id="cb62-74"><a href="#cb62-74" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">## 年龄组治疗效应总结分析</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb62-75"><a href="#cb62-75" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"1. 基于以上分析，我们可以观察到不同年龄组对治疗的反应存在以下差异：</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb62-76"><a href="#cb62-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-77"><a href="#cb62-77" aria-hidden="true" tabindex="-1"></a><span class="co"># 检查是否有显著差异</span></span>
<span id="cb62-78"><a href="#cb62-78" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">exists</span>(<span class="st">"significant_diffs"</span>) <span class="sc">&amp;&amp;</span> <span class="fu">nrow</span>(significant_diffs) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb62-79"><a href="#cb62-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"   - 存在显著的年龄组间差异(p &lt; 0.05)，特别是在以下时间点和治疗组：</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb62-80"><a href="#cb62-80" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(significant_diffs)) {</span>
<span id="cb62-81"><a href="#cb62-81" aria-hidden="true" tabindex="-1"></a>    row <span class="ot">&lt;-</span> significant_diffs[i,]</span>
<span id="cb62-82"><a href="#cb62-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"     * 时间点 "</span>, row<span class="sc">$</span>Contrast, <span class="st">"，治疗组 "</span>, row<span class="sc">$</span>TRT01A, </span>
<span id="cb62-83"><a href="#cb62-83" aria-hidden="true" tabindex="-1"></a>               <span class="st">" (p = "</span>, <span class="fu">round</span>(row<span class="sc">$</span>P_value, <span class="dv">4</span>), <span class="st">")</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb62-84"><a href="#cb62-84" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb62-85"><a href="#cb62-85" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb62-86"><a href="#cb62-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"   - 在分析的时间点和治疗组中未发现显著的年龄组间差异</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb62-87"><a href="#cb62-87" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-88"><a href="#cb62-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-89"><a href="#cb62-89" aria-hidden="true" tabindex="-1"></a><span class="co"># 药效学差异总结</span></span>
<span id="cb62-90"><a href="#cb62-90" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">2. 药效学差异总结：</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb62-91"><a href="#cb62-91" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"   - young adults (18-24 years)：</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb62-92"><a href="#cb62-92" aria-hidden="true" tabindex="-1"></a>young_effect <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">subset</span>(results_young, TRT01A <span class="sc">!=</span> <span class="st">"Dummy A"</span>)<span class="sc">$</span>estimate)</span>
<span id="cb62-93"><a href="#cb62-93" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"     Mean therapeutic effect: "</span>, <span class="fu">round</span>(young_effect, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb62-94"><a href="#cb62-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-95"><a href="#cb62-95" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"   - middle-aged adults (24-55 years)：</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb62-96"><a href="#cb62-96" aria-hidden="true" tabindex="-1"></a>middle_effect <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">subset</span>(results_middle, TRT01A <span class="sc">!=</span> <span class="st">"Dummy A"</span>)<span class="sc">$</span>estimate)</span>
<span id="cb62-97"><a href="#cb62-97" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"     Mean therapeutic effect: "</span>, <span class="fu">round</span>(middle_effect, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb62-98"><a href="#cb62-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-99"><a href="#cb62-99" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"   - older adults (&gt;= 55 years)：</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb62-100"><a href="#cb62-100" aria-hidden="true" tabindex="-1"></a>older_effect <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">subset</span>(results_older, TRT01A <span class="sc">!=</span> <span class="st">"Dummy A"</span>)<span class="sc">$</span>estimate)</span>
<span id="cb62-101"><a href="#cb62-101" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"     Mean therapeutic effect: "</span>, <span class="fu">round</span>(older_effect, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb62-102"><a href="#cb62-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-103"><a href="#cb62-103" aria-hidden="true" tabindex="-1"></a><span class="co"># 整体结论</span></span>
<span id="cb62-104"><a href="#cb62-104" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">3. 临床意义和建议：</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb62-105"><a href="#cb62-105" aria-hidden="true" tabindex="-1"></a><span class="co"># 比较三组平均效应</span></span>
<span id="cb62-106"><a href="#cb62-106" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"年轻成人"</span>, <span class="st">"中年成人"</span>, <span class="st">"老年成人"</span>)</span>
<span id="cb62-107"><a href="#cb62-107" aria-hidden="true" tabindex="-1"></a>effects <span class="ot">&lt;-</span> <span class="fu">c</span>(young_effect, middle_effect, older_effect)</span>
<span id="cb62-108"><a href="#cb62-108" aria-hidden="true" tabindex="-1"></a>best_group_idx <span class="ot">&lt;-</span> <span class="fu">which.max</span>(<span class="fu">abs</span>(effects))</span>
<span id="cb62-109"><a href="#cb62-109" aria-hidden="true" tabindex="-1"></a>lowest_group_idx <span class="ot">&lt;-</span> <span class="fu">which.min</span>(<span class="fu">abs</span>(effects))</span>
<span id="cb62-110"><a href="#cb62-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-111"><a href="#cb62-111" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"   - "</span>, groups[best_group_idx], <span class="st">"组显示出最强的治疗反应</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb62-112"><a href="#cb62-112" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"   - "</span>, groups[lowest_group_idx], <span class="st">"组显示出最弱的治疗反应</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb62-113"><a href="#cb62-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-114"><a href="#cb62-114" aria-hidden="true" tabindex="-1"></a><span class="co"># 最终建议</span></span>
<span id="cb62-115"><a href="#cb62-115" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">4. 临床应用建议：</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb62-116"><a href="#cb62-116" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"   - 根据不同年龄组的反应差异，可能需要考虑针对特定年龄组调整治疗方案</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb62-117"><a href="#cb62-117" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"   - 特别关注对治疗反应较弱的年龄组，可能需要增加治疗强度或辅助治疗</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb62-118"><a href="#cb62-118" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"   - 应进一步研究年龄相关的药代动力学和药效学差异，以优化治疗策略</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="主要疗效分析day28" class="level2">
<h2 class="anchored" data-anchor-id="主要疗效分析day28">主要疗效分析（Day28）</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mmrm() registered as emmeans extension</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Welcome to emmeans.
Caution: You lose important information if you filter this package's results.
See '? untidy'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mmrm)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: viridisLite</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grid)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'gridExtra'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    combine</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 获取Day28的最小二乘均值</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>emm_day28 <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  fit, </span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">specs =</span> <span class="sc">~</span> TRT01A <span class="sc">|</span> AVISITN,</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">at =</span> <span class="fu">list</span>(<span class="at">AVISITN =</span> <span class="st">"28"</span>) <span class="co"># "28"是AVISITN中Day28对应的水平（减20000后）</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 治疗组与安慰剂对比</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>contrast_specs <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Esk56_vs_Placebo"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Esk84_vs_Placebo"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>contrast_results <span class="ot">&lt;-</span> <span class="fu">contrast</span>(</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>  emm_day28,</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> contrast_specs,</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">adjust =</span> <span class="st">"none"</span></span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="at">infer =</span> <span class="cn">TRUE</span>) <span class="co"># 包含置信区间和p值</span></span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 显示对比结果</span></span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(contrast_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AVISITN = 28:
 contrast         estimate     SE  df lower.CL upper.CL t.ratio p.value
 Esk56_vs_Placebo   -0.841 0.0992 651   -1.036   -0.647  -8.482  &lt;.0001
 Esk84_vs_Placebo   -0.798 0.0791 596   -0.954   -0.643 -10.098  &lt;.0001

Results are averaged over the levels of: SEX, SITEID, RACE, base_situation 
Confidence level used: 0.95 </code></pre>
</div>
</div>
</section>
<section id="疗效趋势可视化及森林图" class="level2">
<h2 class="anchored" data-anchor-id="疗效趋势可视化及森林图">疗效趋势可视化及森林图</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 获取各时间点预测值</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="co">#admadrs$AVISITN &lt;- droplevels(admadrs$AVISITN)</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>emm_trend <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  fit,</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">specs =</span> <span class="sc">~</span> TRT01A <span class="sc">|</span> AVISITN, </span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">at =</span> <span class="fu">list</span>(<span class="at">AVISITN =</span> <span class="fu">levels</span>(admadrs<span class="sc">$</span>AVISITN)),<span class="co"># 使用所有时间点</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">nuisance =</span> <span class="st">"RACE"</span>) <span class="sc">%&gt;%</span> <span class="co"># 将RACE设为无关因素保证行数不超过10000</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制疗效趋势图</span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>(p_trend <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(emm_trend, <span class="fu">aes</span>(<span class="at">x =</span> AVISITN, <span class="at">y =</span> emmean, </span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">color =</span> TRT01A, <span class="at">group =</span> TRT01A)) <span class="sc">+</span></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower.CL, <span class="at">ymax =</span> upper.CL), </span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> <span class="fl">0.2</span>, </span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(<span class="at">discrete =</span> <span class="cn">TRUE</span>, </span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Placebo"</span>, <span class="st">"56mg"</span>, <span class="st">"84mg"</span>)) <span class="sc">+</span></span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Treatment Effect Over Time"</span>,</span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Study Visit (Day)"</span>, </span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Adjusted Mean Change from Baseline (LS Means)"</span>, </span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Treatment Group"</span></span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mainCode_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制森林图</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>contrast_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(contrast_results)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>contrast_df<span class="sc">$</span>Comparison <span class="ot">&lt;-</span> <span class="fu">rownames</span>(contrast_df)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>(p_forest <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(contrast_df, </span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">y =</span> Comparison, </span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">xmin =</span> lower.CL, <span class="at">xmax =</span> upper.CL)) <span class="sc">+</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"grey50"</span>) <span class="sc">+</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbarh</span>(<span class="at">height =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"#440154"</span>) <span class="sc">+</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"56mg vs Placebo"</span>, <span class="st">"84mg vs Placebo"</span>)) <span class="sc">+</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Treatment Comparisons at Day 28"</span>,</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Treatment Difference (95% CI)"</span>, </span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">""</span></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mainCode_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 组合图形</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p_trend, p_forest, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mainCode_files/figure-html/unnamed-chunk-10-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 保存图形（PDF格式）</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"treatment_analysis.pdf"</span>, </span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">arrangeGrob</span>(p_trend, p_forest, <span class="at">ncol =</span> <span class="dv">1</span>), </span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">8</span>)</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 保存统计结果</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(contrast_results, <span class="st">"treatment_contrasts.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="治疗组vs安慰剂的估计边际均值和差异计算及可视化" class="level2">
<h2 class="anchored" data-anchor-id="治疗组vs安慰剂的估计边际均值和差异计算及可视化">治疗组vs安慰剂的估计边际均值和差异计算及可视化</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 将Day 28对应的AVISITN水平赋值</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>day28_level <span class="ot">&lt;-</span> <span class="st">"28"</span> </span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算Day 28时的估计边际均值</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>em_day28 <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(fit, <span class="sc">~</span> TRT01A <span class="sc">|</span> AVISITN, <span class="at">at =</span> <span class="fu">list</span>(<span class="at">AVISITN =</span> day28_level))</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(em_day28)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AVISITN = 28:
 TRT01A  emmean    SE   df lower.CL upper.CL
 Dummy A -0.266 0.129  798   -0.519  -0.0126
 Dummy B -1.107 0.157 1000   -1.416  -0.7989
 Dummy C -1.064 0.147  979   -1.352  -0.7764

Results are averaged over the levels of: SEX, SITEID, RACE, base_situation 
Confidence level used: 0.95 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算治疗组vs安慰剂在Day28时的差异</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>contrasts_day28 <span class="ot">&lt;-</span> <span class="fu">contrast</span>(em_day28, <span class="at">method =</span> <span class="st">"trt.vs.ctrl"</span>, <span class="at">ref =</span> <span class="dv">1</span>)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(contrasts_day28)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AVISITN = 28:
 contrast          estimate     SE  df t.ratio p.value
 Dummy B - Dummy A   -0.841 0.0992 651  -8.482  &lt;.0001
 Dummy C - Dummy A   -0.798 0.0791 596 -10.098  &lt;.0001

Results are averaged over the levels of: SEX, SITEID, RACE, base_situation 
P value adjustment: dunnettx method for 2 tests </code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算所有时间点的估计边际均值</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>em_all <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(fit, <span class="sc">~</span> TRT01A <span class="sc">|</span> AVISITN, <span class="at">nuisance =</span> <span class="st">"RACE"</span>)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(em_all)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AVISITN = 0:
 TRT01A  emmean    SE   df lower.CL upper.CL
 Dummy A  0.304 0.103  416   0.1020   0.5053
 Dummy B  0.305 0.105  417   0.0994   0.5113
 Dummy C  0.353 0.106  417   0.1445   0.5616

AVISITN = 2:
 TRT01A  emmean    SE   df lower.CL upper.CL
 Dummy A -0.703 0.117  634  -0.9325  -0.4728
 Dummy B -1.396 0.149  883  -1.6881  -1.1032
 Dummy C -1.237 0.147  992  -1.5249  -0.9488

AVISITN = 8:
 TRT01A  emmean    SE   df lower.CL upper.CL
 Dummy A -0.631 0.132  823  -0.8899  -0.3720
 Dummy B -1.327 0.155 1028  -1.6310  -1.0222
 Dummy C -1.404 0.150 1035  -1.6972  -1.1103

AVISITN = 15:
 TRT01A  emmean    SE   df lower.CL upper.CL
 Dummy A -0.677 0.132  829  -0.9371  -0.4176
 Dummy B -1.419 0.160 1049  -1.7321  -1.1051
 Dummy C -1.467 0.184  763  -1.8276  -1.1055

AVISITN = 22:
 TRT01A  emmean    SE   df lower.CL upper.CL
 Dummy A -0.347 0.116  614  -0.5746  -0.1202
 Dummy B -1.188 0.152  884  -1.4870  -0.8897
 Dummy C -0.993 0.150  982  -1.2870  -0.6987

AVISITN = 28:
 TRT01A  emmean    SE   df lower.CL upper.CL
 Dummy A -0.266 0.129  798  -0.5193  -0.0126
 Dummy B -1.107 0.157 1000  -1.4157  -0.7989
 Dummy C -1.064 0.147  979  -1.3520  -0.7764

AVISITN = 999:
 TRT01A  emmean    SE   df lower.CL upper.CL
 Dummy A -0.413 0.130  805  -0.6673  -0.1587
 Dummy B -1.114 0.157  980  -1.4215  -0.8068
 Dummy C -1.214 0.184  758  -1.5761  -0.8519

Results are averaged over the levels of: 1 nuisance factors, SEX, SITEID, base_situation 
Confidence level used: 0.95 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 各组在各时间点的均值比较</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>contrasts_all <span class="ot">&lt;-</span> <span class="fu">contrast</span>(em_all, <span class="at">method =</span> <span class="st">"trt.vs.ctrl"</span>, <span class="at">ref =</span> <span class="dv">1</span>)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(contrasts_all)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AVISITN = 0:
 contrast          estimate     SE  df t.ratio p.value
 Dummy B - Dummy A  0.00171 0.0411 415   0.042  0.9972
 Dummy C - Dummy A  0.04943 0.0418 416   1.183  0.3944

AVISITN = 2:
 contrast          estimate     SE  df t.ratio p.value
 Dummy B - Dummy A -0.69297 0.0748 588  -9.270  &lt;.0001
 Dummy C - Dummy A -0.53418 0.0923 670  -5.788  &lt;.0001

AVISITN = 8:
 contrast          estimate     SE  df t.ratio p.value
 Dummy B - Dummy A -0.69563 0.0926 668  -7.511  &lt;.0001
 Dummy C - Dummy A -0.77280 0.0796 596  -9.714  &lt;.0001

AVISITN = 15:
 contrast          estimate     SE  df t.ratio p.value
 Dummy B - Dummy A -0.74127 0.0962 509  -7.705  &lt;.0001
 Dummy C - Dummy A -0.78919 0.0970 516  -8.134  &lt;.0001

AVISITN = 22:
 contrast          estimate     SE  df t.ratio p.value
 Dummy B - Dummy A -0.84093 0.0788 590 -10.675  &lt;.0001
 Dummy C - Dummy A -0.64546 0.0991 657  -6.515  &lt;.0001

AVISITN = 28:
 contrast          estimate     SE  df t.ratio p.value
 Dummy B - Dummy A -0.84138 0.0992 651  -8.482  &lt;.0001
 Dummy C - Dummy A -0.79832 0.0791 596 -10.098  &lt;.0001

AVISITN = 999:
 contrast          estimate     SE  df t.ratio p.value
 Dummy B - Dummy A -0.70119 0.0947 512  -7.401  &lt;.0001
 Dummy C - Dummy A -0.80107 0.0953 515  -8.406  &lt;.0001

Results are averaged over the levels of: 1 nuisance factors, SEX, SITEID, base_situation 
P value adjustment: dunnettx method for 2 tests </code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 将结果转换为数据框以便绘图</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>em_all_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(em_all)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建一个时间轴变量，将AVISITN转换为数值以便绘图</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>em_all_df<span class="sc">$</span>Time <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(em_all_df<span class="sc">$</span>AVISITN))</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制各治疗组随时间的MADRS变化趋势图</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(em_all_df, <span class="fu">aes</span>(<span class="at">x =</span> AVISITN, <span class="at">y =</span> emmean, <span class="at">color =</span> TRT01A, <span class="at">group =</span> TRT01A)) <span class="sc">+</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> emmean <span class="sc">-</span> SE, <span class="at">ymax =</span> emmean <span class="sc">+</span> SE), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Change from Baseline in MADRS Total Score Over Time"</span>,</span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Day"</span>,</span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Estimated Mean Change from Baseline"</span>,</span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Treatment Group"</span></span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(<span class="at">discrete =</span> <span class="cn">TRUE</span>, <span class="at">option =</span> <span class="st">"D"</span>, </span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Placebo"</span>, <span class="st">"Esketamine 56 mg"</span>, <span class="st">"Esketamine 84 mg"</span>)) <span class="sc">+</span></span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb85-23"><a href="#cb85-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb85-24"><a href="#cb85-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb85-25"><a href="#cb85-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb85-26"><a href="#cb85-26" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mainCode_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 保存图片</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"MADRS_change_over_time.png"</span>, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建Day 28时的柱状图比较</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>day28_df <span class="ot">&lt;-</span> <span class="fu">subset</span>(em_all_df, AVISITN <span class="sc">==</span> day28_level)</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 将各组在各时间点的均值比较结果转换为数据框以便绘图</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>contrasts_day28_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(contrasts_day28)</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制Day 28时的柱状图</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(day28_df, <span class="fu">aes</span>(<span class="at">x =</span> TRT01A, <span class="at">y =</span> emmean, <span class="at">fill =</span> TRT01A)) <span class="sc">+</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> emmean <span class="sc">-</span> SE, <span class="at">ymax =</span> emmean <span class="sc">+</span> SE), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Change from Baseline in MADRS Total Score at Day 28"</span>,</span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Treatment Group"</span>,</span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Estimated Mean Change from Baseline"</span>,</span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Treatment Group"</span></span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(<span class="at">discrete =</span> <span class="cn">TRUE</span>, <span class="at">option =</span> <span class="st">"D"</span>,</span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Placebo"</span>, <span class="st">"Esketamine 56 mg"</span>, <span class="st">"Esketamine 84 mg"</span>)) <span class="sc">+</span></span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制治疗组vs安慰剂的差异图</span></span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(contrasts_day28_df, <span class="fu">aes</span>(<span class="at">x =</span> contrast, <span class="at">y =</span> estimate, <span class="at">fill =</span> contrast)) <span class="sc">+</span></span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb86-32"><a href="#cb86-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> estimate <span class="sc">-</span> SE, <span class="at">ymax =</span> estimate <span class="sc">+</span> SE), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb86-33"><a href="#cb86-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb86-34"><a href="#cb86-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Treatment Effect vs Placebo at Day 28"</span>,</span>
<span id="cb86-35"><a href="#cb86-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Contrast"</span>,</span>
<span id="cb86-36"><a href="#cb86-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Estimated Difference"</span>,</span>
<span id="cb86-37"><a href="#cb86-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Contrast"</span></span>
<span id="cb86-38"><a href="#cb86-38" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb86-39"><a href="#cb86-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(<span class="at">discrete =</span> <span class="cn">TRUE</span>, <span class="at">option =</span> <span class="st">"E"</span>) <span class="sc">+</span></span>
<span id="cb86-40"><a href="#cb86-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb86-41"><a href="#cb86-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb86-42"><a href="#cb86-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb86-43"><a href="#cb86-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb86-44"><a href="#cb86-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb86-45"><a href="#cb86-45" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb86-46"><a href="#cb86-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>)</span>
<span id="cb86-47"><a href="#cb86-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-48"><a href="#cb86-48" aria-hidden="true" tabindex="-1"></a><span class="co"># 将两个图组合在一起</span></span>
<span id="cb86-49"><a href="#cb86-49" aria-hidden="true" tabindex="-1"></a>combined_plot <span class="ot">&lt;-</span> <span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mainCode_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 保存组合图</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Day28_treatment_effect.png"</span>, combined_plot, <span class="at">width =</span> <span class="dv">12</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建森林图展示各时间点的治疗效果</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>contrasts_all_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(contrasts_all)</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>contrasts_all_df<span class="sc">$</span>Time <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(contrasts_all_df<span class="sc">$</span>AVISITN))</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 森林图</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(contrasts_all_df, <span class="fu">aes</span>(<span class="at">x =</span> AVISITN , <span class="at">y =</span> estimate, <span class="at">color =</span> contrast)) <span class="sc">+</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> estimate <span class="sc">-</span> SE<span class="sc">*</span><span class="fl">1.96</span>, <span class="at">ymax =</span> estimate <span class="sc">+</span> SE<span class="sc">*</span><span class="fl">1.96</span>), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> contrast), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> contrast, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Treatment Effect vs Placebo Over Time"</span>,</span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Day"</span>,</span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Estimated Difference vs Placebo"</span>,</span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Treatment Group"</span></span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(<span class="at">discrete =</span> <span class="cn">TRUE</span>, <span class="at">option =</span> <span class="st">"D"</span>) <span class="sc">+</span></span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"lightgrey"</span>),</span>
<span id="cb87-26"><a href="#cb87-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb87-27"><a href="#cb87-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb87-28"><a href="#cb87-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb87-29"><a href="#cb87-29" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mainCode_files/figure-html/unnamed-chunk-11-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 保存森林图</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Treatment_effect_forest_plot.png"</span>, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">8</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建热图展示p值</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 提取所有时间点的p值</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>p_values <span class="ot">&lt;-</span> contrasts_all_df</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>p_values<span class="sc">$</span>sig <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(p_values<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.001</span>, <span class="st">"***"</span>,</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">ifelse</span>(p_values<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.01</span>, <span class="st">"**"</span>,</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">ifelse</span>(p_values<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="st">"*"</span>, <span class="st">"ns"</span>)))</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 处理热图所需数据</span></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>p_values_wide <span class="ot">&lt;-</span> p_values <span class="sc">%&gt;%</span></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(AVISITN, contrast, p.value) <span class="sc">%&gt;%</span></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> contrast, <span class="at">values_from =</span> p.value)</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制p值热图</span></span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a>p_values_long <span class="ot">&lt;-</span> p_values <span class="sc">%&gt;%</span></span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Time, contrast, p.value, sig)</span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(p_values_long, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(Time), <span class="at">y =</span> contrast, <span class="at">fill =</span> <span class="sc">-</span><span class="fu">log10</span>(p.value))) <span class="sc">+</span></span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> sig), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(<span class="at">option =</span> <span class="st">"C"</span>, <span class="at">name =</span> <span class="st">"-log10(p-value)"</span>) <span class="sc">+</span></span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Statistical Significance of Treatment Effect vs Placebo"</span>,</span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Day"</span>,</span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Treatment Group"</span>,</span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"* p&lt;0.05, ** p&lt;0.01, *** p&lt;0.001, ns: not significant"</span></span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb88-30"><a href="#cb88-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb88-31"><a href="#cb88-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb88-32"><a href="#cb88-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb88-33"><a href="#cb88-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb88-34"><a href="#cb88-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span></span>
<span id="cb88-35"><a href="#cb88-35" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mainCode_files/figure-html/unnamed-chunk-11-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 保存热图</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Treatment_significance_heatmap.png"</span>, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 模型诊断图</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 提取残差</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>residuals <span class="ot">&lt;-</span> <span class="fu">residuals</span>(fit)</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>fitted_values <span class="ot">&lt;-</span> <span class="fu">fitted</span>(fit)</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建诊断数据框</span></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>diag_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">Fitted =</span> fitted_values,</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">Residuals =</span> residuals</span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制残差图</span></span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(diag_df, <span class="fu">aes</span>(<span class="at">x =</span> Fitted, <span class="at">y =</span> Residuals)) <span class="sc">+</span></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Residuals vs Fitted Values"</span>,</span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Fitted Values"</span>,</span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Residuals"</span></span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb89-25"><a href="#cb89-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb89-26"><a href="#cb89-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb89-27"><a href="#cb89-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb89-28"><a href="#cb89-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb89-29"><a href="#cb89-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb89-30"><a href="#cb89-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-31"><a href="#cb89-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制残差的QQ图</span></span>
<span id="cb89-32"><a href="#cb89-32" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(diag_df, <span class="fu">aes</span>(<span class="at">sample =</span> Residuals)) <span class="sc">+</span></span>
<span id="cb89-33"><a href="#cb89-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq</span>() <span class="sc">+</span></span>
<span id="cb89-34"><a href="#cb89-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq_line</span>() <span class="sc">+</span></span>
<span id="cb89-35"><a href="#cb89-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb89-36"><a href="#cb89-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Normal Q-Q Plot of Residuals"</span>,</span>
<span id="cb89-37"><a href="#cb89-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Theoretical Quantiles"</span>,</span>
<span id="cb89-38"><a href="#cb89-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Sample Quantiles"</span></span>
<span id="cb89-39"><a href="#cb89-39" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb89-40"><a href="#cb89-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb89-41"><a href="#cb89-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb89-42"><a href="#cb89-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb89-43"><a href="#cb89-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb89-44"><a href="#cb89-44" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb89-45"><a href="#cb89-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-46"><a href="#cb89-46" aria-hidden="true" tabindex="-1"></a><span class="co"># 组合诊断图</span></span>
<span id="cb89-47"><a href="#cb89-47" aria-hidden="true" tabindex="-1"></a>diag_plot <span class="ot">&lt;-</span> <span class="fu">grid.arrange</span>(p3, p4, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mainCode_files/figure-html/unnamed-chunk-11-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 保存诊断图</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Model_diagnostics.png"</span>, diag_plot, <span class="at">width =</span> <span class="dv">12</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="数据可视化有图例和解释" class="level2">
<h2 class="anchored" data-anchor-id="数据可视化有图例和解释">数据可视化（有图例和解释）</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 各治疗组随时间的MADRS变化趋势图</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 输出emmeans结果数据</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>em_all_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AVISITN = 0:
 TRT01A      emmean        SE      df   lower.CL   upper.CL Time
 Dummy A  0.3036347 0.1025859  415.71  0.1019829  0.5052865    0
 Dummy B  0.3053490 0.1047895  416.57  0.0993668  0.5113311    0
 Dummy C  0.3530675 0.1061115  416.77  0.1444871  0.5616480    0

AVISITN = 2:
 TRT01A      emmean        SE      df   lower.CL   upper.CL Time
 Dummy A -0.7026543 0.1170686  634.38 -0.9325430 -0.4727655    2
 Dummy B -1.3956254 0.1489953  883.30 -1.6880515 -1.1031993    2
 Dummy C -1.2368376 0.1467976  992.47 -1.5249070 -0.9487683    2

AVISITN = 8:
 TRT01A      emmean        SE      df   lower.CL   upper.CL Time
 Dummy A -0.6309696 0.1319135  823.38 -0.8898959 -0.3720433    8
 Dummy B -1.3266031 0.1551385 1028.50 -1.6310271 -1.0221791    8
 Dummy C -1.4037658 0.1495618 1035.19 -1.6972447 -1.1102869    8

AVISITN = 15:
 TRT01A      emmean        SE      df   lower.CL   upper.CL Time
 Dummy A -0.6773596 0.1323395  828.55 -0.9371198 -0.4175994   15
 Dummy B -1.4186303 0.1597666 1049.01 -1.7321288 -1.1051319   15
 Dummy C -1.4665458 0.1839236  762.97 -1.8276022 -1.1054894   15

AVISITN = 22:
 TRT01A      emmean        SE      df   lower.CL   upper.CL Time
 Dummy A -0.3473856 0.1156954  613.79 -0.5745923 -0.1201788   22
 Dummy B -1.1883160 0.1521635  884.23 -1.4869597 -0.8896723   22
 Dummy C -0.9928504 0.1499149  981.72 -1.2870410 -0.6986599   22

AVISITN = 28:
 TRT01A      emmean        SE      df   lower.CL   upper.CL Time
 Dummy A -0.2659051 0.1290646  798.18 -0.5192512 -0.0125591   28
 Dummy B -1.1072886 0.1571637  999.66 -1.4156972 -0.7988800   28
 Dummy C -1.0642296 0.1466599  979.15 -1.3520335 -0.7764257   28

AVISITN = 999:
 TRT01A      emmean        SE      df   lower.CL   upper.CL Time
 Dummy A -0.4129694 0.1295510  804.86 -0.6672671 -0.1586717  999
 Dummy B -1.1141616 0.1566069  980.15 -1.4214850 -0.8068383  999
 Dummy C -1.2140361 0.1844488  757.54 -1.5761277 -0.8519445  999

Results are averaged over the levels of: 1 nuisance factors, SEX, SITEID, base_situation 
Confidence level used: 0.95 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘图</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(em_all_df, <span class="fu">aes</span>(<span class="at">x =</span> AVISITN, <span class="at">y =</span> emmean, <span class="at">color =</span> TRT01A, <span class="at">group =</span> TRT01A)) <span class="sc">+</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> emmean <span class="sc">-</span> SE, <span class="at">ymax =</span> emmean <span class="sc">+</span> SE), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Change from Baseline in MADRS Total Score Over Time"</span>,</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Mixed Model for Repeated Measures (MMRM) Analysis"</span>,</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Study Day"</span>,</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Estimated Mean Change from Baseline"</span>,</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Treatment Group"</span>,</span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Note: Error bars represent standard errors. Negative values indicate improvement in depressive symptoms."</span></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(<span class="at">discrete =</span> <span class="cn">TRUE</span>, <span class="at">option =</span> <span class="st">"D"</span>, </span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Placebo"</span>, <span class="st">"Esketamine 56 mg"</span>, <span class="st">"Esketamine 84 mg"</span>)) <span class="sc">+</span></span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="st">"grey80"</span>),</span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"italic"</span>)</span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 添加解释文本</span></span>
<span id="cb94-28"><a href="#cb94-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">min</span>(<span class="fu">as.numeric</span>(<span class="fu">as.character</span>(em_all_df<span class="sc">$</span>AVISITN))) <span class="sc">+</span> <span class="dv">2</span>, </span>
<span id="cb94-29"><a href="#cb94-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">min</span>(em_all_df<span class="sc">$</span>emmean) <span class="sc">*</span> <span class="fl">0.8</span>, </span>
<span id="cb94-30"><a href="#cb94-30" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Lower values indicate greater</span><span class="sc">\n</span><span class="st">improvement in depression"</span>, </span>
<span id="cb94-31"><a href="#cb94-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">fontface =</span> <span class="st">"italic"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mainCode_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 保存图片</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"MADRS_change_over_time_with_legend.png"</span>, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 输出Day 28时的估计边际均值</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>day28_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    TRT01A AVISITN     emmean        SE       df   lower.CL    upper.CL Time
16 Dummy A      28 -0.2659051 0.1290646 798.1815 -0.5192512 -0.01255906   28
17 Dummy B      28 -1.1072886 0.1571637 999.6623 -1.4156972 -0.79888004   28
18 Dummy C      28 -1.0642296 0.1466599 979.1475 -1.3520335 -0.77642572   28</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Day 28时的柱状图</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(day28_df, <span class="fu">aes</span>(<span class="at">x =</span> TRT01A, <span class="at">y =</span> emmean, <span class="at">fill =</span> TRT01A)) <span class="sc">+</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> emmean <span class="sc">-</span> SE, <span class="at">ymax =</span> emmean <span class="sc">+</span> SE), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Change from Baseline in MADRS Total Score at Day 28"</span>,</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Estimated Marginal Means with Standard Errors"</span>,</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Treatment Group"</span>,</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Estimated Mean Change from Baseline"</span>,</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Treatment Group"</span>,</span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Note: Error bars represent standard errors. Negative values indicate improvement in depressive symptoms."</span></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(<span class="at">discrete =</span> <span class="cn">TRUE</span>, <span class="at">option =</span> <span class="st">"D"</span>,</span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Placebo"</span>, <span class="st">"Esketamine 56 mg"</span>, <span class="st">"Esketamine 84 mg"</span>)) <span class="sc">+</span></span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="st">"grey80"</span>),</span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb97-20"><a href="#cb97-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb97-21"><a href="#cb97-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb97-22"><a href="#cb97-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb97-23"><a href="#cb97-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"italic"</span>),</span>
<span id="cb97-24"><a href="#cb97-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb97-25"><a href="#cb97-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb97-26"><a href="#cb97-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 添加标签</span></span>
<span id="cb97-27"><a href="#cb97-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.1f"</span>, emmean)), <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.7</span>), </span>
<span id="cb97-28"><a href="#cb97-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>)</span>
<span id="cb97-29"><a href="#cb97-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-30"><a href="#cb97-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-31"><a href="#cb97-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 输出绘图数据</span></span>
<span id="cb97-32"><a href="#cb97-32" aria-hidden="true" tabindex="-1"></a>contrasts_day28_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AVISITN = 28:
 contrast            estimate         SE     df t.ratio p.value
 Dummy B - Dummy A -0.8413835 0.09919806 650.97  -8.482  &lt;.0001
 Dummy C - Dummy A -0.7983245 0.07905644 595.89 -10.098  &lt;.0001

Results are averaged over the levels of: SEX, SITEID, RACE, base_situation 
P value adjustment: dunnettx method for 2 tests </code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制治疗组vs安慰剂的差异图</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(contrasts_day28_df, <span class="fu">aes</span>(<span class="at">x =</span> contrast, <span class="at">y =</span> estimate, <span class="at">fill =</span> contrast)) <span class="sc">+</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> estimate <span class="sc">-</span> SE, <span class="at">ymax =</span> estimate <span class="sc">+</span> SE), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Treatment Effect vs Placebo at Day 28"</span>,</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Difference in Estimated Means with Standard Errors"</span>,</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Treatment Comparison"</span>,</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Estimated Difference vs Placebo"</span>,</span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Treatment Comparison"</span>,</span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Note: Values below zero favor active treatment over placebo.</span><span class="sc">\n</span><span class="st">Red dashed line represents no difference from placebo."</span></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(<span class="at">discrete =</span> <span class="cn">TRUE</span>, <span class="at">option =</span> <span class="st">"E"</span>,</span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Esketamine 56 mg vs Placebo"</span>, <span class="st">"Esketamine 84 mg vs Placebo"</span>)) <span class="sc">+</span></span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="st">"grey80"</span>),</span>
<span id="cb99-19"><a href="#cb99-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb99-20"><a href="#cb99-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb99-21"><a href="#cb99-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb99-22"><a href="#cb99-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb99-23"><a href="#cb99-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"italic"</span>),</span>
<span id="cb99-24"><a href="#cb99-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb99-25"><a href="#cb99-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb99-26"><a href="#cb99-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb99-27"><a href="#cb99-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 添加p值和效应量标签</span></span>
<span id="cb99-28"><a href="#cb99-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"Diff: %.1f</span><span class="sc">\n</span><span class="st">p = %.3f"</span>, estimate, p.value)), </span>
<span id="cb99-29"><a href="#cb99-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.7</span>), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.8</span>, <span class="at">size =</span> <span class="fl">3.5</span>)</span>
<span id="cb99-30"><a href="#cb99-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-31"><a href="#cb99-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用patchwork组合两个图</span></span>
<span id="cb99-32"><a href="#cb99-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb99-33"><a href="#cb99-33" aria-hidden="true" tabindex="-1"></a>combined_plot <span class="ot">&lt;-</span> p1 <span class="sc">+</span> p2 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb99-34"><a href="#cb99-34" aria-hidden="true" tabindex="-1"></a>combined_plot <span class="ot">&lt;-</span> combined_plot <span class="sc">+</span> <span class="fu">plot_annotation</span>(</span>
<span id="cb99-35"><a href="#cb99-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"MADRS Score Change and Treatment Effect at Day 28"</span>,</span>
<span id="cb99-36"><a href="#cb99-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">theme =</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>))</span>
<span id="cb99-37"><a href="#cb99-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb99-38"><a href="#cb99-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-39"><a href="#cb99-39" aria-hidden="true" tabindex="-1"></a><span class="co"># 保存组合图</span></span>
<span id="cb99-40"><a href="#cb99-40" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Day28_treatment_effect_with_legend.png"</span>, combined_plot, <span class="at">width =</span> <span class="dv">12</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb99-41"><a href="#cb99-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-42"><a href="#cb99-42" aria-hidden="true" tabindex="-1"></a><span class="co"># 输出绘图数据</span></span>
<span id="cb99-43"><a href="#cb99-43" aria-hidden="true" tabindex="-1"></a>contrasts_all_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AVISITN = 0:
 contrast            estimate         SE     df t.ratio p.value Time
 Dummy B - Dummy A  0.0017143 0.04113726 415.00   0.042  0.9972    0
 Dummy C - Dummy A  0.0494328 0.04177930 415.89   1.183  0.3944    0

AVISITN = 2:
 contrast            estimate         SE     df t.ratio p.value Time
 Dummy B - Dummy A -0.6929711 0.07475349 588.39  -9.270  &lt;.0001    2
 Dummy C - Dummy A -0.5341834 0.09229578 670.43  -5.788  &lt;.0001    2

AVISITN = 8:
 contrast            estimate         SE     df t.ratio p.value Time
 Dummy B - Dummy A -0.6956335 0.09261148 668.33  -7.511  &lt;.0001    8
 Dummy C - Dummy A -0.7727962 0.07955698 595.88  -9.714  &lt;.0001    8

AVISITN = 15:
 contrast            estimate         SE     df t.ratio p.value Time
 Dummy B - Dummy A -0.7412707 0.09620677 508.54  -7.705  &lt;.0001   15
 Dummy C - Dummy A -0.7891862 0.09702519 515.94  -8.134  &lt;.0001   15

AVISITN = 22:
 contrast            estimate         SE     df t.ratio p.value Time
 Dummy B - Dummy A -0.8409304 0.07877781 589.92 -10.675  &lt;.0001   22
 Dummy C - Dummy A -0.6454649 0.09907534 656.61  -6.515  &lt;.0001   22

AVISITN = 28:
 contrast            estimate         SE     df t.ratio p.value Time
 Dummy B - Dummy A -0.8413835 0.09919806 650.97  -8.482  &lt;.0001   28
 Dummy C - Dummy A -0.7983245 0.07905644 595.89 -10.098  &lt;.0001   28

AVISITN = 999:
 contrast            estimate         SE     df t.ratio p.value Time
 Dummy B - Dummy A -0.7011922 0.09474272 512.36  -7.401  &lt;.0001  999
 Dummy C - Dummy A -0.8010667 0.09530024 514.97  -8.406  &lt;.0001  999

Results are averaged over the levels of: 1 nuisance factors, SEX, SITEID, base_situation 
P value adjustment: dunnettx method for 2 tests </code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建森林图展示各时间点的治疗效果</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(contrasts_all_df, <span class="fu">aes</span>(<span class="at">x =</span> AVISITN, <span class="at">y =</span> estimate, <span class="at">color =</span> contrast)) <span class="sc">+</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> estimate <span class="sc">-</span> SE<span class="sc">*</span><span class="fl">1.96</span>, <span class="at">ymax =</span> estimate <span class="sc">+</span> SE<span class="sc">*</span><span class="fl">1.96</span>), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> contrast), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> contrast, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Treatment Effect vs Placebo Over Time"</span>,</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Estimated Differences with 95% Confidence Intervals"</span>,</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Study Day"</span>,</span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Estimated Difference vs Placebo"</span>,</span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Treatment Comparison"</span>,</span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Note: Points below zero favor active treatment over placebo."</span>,</span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Error bars represent 95% confidence intervals."</span>,</span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Non-overlapping confidence intervals with red dashed line (zero) indicate statistical significance."</span>)</span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(<span class="at">discrete =</span> <span class="cn">TRUE</span>, <span class="at">option =</span> <span class="st">"D"</span>,</span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Esketamine 56 mg vs Placebo"</span>, <span class="st">"Esketamine 84 mg vs Placebo"</span>)) <span class="sc">+</span></span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="st">"grey80"</span>),</span>
<span id="cb101-24"><a href="#cb101-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb101-25"><a href="#cb101-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"lightgrey"</span>),</span>
<span id="cb101-26"><a href="#cb101-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb101-27"><a href="#cb101-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb101-28"><a href="#cb101-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb101-29"><a href="#cb101-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb101-30"><a href="#cb101-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"italic"</span>)</span>
<span id="cb101-31"><a href="#cb101-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb101-32"><a href="#cb101-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 添加p值标签</span></span>
<span id="cb101-33"><a href="#cb101-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"p = %.3f"</span>, p.value)), </span>
<span id="cb101-34"><a href="#cb101-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.8</span>, </span>
<span id="cb101-35"><a href="#cb101-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mainCode_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 保存森林图</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Treatment_effect_forest_plot_with_legend.png"</span>, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">8</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建热图展示p值</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 提取所有时间点的p值</span></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>p_values <span class="ot">&lt;-</span> contrasts_all_df</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>p_values<span class="sc">$</span>sig <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(p_values<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.001</span>, <span class="st">"***"</span>,</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">ifelse</span>(p_values<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.01</span>, <span class="st">"**"</span>,</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">ifelse</span>(p_values<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="st">"*"</span>, <span class="st">"ns"</span>)))</span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 数据准备</span></span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>p_values_long <span class="ot">&lt;-</span> p_values <span class="sc">%&gt;%</span></span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Time, contrast, p.value, sig)</span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 添加-log10(p值)列</span></span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a>p_values_long<span class="sc">$</span>neg_log10_p <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">log10</span>(p_values_long<span class="sc">$</span>p.value)</span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a>p_values_long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Time          contrast      p.value sig  neg_log10_p
1     0 Dummy B - Dummy A 9.971599e-01  ns  0.001235183
2     0 Dummy C - Dummy A 3.943676e-01  ns  0.404098792
3     2 Dummy B - Dummy A 2.484033e-10 ***  9.604842643
4     2 Dummy C - Dummy A 2.131253e-08 ***  7.671365020
5     8 Dummy B - Dummy A 1.882938e-13 *** 12.725163922
6     8 Dummy C - Dummy A 2.354221e-10 ***  9.628152722
7    15 Dummy B - Dummy A 8.864287e-11 *** 10.052356187
8    15 Dummy C - Dummy A 1.091197e-10 ***  9.962096784
9    22 Dummy B - Dummy A 2.467375e-10 ***  9.607764806
10   22 Dummy C - Dummy A 1.448419e-10 ***  9.839105738
11   28 Dummy B - Dummy A 2.220446e-16 *** 15.653559775
12   28 Dummy C - Dummy A 2.352738e-10 ***  9.628426432
13  999 Dummy B - Dummy A 1.000091e-10 ***  9.999960428
14  999 Dummy C - Dummy A 1.063928e-10 ***  9.973087829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制p值热图</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(p_values_long, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(Time), <span class="at">y =</span> contrast, <span class="at">fill =</span>  <span class="sc">-</span><span class="fu">log10</span>(p.value))) <span class="sc">+</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 根据显著性调整文本颜色</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> sig, <span class="at">color =</span> <span class="fu">ifelse</span>(p.value <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="st">"white"</span>, <span class="st">"black"</span>)), <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 手动设置文本颜色</span></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_identity</span>() <span class="sc">+</span></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 设置小p值(高-log10(p值))为深色</span></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(<span class="at">option =</span> <span class="st">"C"</span>, <span class="at">name =</span> <span class="st">"-log10(p-value)"</span>, <span class="at">direction =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Statistical Significance of Treatment Effect vs Placebo"</span>,</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"p-values Transformed to -log10 Scale for Visual Clarity"</span>,</span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Study Day"</span>,</span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Treatment Comparison"</span>,</span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"* p&lt;0.05, ** p&lt;0.01, *** p&lt;0.001, ns: not significant"</span>,</span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Darker colors represent smaller p-values (higher statistical significance)"</span>,</span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"The -log10 transformation converts p=0.05 to 1.3, p=0.01 to 2, p=0.001 to 3, etc."</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb104-22"><a href="#cb104-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb104-23"><a href="#cb104-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb104-24"><a href="#cb104-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"italic"</span>),</span>
<span id="cb104-25"><a href="#cb104-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb104-26"><a href="#cb104-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb104-27"><a href="#cb104-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="st">"grey80"</span>)</span>
<span id="cb104-28"><a href="#cb104-28" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mainCode_files/figure-html/unnamed-chunk-12-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 保存热图</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Treatment_significance_heatmap_with_legend.png"</span>, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建模型诊断图</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 提取残差</span></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>residuals <span class="ot">&lt;-</span> <span class="fu">residuals</span>(fit)</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>fitted_values <span class="ot">&lt;-</span> <span class="fu">fitted</span>(fit)</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建诊断数据框</span></span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>diag_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">Fitted =</span> fitted_values,</span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">Residuals =</span> residuals</span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 为QQ图准备数据</span></span>
<span id="cb105-19"><a href="#cb105-19" aria-hidden="true" tabindex="-1"></a>qq_data <span class="ot">&lt;-</span> <span class="fu">qqnorm</span>(residuals, <span class="at">plot.it =</span> <span class="cn">FALSE</span>)</span>
<span id="cb105-20"><a href="#cb105-20" aria-hidden="true" tabindex="-1"></a>qq_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Theoretical =</span> qq_data<span class="sc">$</span>x, <span class="at">Sample =</span> qq_data<span class="sc">$</span>y)</span>
<span id="cb105-21"><a href="#cb105-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-22"><a href="#cb105-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-23"><a href="#cb105-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制残差图</span></span>
<span id="cb105-24"><a href="#cb105-24" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(diag_df, <span class="fu">aes</span>(<span class="at">x =</span> Fitted, <span class="at">y =</span> Residuals)) <span class="sc">+</span></span>
<span id="cb105-25"><a href="#cb105-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb105-26"><a href="#cb105-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb105-27"><a href="#cb105-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">fill =</span> <span class="st">"pink"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb105-28"><a href="#cb105-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb105-29"><a href="#cb105-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Residuals vs Fitted Values"</span>,</span>
<span id="cb105-30"><a href="#cb105-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Assessment of Homoscedasticity and Linearity"</span>,</span>
<span id="cb105-31"><a href="#cb105-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Fitted Values"</span>,</span>
<span id="cb105-32"><a href="#cb105-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Residuals"</span>,</span>
<span id="cb105-33"><a href="#cb105-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Note: Points should be randomly scattered around zero line (red dashed line).</span><span class="sc">\n</span><span class="st">The smooth curve (red) should be approximately horizontal."</span></span>
<span id="cb105-34"><a href="#cb105-34" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb105-35"><a href="#cb105-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb105-36"><a href="#cb105-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb105-37"><a href="#cb105-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb105-38"><a href="#cb105-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb105-39"><a href="#cb105-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb105-40"><a href="#cb105-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"italic"</span>)</span>
<span id="cb105-41"><a href="#cb105-41" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb105-42"><a href="#cb105-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 添加解释性文本</span></span>
<span id="cb105-43"><a href="#cb105-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">min</span>(fitted_values) <span class="sc">+</span> <span class="fl">0.1</span><span class="sc">*</span>(<span class="fu">max</span>(fitted_values)<span class="sc">-</span><span class="fu">min</span>(fitted_values)), </span>
<span id="cb105-44"><a href="#cb105-44" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">max</span>(residuals)<span class="sc">*</span><span class="fl">0.8</span>, </span>
<span id="cb105-45"><a href="#cb105-45" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Ideal pattern: Random scatter</span><span class="sc">\n</span><span class="st">around the zero line with no pattern"</span>, </span>
<span id="cb105-46"><a href="#cb105-46" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">fontface =</span> <span class="st">"italic"</span>)</span>
<span id="cb105-47"><a href="#cb105-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-48"><a href="#cb105-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-49"><a href="#cb105-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-50"><a href="#cb105-50" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制残差的QQ图</span></span>
<span id="cb105-51"><a href="#cb105-51" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(qq_df, <span class="fu">aes</span>(<span class="at">x =</span> Theoretical, <span class="at">y =</span> Sample)) <span class="sc">+</span></span>
<span id="cb105-52"><a href="#cb105-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span> </span>
<span id="cb105-53"><a href="#cb105-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb105-54"><a href="#cb105-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb105-55"><a href="#cb105-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Normal Q-Q Plot of Residuals"</span>,</span>
<span id="cb105-56"><a href="#cb105-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Assessment of Normality Assumption"</span>,</span>
<span id="cb105-57"><a href="#cb105-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Theoretical Quantiles"</span>,</span>
<span id="cb105-58"><a href="#cb105-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Sample Quantiles"</span>,</span>
<span id="cb105-59"><a href="#cb105-59" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb105-60"><a href="#cb105-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb105-61"><a href="#cb105-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb105-62"><a href="#cb105-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb105-63"><a href="#cb105-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb105-64"><a href="#cb105-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb105-65"><a href="#cb105-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"italic"</span>)</span>
<span id="cb105-66"><a href="#cb105-66" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb105-67"><a href="#cb105-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-68"><a href="#cb105-68" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用patchwork组合诊断图</span></span>
<span id="cb105-69"><a href="#cb105-69" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb105-70"><a href="#cb105-70" aria-hidden="true" tabindex="-1"></a>diag_plot <span class="ot">&lt;-</span> p3 <span class="sc">+</span> p4 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb105-71"><a href="#cb105-71" aria-hidden="true" tabindex="-1"></a>diag_plot <span class="ot">&lt;-</span> diag_plot <span class="sc">+</span> <span class="fu">plot_annotation</span>(</span>
<span id="cb105-72"><a href="#cb105-72" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"MMRM Model Diagnostic Plots"</span>,</span>
<span id="cb105-73"><a href="#cb105-73" aria-hidden="true" tabindex="-1"></a>  <span class="at">subtitle =</span> <span class="st">"Assessing Model Assumptions for Valid Statistical Inference"</span>,</span>
<span id="cb105-74"><a href="#cb105-74" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"These diagnostic plots help validate the assumptions of the Mixed Model for Repeated Measures (MMRM) analysis."</span>,</span>
<span id="cb105-75"><a href="#cb105-75" aria-hidden="true" tabindex="-1"></a>  <span class="at">theme =</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb105-76"><a href="#cb105-76" aria-hidden="true" tabindex="-1"></a>               <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb105-77"><a href="#cb105-77" aria-hidden="true" tabindex="-1"></a>               <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"italic"</span>))</span>
<span id="cb105-78"><a href="#cb105-78" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb105-79"><a href="#cb105-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-80"><a href="#cb105-80" aria-hidden="true" tabindex="-1"></a>diag_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mainCode_files/figure-html/unnamed-chunk-12-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>