<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Foundation Math Learning - Tigermed-data-about-depression-clinical-trial</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Foundation Math Learning</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://yuuuulu.github.io/"> 
<span class="menu-text">yuuuulu</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Homepage</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./mth107.qmd"> 
<span class="menu-text">Advanced Linear Algebra</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Simple_ODEs.html"> 
<span class="menu-text">ODEs and PDEs with codes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Mathematical Analysis 1.qmd"> 
<span class="menu-text">Analysis 1</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./mth1113.qmd"> 
<span class="menu-text">intro to prob, and stat.</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Calculus.qmd"> 
<span class="menu-text">Calculus</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#comparegroups" id="toc-comparegroups" class="nav-link active" data-scroll-target="#comparegroups">compareGroups</a></li>
  <li><a href="#group-by-the-level-of-the-desease-" id="toc-group-by-the-level-of-the-desease-" class="nav-link" data-scroll-target="#group-by-the-level-of-the-desease-">group by the level of the desease-</a></li>
  <li><a href="#draw-ci" id="toc-draw-ci" class="nav-link" data-scroll-target="#draw-ci">draw ci</a></li>
  <li><a href="#lm" id="toc-lm" class="nav-link" data-scroll-target="#lm">lm</a>
  <ul class="collapse">
  <li><a href="#主要疗效分析day28" id="toc-主要疗效分析day28" class="nav-link" data-scroll-target="#主要疗效分析day28">主要疗效分析（Day28）</a></li>
  <li><a href="#疗效趋势可视化及森林图" id="toc-疗效趋势可视化及森林图" class="nav-link" data-scroll-target="#疗效趋势可视化及森林图">疗效趋势可视化及森林图</a></li>
  <li><a href="#治疗组vs安慰剂的估计边际均值和差异计算及可视化" id="toc-治疗组vs安慰剂的估计边际均值和差异计算及可视化" class="nav-link" data-scroll-target="#治疗组vs安慰剂的估计边际均值和差异计算及可视化">治疗组vs安慰剂的估计边际均值和差异计算及可视化</a></li>
  <li><a href="#数据可视化有图例和解释" id="toc-数据可视化有图例和解释" class="nav-link" data-scroll-target="#数据可视化有图例和解释">数据可视化（有图例和解释）</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Tigermed-data-about-depression-clinical-trial</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="comparegroups" class="level1">
<h1>compareGroups</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 将SITEID分为5组</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(compareGroups)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>data0 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"/Users/luyu/Desktop/3.xlsx"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 将SITEID转换为数值型变量</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>data0 <span class="ot">&lt;-</span> data0 <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SITEID_num =</span> <span class="fu">as.numeric</span>(<span class="fu">factor</span>(SITEID)))</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用ntile函数分组</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>data0 <span class="ot">&lt;-</span> data0 <span class="sc">%&gt;%</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SITEID_group =</span> <span class="fu">paste0</span>(<span class="st">"Group"</span>, <span class="fu">ntile</span>(SITEID_num, <span class="dv">5</span>)))</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>SITEID_group <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data0<span class="sc">$</span>SITEID_group)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>madrsc <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data0<span class="sc">$</span>BASE <span class="sc">&gt;</span> <span class="dv">40</span>, <span class="st">"MADRS SCORE ≥ 40"</span>,<span class="st">" MADRS SCORE &lt; 40"</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>TRT01A <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data0<span class="sc">$</span>TRT01A)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>TRT01A <span class="ot">&lt;-</span> <span class="fu">relevel</span>(data0<span class="sc">$</span>TRT01A, <span class="at">ref =</span> <span class="st">"Dummy A"</span>)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>SEX <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data0<span class="sc">$</span>SEX)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>RACE <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data0<span class="sc">$</span>RACE)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>RACE <span class="ot">&lt;-</span> <span class="fu">relevel</span>(data0<span class="sc">$</span>RACE, <span class="at">ref =</span> <span class="st">"WHITE"</span>)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 选择变量并创建表格</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>data_table1 <span class="ot">&lt;-</span> data0 <span class="sc">%&gt;%</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(madrsc, AGE, SEX, RACE, TRT01A, PCHG, CHG, BASE, AVAL,SITEID_group )</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="co"># 检查变量类型</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data_table1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [3,243 × 10] (S3: tbl_df/tbl/data.frame)
 $ madrsc      : chr [1:3243] "MADRS SCORE ≥ 40" "MADRS SCORE ≥ 40" "MADRS SCORE ≥ 40" "MADRS SCORE ≥ 40" ...
 $ AGE         : num [1:3243] 37 37 37 37 37 37 37 53 53 53 ...
 $ SEX         : Factor w/ 2 levels "F","M": 1 1 1 1 1 1 1 1 1 1 ...
 $ RACE        : Factor w/ 8 levels "WHITE","AMERICAN INDIAN OR ALASKA NATIVE",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ TRT01A      : Factor w/ 3 levels "Dummy A","Dummy B",..: 1 1 1 1 1 1 1 2 2 2 ...
 $ PCHG        : num [1:3243] NA -19.57 -8.7 -6.52 -8.7 ...
 $ CHG         : num [1:3243] NA -9 -4 -3 -4 -3 -3 NA -17 -10 ...
 $ BASE        : num [1:3243] 46 46 46 46 46 46 46 35 35 35 ...
 $ AVAL        : num [1:3243] 46 37 42 43 42 43 43 35 18 25 ...
 $ SITEID_group: Factor w/ 5 levels "Group1","Group2",..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 检查样本量</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data_table1<span class="sc">$</span>madrsc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 MADRS SCORE &lt; 40  MADRS SCORE ≥ 40 
             2525               716 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建比较表格</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>table1 <span class="ot">&lt;-</span> <span class="fu">compareGroups</span>(madrsc<span class="sc">~</span>., <span class="at">data =</span> data_table1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 如果仍然出现警告，可以尝试使用其他方法来处理变量的尺度差异</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 或者检查数据是否存在数据分离问题等</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>table1 <span class="ot">&lt;-</span> <span class="fu">createTable</span>(table1, <span class="at">show.all =</span> <span class="cn">TRUE</span>, <span class="at">hide.no =</span> <span class="st">"no"</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">show.p.overall=</span><span class="cn">TRUE</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>table1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--------Summary descriptives table by 'madrsc'---------

________________________________________________________________________________________________________ 
                                                  [ALL]      MADRS SCORE &lt; 40 MADRS SCORE ≥ 40 p.overall 
                                                 N=3241          N=2525            N=716                 
¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ 
AGE                                            45.2 (14.0)     45.5 (14.5)      44.4 (12.3)      0.045   
SEX:                                                                                             0.006   
    F                                         1928 (59.5%)    1470 (58.2%)      458 (64.0%)              
    M                                         1313 (40.5%)    1055 (41.8%)      258 (36.0%)              
RACE:                                                                                              .     
    WHITE                                     2788 (86.0%)    2177 (86.2%)      611 (85.3%)              
    AMERICAN INDIAN OR ALASKA NATIVE            6 (0.19%)       6 (0.24%)        0 (0.00%)               
    ASIAN                                      97 (2.99%)      83 (3.29%)        14 (1.96%)              
    BLACK OR AFRICAN AMERICAN                  241 (7.44%)     185 (7.33%)       56 (7.82%)              
    MULTIPLE                                   60 (1.85%)      46 (1.82%)        14 (1.96%)              
    NATIVE HAWAIIAN OR OTHER PACIFIC ISLANDER  14 (0.43%)       7 (0.28%)        7 (0.98%)               
    NOT REPORTED                               28 (0.86%)      21 (0.83%)        7 (0.98%)               
    UNKNOWN                                     7 (0.22%)       0 (0.00%)        7 (0.98%)               
TRT01A:                                                                                          0.429   
    Dummy A                                   1610 (49.7%)    1252 (49.6%)      358 (50.0%)              
    Dummy B                                    819 (25.3%)     650 (25.7%)      169 (23.6%)              
    Dummy C                                    812 (25.1%)     623 (24.7%)      189 (26.4%)              
PCHG                                          -24.64 (29.4)   -24.71 (29.8)    -24.39 (27.9)     0.802   
CHG                                           -8.82 (10.4)    -8.31 (9.82)     -10.61 (12.2)    &lt;0.001   
BASE                                           35.4 (6.36)     33.1 (5.09)      43.6 (2.26)      0.000   
AVAL                                           27.9 (11.1)     26.0 (10.0)      34.5 (12.1)     &lt;0.001   
SITEID_group:                                                                                   &lt;0.001   
    Group1                                     649 (20.0%)     486 (19.2%)      163 (22.8%)              
    Group2                                     649 (20.0%)     516 (20.4%)      133 (18.6%)              
    Group3                                     647 (20.0%)     430 (17.0%)      217 (30.3%)              
    Group4                                     648 (20.0%)     552 (21.9%)       96 (13.4%)              
    Group5                                     648 (20.0%)     541 (21.4%)      107 (14.9%)              
¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ </code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(table1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>


---Available data----

_________________________________________________________________________________________ 
             [ALL]  MADRS SCORE &lt; 40 MADRS SCORE ≥ 40      method       select Fact OR/HR 
¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ 
AGE          3241        2525              716        continuous-normal  ALL       1      
SEX          3241        2525              716           categorical     ALL       --     
RACE         3241        2525              716           categorical     ALL       --     
TRT01A       3241        2525              716           categorical     ALL       --     
PCHG         2765        2153              612        continuous-normal  ALL       1      
CHG          2765        2153              612        continuous-normal  ALL       1      
BASE         3241        2525              716        continuous-normal  ALL       1      
AVAL         3241        2525              716        continuous-normal  ALL       1      
SITEID_group 3241        2525              716           categorical     ALL       --     
¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ </code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>?compareGroups</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(compareGroups)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>data0 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"/Users/luyu/Desktop/3.xlsx"</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>madrsc <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data0<span class="sc">$</span>BASE <span class="sc">&gt;</span> <span class="dv">40</span>, <span class="st">"MADRS SCORE ≥ 40"</span>,<span class="st">" MADRS SCORE &lt; 40"</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>AGE <span class="ot">&lt;-</span> <span class="fu">scale</span>(data0<span class="sc">$</span>AGE)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>AVAL <span class="ot">&lt;-</span> <span class="fu">scale</span>(data0<span class="sc">$</span>AVAL)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>BASE <span class="ot">&lt;-</span> <span class="fu">scale</span>(data0<span class="sc">$</span>BASE)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>TRT01A <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data0<span class="sc">$</span>TRT01A)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>TRT01A <span class="ot">&lt;-</span> <span class="fu">relevel</span>(data0<span class="sc">$</span>TRT01A, <span class="at">ref =</span> <span class="st">"Dummy A"</span>)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>SEX <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data0<span class="sc">$</span>SEX)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>RACE <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data0<span class="sc">$</span>RACE)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>RACE <span class="ot">&lt;-</span> <span class="fu">relevel</span>(data0<span class="sc">$</span>RACE, <span class="at">ref =</span> <span class="st">"WHITE"</span>)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>data0<span class="sc">$</span>PCHG <span class="ot">&lt;-</span> <span class="fu">scale</span>(data0<span class="sc">$</span>PCHG)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>data_table1 <span class="ot">&lt;-</span> data0 <span class="sc">%&gt;%</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(madrsc, AGE, SEX, RACE, TRT01A, PCHG, CHG, BASE, AVAL)</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>table1 <span class="ot">&lt;-</span> <span class="fu">compareGroups</span>(madrsc<span class="sc">~</span>., <span class="at">data =</span> data_table1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>table1 <span class="ot">&lt;-</span> <span class="fu">createTable</span>(table1, <span class="at">show.all =</span> <span class="cn">TRUE</span>, <span class="at">hide.no =</span> <span class="st">"no"</span>,</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">show.p.overall=</span><span class="cn">TRUE</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>table1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--------Summary descriptives table by 'madrsc'---------

_______________________________________________________________________________________________________ 
                                                 [ALL]      MADRS SCORE &lt; 40 MADRS SCORE ≥ 40 p.overall 
                                                 N=3241         N=2525            N=716                 
¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ 
AGE                                           0.00 (1.00)     0.02 (1.03)      -0.06 (0.88)     0.045   
SEX:                                                                                            0.006   
    F                                         1928 (59.5%)   1470 (58.2%)      458 (64.0%)              
    M                                         1313 (40.5%)   1055 (41.8%)      258 (36.0%)              
RACE:                                                                                             .     
    WHITE                                     2788 (86.0%)   2177 (86.2%)      611 (85.3%)              
    AMERICAN INDIAN OR ALASKA NATIVE           6 (0.19%)       6 (0.24%)        0 (0.00%)               
    ASIAN                                      97 (2.99%)     83 (3.29%)        14 (1.96%)              
    BLACK OR AFRICAN AMERICAN                 241 (7.44%)     185 (7.33%)       56 (7.82%)              
    MULTIPLE                                   60 (1.85%)     46 (1.82%)        14 (1.96%)              
    NATIVE HAWAIIAN OR OTHER PACIFIC ISLANDER  14 (0.43%)      7 (0.28%)        7 (0.98%)               
    NOT REPORTED                               28 (0.86%)     21 (0.83%)        7 (0.98%)               
    UNKNOWN                                    7 (0.22%)       0 (0.00%)        7 (0.98%)               
TRT01A:                                                                                         0.429   
    Dummy A                                   1610 (49.7%)   1252 (49.6%)      358 (50.0%)              
    Dummy B                                   819 (25.3%)     650 (25.7%)      169 (23.6%)              
    Dummy C                                   812 (25.1%)     623 (24.7%)      189 (26.4%)              
PCHG                                          0.00 (1.00)     0.00 (1.01)      0.01 (0.95)      0.802   
CHG                                           -8.82 (10.4)   -8.31 (9.82)     -10.61 (12.2)    &lt;0.001   
BASE                                          0.00 (1.00)    -0.37 (0.80)      1.29 (0.36)      0.000   
AVAL                                          0.00 (1.00)    -0.17 (0.90)      0.60 (1.09)     &lt;0.001   
¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ </code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(table1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>


---Available data----

___________________________________________________________________________________ 
       [ALL]  MADRS SCORE &lt; 40 MADRS SCORE ≥ 40      method       select Fact OR/HR 
¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ 
AGE    3241        2525              716        continuous-normal  ALL       1      
SEX    3241        2525              716           categorical     ALL       --     
RACE   3241        2525              716           categorical     ALL       --     
TRT01A 3241        2525              716           categorical     ALL       --     
PCHG   2765        2153              612        continuous-normal  ALL       1      
CHG    2765        2153              612        continuous-normal  ALL       1      
BASE   3241        2525              716        continuous-normal  ALL       1      
AVAL   3241        2525              716        continuous-normal  ALL       1      
¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ </code></pre>
</div>
</div>
</section>
<section id="group-by-the-level-of-the-desease-" class="level1">
<h1>group by the level of the desease-</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mmrm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'mmrm' was built under R version 4.4.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>admadrs <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"/Users/luyu/Desktop/3.xlsx"</span>, </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sheet =</span> <span class="st">"Sheet1"</span>, <span class="at">col_names =</span> <span class="cn">TRUE</span>, </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">col_types =</span> <span class="cn">NULL</span>, <span class="at">na =</span> <span class="st">""</span>, <span class="at">skip =</span> <span class="dv">0</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建分类变量 base_situation</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>base_situation <span class="ot">&lt;-</span> <span class="fu">cut</span>(</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  admadrs<span class="sc">$</span>BASE,</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="fu">c</span>( <span class="dv">9</span>, <span class="dv">19</span>, <span class="dv">39</span>, <span class="cn">Inf</span>),</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"10-19"</span>, <span class="st">"20-39"</span>, <span class="st">"40+"</span>),</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 将 base_situation 转换为因子类型</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>base_situation <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(admadrs<span class="sc">$</span>base_situation)</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>USUBJID <span class="ot">&lt;-</span> <span class="fu">factor</span>(admadrs<span class="sc">$</span>USUBJID)</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>AVISITN <span class="ot">&lt;-</span> admadrs<span class="sc">$</span>AVISITN <span class="sc">-</span> <span class="dv">20000</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>AVISITN <span class="ot">&lt;-</span> <span class="fu">factor</span>(admadrs<span class="sc">$</span>AVISITN)</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>CHG <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(admadrs<span class="sc">$</span>CHG)</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>base_situation <span class="ot">&lt;-</span> <span class="fu">relevel</span>(admadrs<span class="sc">$</span>base_situation, <span class="at">ref =</span> <span class="st">"40+"</span>)</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Delete a duplicate point in time</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>admadrs <span class="ot">&lt;-</span> admadrs[<span class="sc">!</span><span class="fu">duplicated</span>(admadrs[<span class="fu">c</span>(<span class="st">"USUBJID"</span>, <span class="st">"AVISIT"</span>)]), ]</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a><span class="co"># scale data </span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>AGE <span class="ot">&lt;-</span> <span class="fu">scale</span>(admadrs<span class="sc">$</span>AGE)</span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>admadrs<span class="sc">$</span>AVAL <span class="ot">&lt;-</span> <span class="fu">scale</span>(admadrs<span class="sc">$</span>AVAL)</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a><span class="co"># 更新模型以包括 base_situation</span></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">mmrm</span>(</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> AVAL <span class="sc">~</span> AVISITN<span class="sc">:</span>TRT01A <span class="sc">+</span>TRT01A <span class="sc">+</span>SEX<span class="sc">+</span> SITEID<span class="sc">+</span> RACE <span class="sc">+</span> AGE <span class="sc">+</span> base_situation <span class="sc">+</span> <span class="fu">us</span>(AVISITN <span class="sc">|</span> USUBJID),</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> admadrs)</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a><span class="co"># 获取模型摘要</span></span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>model_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(fit)</span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a>model_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>mmrm fit

Formula:     AVAL ~ AVISITN:TRT01A + TRT01A + SEX + SITEID + RACE + AGE +  
    base_situation + us(AVISITN | USUBJID)
Data:        admadrs (used 3214 observations from 476 subjects with maximum 7 
timepoints)
Covariance:  unstructured (28 variance parameters)
Method:      Satterthwaite
Vcov Method: Asymptotic
Inference:   REML

Model selection criteria:
     AIC      BIC   logLik deviance 
  3856.3   3972.9  -1900.1   3800.3 

Coefficients: 
                                                Estimate Std. Error         df
(Intercept)                                    1.801e+00  3.756e-01  4.145e+02
TRT01ADummy B                                  1.714e-03  4.114e-02  4.150e+02
TRT01ADummy C                                  4.943e-02  4.178e-02  4.159e+02
SEXM                                          -3.458e-02  3.568e-02  4.151e+02
SITEIDUS10002                                  8.039e-02  1.248e-01  4.147e+02
SITEIDUS10004                                 -2.118e-01  1.723e-01  4.145e+02
SITEIDUS10005                                  2.211e-01  3.625e-01  4.143e+02
SITEIDUS10006                                 -1.343e-01  1.241e-01  4.147e+02
SITEIDUS10008                                 -5.671e-01  1.897e-01  4.157e+02
SITEIDUS10009                                 -1.067e-01  1.344e-01  4.145e+02
SITEIDUS10013                                  1.027e-01  1.206e-01  4.143e+02
SITEIDUS10014                                  1.153e-01  1.354e-01  4.161e+02
SITEIDUS10015                                  1.455e-01  1.213e-01  4.145e+02
SITEIDUS10016                                 -2.962e-01  2.618e-01  4.200e+02
SITEIDUS10017                                 -1.249e-01  1.587e-01  4.152e+02
SITEIDUS10019                                 -6.638e-02  1.350e-01  4.143e+02
SITEIDUS10020                                 -3.592e-01  1.397e-01  4.144e+02
SITEIDUS10021                                 -1.470e-01  1.174e-01  4.144e+02
SITEIDUS10023                                 -6.167e-01  2.590e-01  4.146e+02
SITEIDUS10025                                  2.665e-02  1.587e-01  4.143e+02
SITEIDUS10027                                 -1.780e-01  2.604e-01  4.143e+02
SITEIDUS10029                                  4.001e-02  1.086e-01  4.146e+02
SITEIDUS10030                                 -5.887e-02  1.016e-01  4.146e+02
SITEIDUS10031                                 -5.395e-02  1.517e-01  4.143e+02
SITEIDUS10033                                  4.711e-04  1.558e-01  4.321e+02
SITEIDUS10034                                  3.307e-02  1.716e-01  4.143e+02
SITEIDUS10036                                  3.019e-01  1.258e-01  4.143e+02
SITEIDUS10039                                  5.580e-01  3.613e-01  4.143e+02
SITEIDUS10040                                  7.344e-02  1.912e-01  4.145e+02
SITEIDUS10041                                  1.468e-01  1.584e-01  4.145e+02
SITEIDUS10043                                 -1.695e-01  1.165e-01  4.149e+02
SITEIDUS10044                                 -9.636e-02  2.164e-01  4.147e+02
SITEIDUS10045                                 -1.581e-02  1.888e-01  4.143e+02
SITEIDUS10046                                  1.849e-01  1.592e-01  4.147e+02
SITEIDUS10049                                  1.036e-01  1.582e-01  4.143e+02
SITEIDUS10051                                 -8.296e-02  1.149e-01  4.143e+02
SITEIDUS10053                                  4.168e-01  3.866e-01  4.144e+02
SITEIDUS10055                                  1.125e-02  1.228e-01  4.145e+02
SITEIDUS10056                                 -3.738e-01  1.305e-01  4.151e+02
SITEIDUS10057                                  6.903e-02  1.368e-01  4.146e+02
SITEIDUS10058                                 -1.250e-01  1.210e-01  4.144e+02
SITEIDUS10062                                  1.243e-03  8.932e-02  4.147e+02
SITEIDUS10068                                  7.517e-02  1.066e-01  4.144e+02
SITEIDUS10069                                  2.575e-01  2.159e-01  4.143e+02
SITEIDUS10070                                 -9.618e-02  8.767e-02  4.146e+02
SITEIDUS10071                                 -2.820e-01  1.605e-01  4.145e+02
SITEIDUS10073                                 -1.095e-01  3.614e-01  4.142e+02
SITEIDUS10074                                 -1.269e-01  1.118e-01  4.149e+02
SITEIDUS10075                                 -6.080e-03  8.878e-02  4.145e+02
SITEIDUS10076                                 -3.652e-01  1.489e-01  4.149e+02
RACEASIAN                                     -2.722e-01  3.818e-01  4.145e+02
RACEBLACK OR AFRICAN AMERICAN                 -5.534e-01  3.736e-01  4.144e+02
RACEMULTIPLE                                  -6.407e-01  3.931e-01  4.146e+02
RACENATIVE HAWAIIAN OR OTHER PACIFIC ISLANDER -4.206e-01  4.507e-01  4.146e+02
RACENOT REPORTED                              -2.520e-01  4.152e-01  4.145e+02
RACEUNKNOWN                                   -4.518e-01  5.227e-01  4.146e+02
RACEWHITE                                     -4.490e-01  3.680e-01  4.144e+02
AGE                                            2.227e-02  1.815e-02  4.169e+02
base_situation10-19                           -2.334e+00  1.881e-01  4.146e+02
base_situation20-39                           -8.527e-01  4.104e-02  4.146e+02
TRT01ADummy A:AVISITN2                        -1.006e+00  5.927e-02  4.685e+02
TRT01ADummy B:AVISITN2                        -9.346e-01  8.285e-02  4.673e+02
TRT01ADummy C:AVISITN2                        -9.810e-01  8.363e-02  4.725e+02
TRT01ADummy A:AVISITN8                        -6.510e-01  5.605e-02  4.635e+02
TRT01ADummy B:AVISITN8                        -5.695e-01  7.832e-02  4.621e+02
TRT01ADummy C:AVISITN8                        -7.166e-01  7.915e-02  4.692e+02
TRT01ADummy A:AVISITN15                       -6.947e-01  5.904e-02  4.645e+02
TRT01ADummy B:AVISITN15                       -5.836e-01  8.230e-02  4.594e+02
TRT01ADummy C:AVISITN15                       -6.973e-01  8.296e-02  4.642e+02
TRT01ADummy A:AVISITN22                       -8.222e-01  6.503e-02  4.706e+02
TRT01ADummy B:AVISITN22                       -7.430e-01  9.089e-02  4.687e+02
TRT01ADummy C:AVISITN22                       -8.386e-01  9.160e-02  4.741e+02
TRT01ADummy A:AVISITN28                       -8.426e-01  6.419e-02  4.703e+02
TRT01ADummy B:AVISITN28                       -6.949e-01  8.984e-02  4.704e+02
TRT01ADummy C:AVISITN28                       -8.431e-01  9.026e-02  4.712e+02
TRT01ADummy A:AVISITN999                      -8.478e-01  6.413e-02  4.704e+02
TRT01ADummy B:AVISITN999                      -7.029e-01  8.975e-02  4.703e+02
TRT01ADummy C:AVISITN999                      -8.505e-01  9.018e-02  4.712e+02
                                              t value Pr(&gt;|t|)    
(Intercept)                                     4.797 2.25e-06 ***
TRT01ADummy B                                   0.042  0.96678    
TRT01ADummy C                                   1.183  0.23741    
SEXM                                           -0.969  0.33304    
SITEIDUS10002                                   0.644  0.51993    
SITEIDUS10004                                  -1.229  0.21977    
SITEIDUS10005                                   0.610  0.54227    
SITEIDUS10006                                  -1.082  0.27979    
SITEIDUS10008                                  -2.989  0.00297 ** 
SITEIDUS10009                                  -0.793  0.42801    
SITEIDUS10013                                   0.851  0.39515    
SITEIDUS10014                                   0.851  0.39523    
SITEIDUS10015                                   1.200  0.23089    
SITEIDUS10016                                  -1.131  0.25857    
SITEIDUS10017                                  -0.787  0.43159    
SITEIDUS10019                                  -0.492  0.62330    
SITEIDUS10020                                  -2.570  0.01050 *  
SITEIDUS10021                                  -1.251  0.21150    
SITEIDUS10023                                  -2.381  0.01772 *  
SITEIDUS10025                                   0.168  0.86671    
SITEIDUS10027                                  -0.684  0.49467    
SITEIDUS10029                                   0.368  0.71276    
SITEIDUS10030                                  -0.580  0.56242    
SITEIDUS10031                                  -0.356  0.72223    
SITEIDUS10033                                   0.003  0.99759    
SITEIDUS10034                                   0.193  0.84725    
SITEIDUS10036                                   2.399  0.01686 *  
SITEIDUS10039                                   1.544  0.12327    
SITEIDUS10040                                   0.384  0.70103    
SITEIDUS10041                                   0.927  0.35462    
SITEIDUS10043                                  -1.455  0.14654    
SITEIDUS10044                                  -0.445  0.65633    
SITEIDUS10045                                  -0.084  0.93330    
SITEIDUS10046                                   1.161  0.24619    
SITEIDUS10049                                   0.655  0.51274    
SITEIDUS10051                                  -0.722  0.47075    
SITEIDUS10053                                   1.078  0.28162    
SITEIDUS10055                                   0.092  0.92704    
SITEIDUS10056                                  -2.865  0.00438 ** 
SITEIDUS10057                                   0.505  0.61416    
SITEIDUS10058                                  -1.033  0.30204    
SITEIDUS10062                                   0.014  0.98890    
SITEIDUS10068                                   0.705  0.48119    
SITEIDUS10069                                   1.193  0.23357    
SITEIDUS10070                                  -1.097  0.27325    
SITEIDUS10071                                  -1.756  0.07974 .  
SITEIDUS10073                                  -0.303  0.76212    
SITEIDUS10074                                  -1.135  0.25699    
SITEIDUS10075                                  -0.068  0.94543    
SITEIDUS10076                                  -2.453  0.01458 *  
RACEASIAN                                      -0.713  0.47634    
RACEBLACK OR AFRICAN AMERICAN                  -1.481  0.13936    
RACEMULTIPLE                                   -1.630  0.10385    
RACENATIVE HAWAIIAN OR OTHER PACIFIC ISLANDER  -0.933  0.35130    
RACENOT REPORTED                               -0.607  0.54414    
RACEUNKNOWN                                    -0.864  0.38792    
RACEWHITE                                      -1.220  0.22316    
AGE                                             1.227  0.22045    
base_situation10-19                           -12.409  &lt; 2e-16 ***
base_situation20-39                           -20.780  &lt; 2e-16 ***
TRT01ADummy A:AVISITN2                        -16.977  &lt; 2e-16 ***
TRT01ADummy B:AVISITN2                        -11.280  &lt; 2e-16 ***
TRT01ADummy C:AVISITN2                        -11.730  &lt; 2e-16 ***
TRT01ADummy A:AVISITN8                        -11.615  &lt; 2e-16 ***
TRT01ADummy B:AVISITN8                         -7.272 1.53e-12 ***
TRT01ADummy C:AVISITN8                         -9.054  &lt; 2e-16 ***
TRT01ADummy A:AVISITN15                       -11.767  &lt; 2e-16 ***
TRT01ADummy B:AVISITN15                        -7.091 5.04e-12 ***
TRT01ADummy C:AVISITN15                        -8.405 5.26e-16 ***
TRT01ADummy A:AVISITN22                       -12.644  &lt; 2e-16 ***
TRT01ADummy B:AVISITN22                        -8.174 2.80e-15 ***
TRT01ADummy C:AVISITN22                        -9.155  &lt; 2e-16 ***
TRT01ADummy A:AVISITN28                       -13.128  &lt; 2e-16 ***
TRT01ADummy B:AVISITN28                        -7.735 6.34e-14 ***
TRT01ADummy C:AVISITN28                        -9.341  &lt; 2e-16 ***
TRT01ADummy A:AVISITN999                      -13.220  &lt; 2e-16 ***
TRT01ADummy B:AVISITN999                       -7.832 3.22e-14 ***
TRT01ADummy C:AVISITN999                       -9.432  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Covariance estimate:
         0      2      8     15     22     28    999
0   0.1287 0.0888 0.0953 0.0803 0.0868 0.0823 0.0825
2   0.0888 0.8656 0.5780 0.5356 0.5578 0.5590 0.5641
8   0.0953 0.5780 0.7920 0.6422 0.6594 0.6253 0.6281
15  0.0803 0.5356 0.6422 0.8390 0.7808 0.7318 0.7309
22  0.0868 0.5578 0.6594 0.7808 1.0246 0.8898 0.8910
28  0.0823 0.5590 0.6253 0.7318 0.8898 1.0037 0.9993
999 0.0825 0.5641 0.6281 0.7309 0.8910 0.9993 1.0028</code></pre>
</div>
</div>
</section>
<section id="draw-ci" class="level1">
<h1>draw ci</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 提取系数估计值和标准误差，并筛选出包含 "SITE" 的系数</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>coef_table <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(model_summary<span class="sc">$</span>coefficients)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算置信区间</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>coef_table<span class="sc">$</span>LowerCI <span class="ot">&lt;-</span> coef_table<span class="sc">$</span>Estimate <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> coef_table<span class="sc">$</span><span class="st">`</span><span class="at">Std. Error</span><span class="st">`</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>coef_table<span class="sc">$</span>UpperCI <span class="ot">&lt;-</span> coef_table<span class="sc">$</span>Estimate <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> coef_table<span class="sc">$</span><span class="st">`</span><span class="at">Std. Error</span><span class="st">`</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 美化P值显示</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>format_pvalue <span class="ot">&lt;-</span> <span class="cf">function</span>(p) {</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(p <span class="sc">&lt;</span> <span class="fl">0.001</span>, <span class="st">"&lt;0.001"</span>, </span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>         <span class="fu">ifelse</span>(p <span class="sc">&lt;</span> <span class="fl">0.01</span>, <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, p),</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>                <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, p)))</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>result_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="fu">rownames</span>(model_summary<span class="sc">$</span>coefficients),</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">Coefficient =</span> <span class="fu">round</span>(coef_table<span class="sc">$</span>Estimate, <span class="dv">3</span>),</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">CI =</span> <span class="fu">paste0</span>(<span class="st">"("</span>, <span class="fu">round</span>(coef_table<span class="sc">$</span>LowerCI, <span class="dv">3</span>), <span class="st">", "</span>, <span class="fu">round</span>(coef_table<span class="sc">$</span>UpperCI, <span class="dv">3</span>), <span class="st">")"</span>),</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">P-value</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sapply</span>(coef_table<span class="sc">$</span><span class="st">`</span><span class="at">Pr(&gt;|t|)</span><span class="st">`</span>, format_pvalue)</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>result_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                        variable Coefficient               CI
1                                    (Intercept)       1.801   (1.065, 2.538)
2                                  TRT01ADummy B       0.002  (-0.079, 0.082)
3                                  TRT01ADummy C       0.049  (-0.032, 0.131)
4                                           SEXM      -0.035  (-0.105, 0.035)
5                                  SITEIDUS10002       0.080  (-0.164, 0.325)
6                                  SITEIDUS10004      -0.212   (-0.55, 0.126)
7                                  SITEIDUS10005       0.221  (-0.489, 0.932)
8                                  SITEIDUS10006      -0.134  (-0.377, 0.109)
9                                  SITEIDUS10008      -0.567 (-0.939, -0.195)
10                                 SITEIDUS10009      -0.107   (-0.37, 0.157)
11                                 SITEIDUS10013       0.103  (-0.134, 0.339)
12                                 SITEIDUS10014       0.115   (-0.15, 0.381)
13                                 SITEIDUS10015       0.146  (-0.092, 0.383)
14                                 SITEIDUS10016      -0.296  (-0.809, 0.217)
15                                 SITEIDUS10017      -0.125  (-0.436, 0.186)
16                                 SITEIDUS10019      -0.066  (-0.331, 0.198)
17                                 SITEIDUS10020      -0.359 (-0.633, -0.085)
18                                 SITEIDUS10021      -0.147  (-0.377, 0.083)
19                                 SITEIDUS10023      -0.617 (-1.124, -0.109)
20                                 SITEIDUS10025       0.027  (-0.284, 0.338)
21                                 SITEIDUS10027      -0.178  (-0.688, 0.332)
22                                 SITEIDUS10029       0.040  (-0.173, 0.253)
23                                 SITEIDUS10030      -0.059   (-0.258, 0.14)
24                                 SITEIDUS10031      -0.054  (-0.351, 0.243)
25                                 SITEIDUS10033       0.000  (-0.305, 0.306)
26                                 SITEIDUS10034       0.033  (-0.303, 0.369)
27                                 SITEIDUS10036       0.302   (0.055, 0.549)
28                                 SITEIDUS10039       0.558   (-0.15, 1.266)
29                                 SITEIDUS10040       0.073  (-0.301, 0.448)
30                                 SITEIDUS10041       0.147  (-0.164, 0.457)
31                                 SITEIDUS10043      -0.170  (-0.398, 0.059)
32                                 SITEIDUS10044      -0.096  (-0.521, 0.328)
33                                 SITEIDUS10045      -0.016  (-0.386, 0.354)
34                                 SITEIDUS10046       0.185  (-0.127, 0.497)
35                                 SITEIDUS10049       0.104  (-0.206, 0.414)
36                                 SITEIDUS10051      -0.083  (-0.308, 0.142)
37                                 SITEIDUS10053       0.417  (-0.341, 1.175)
38                                 SITEIDUS10055       0.011  (-0.229, 0.252)
39                                 SITEIDUS10056      -0.374  (-0.63, -0.118)
40                                 SITEIDUS10057       0.069  (-0.199, 0.337)
41                                 SITEIDUS10058      -0.125  (-0.362, 0.112)
42                                 SITEIDUS10062       0.001  (-0.174, 0.176)
43                                 SITEIDUS10068       0.075  (-0.134, 0.284)
44                                 SITEIDUS10069       0.258  (-0.166, 0.681)
45                                 SITEIDUS10070      -0.096  (-0.268, 0.076)
46                                 SITEIDUS10071      -0.282  (-0.597, 0.033)
47                                 SITEIDUS10073      -0.109  (-0.818, 0.599)
48                                 SITEIDUS10074      -0.127  (-0.346, 0.092)
49                                 SITEIDUS10075      -0.006   (-0.18, 0.168)
50                                 SITEIDUS10076      -0.365 (-0.657, -0.073)
51                                     RACEASIAN      -0.272  (-1.021, 0.476)
52                 RACEBLACK OR AFRICAN AMERICAN      -0.553  (-1.286, 0.179)
53                                  RACEMULTIPLE      -0.641   (-1.411, 0.13)
54 RACENATIVE HAWAIIAN OR OTHER PACIFIC ISLANDER      -0.421  (-1.304, 0.463)
55                              RACENOT REPORTED      -0.252  (-1.066, 0.562)
56                                   RACEUNKNOWN      -0.452  (-1.476, 0.573)
57                                     RACEWHITE      -0.449   (-1.17, 0.272)
58                                           AGE       0.022  (-0.013, 0.058)
59                           base_situation10-19      -2.334 (-2.702, -1.965)
60                           base_situation20-39      -0.853 (-0.933, -0.772)
61                        TRT01ADummy A:AVISITN2      -1.006  (-1.122, -0.89)
62                        TRT01ADummy B:AVISITN2      -0.935 (-1.097, -0.772)
63                        TRT01ADummy C:AVISITN2      -0.981 (-1.145, -0.817)
64                        TRT01ADummy A:AVISITN8      -0.651 (-0.761, -0.541)
65                        TRT01ADummy B:AVISITN8      -0.570 (-0.723, -0.416)
66                        TRT01ADummy C:AVISITN8      -0.717 (-0.872, -0.561)
67                       TRT01ADummy A:AVISITN15      -0.695  (-0.81, -0.579)
68                       TRT01ADummy B:AVISITN15      -0.584 (-0.745, -0.422)
69                       TRT01ADummy C:AVISITN15      -0.697  (-0.86, -0.535)
70                       TRT01ADummy A:AVISITN22      -0.822  (-0.95, -0.695)
71                       TRT01ADummy B:AVISITN22      -0.743 (-0.921, -0.565)
72                       TRT01ADummy C:AVISITN22      -0.839 (-1.018, -0.659)
73                       TRT01ADummy A:AVISITN28      -0.843 (-0.968, -0.717)
74                       TRT01ADummy B:AVISITN28      -0.695 (-0.871, -0.519)
75                       TRT01ADummy C:AVISITN28      -0.843  (-1.02, -0.666)
76                      TRT01ADummy A:AVISITN999      -0.848 (-0.973, -0.722)
77                      TRT01ADummy B:AVISITN999      -0.703 (-0.879, -0.527)
78                      TRT01ADummy C:AVISITN999      -0.850 (-1.027, -0.674)
   P.value
1   &lt;0.001
2     0.97
3     0.24
4     0.33
5     0.52
6     0.22
7     0.54
8     0.28
9    0.003
10    0.43
11    0.40
12    0.40
13    0.23
14    0.26
15    0.43
16    0.62
17    0.01
18    0.21
19    0.02
20    0.87
21    0.49
22    0.71
23    0.56
24    0.72
25    1.00
26    0.85
27    0.02
28    0.12
29    0.70
30    0.35
31    0.15
32    0.66
33    0.93
34    0.25
35    0.51
36    0.47
37    0.28
38    0.93
39   0.004
40    0.61
41    0.30
42    0.99
43    0.48
44    0.23
45    0.27
46    0.08
47    0.76
48    0.26
49    0.95
50    0.01
51    0.48
52    0.14
53    0.10
54    0.35
55    0.54
56    0.39
57    0.22
58    0.22
59  &lt;0.001
60  &lt;0.001
61  &lt;0.001
62  &lt;0.001
63  &lt;0.001
64  &lt;0.001
65  &lt;0.001
66  &lt;0.001
67  &lt;0.001
68  &lt;0.001
69  &lt;0.001
70  &lt;0.001
71  &lt;0.001
72  &lt;0.001
73  &lt;0.001
74  &lt;0.001
75  &lt;0.001
76  &lt;0.001
77  &lt;0.001
78  &lt;0.001</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 导出到Excel</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co">#library(writexl)</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">#write_xlsx(result_table, "mmrm_results.xlsx")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="lm" class="level1">
<h1>lm</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用 lm 拟合线性模型</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>fit_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> AVAL <span class="sc">~</span> AVISITN<span class="sc">:</span>TRT01A <span class="sc">+</span>TRT01A <span class="sc">+</span> SITEID<span class="sc">+</span> RACE <span class="sc">+</span> AGE <span class="sc">+</span> base_situation,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> admadrs</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = AVAL ~ AVISITN:TRT01A + TRT01A + SITEID + RACE + 
    AGE + base_situation, data = admadrs)

Residuals:
    Min      1Q  Median      3Q     Max 
-2.7612 -0.4780  0.1187  0.5814  2.1366 

Coefficients:
                                              Estimate Std. Error t value
(Intercept)                                    1.71542    0.37155   4.617
TRT01ADummy B                                 -0.02879    0.09610  -0.300
TRT01ADummy C                                  0.04646    0.09678   0.480
SITEIDUS10002                                  0.02089    0.11608   0.180
SITEIDUS10004                                  0.12149    0.15902   0.764
SITEIDUS10005                                  0.24366    0.33050   0.737
SITEIDUS10006                                 -0.17280    0.11428  -1.512
SITEIDUS10008                                 -0.34969    0.19240  -1.817
SITEIDUS10009                                  0.24909    0.12509   1.991
SITEIDUS10013                                  0.56116    0.11016   5.094
SITEIDUS10014                                  0.17056    0.12858   1.326
SITEIDUS10015                                  0.03213    0.11271   0.285
SITEIDUS10016                                 -0.30379    0.30909  -0.983
SITEIDUS10017                                 -0.04176    0.15110  -0.276
SITEIDUS10019                                 -0.15188    0.12295  -1.235
SITEIDUS10020                                 -0.38872    0.12855  -3.024
SITEIDUS10021                                  0.27363    0.10667   2.565
SITEIDUS10023                                 -0.29919    0.25405  -1.178
SITEIDUS10025                                  0.31938    0.14496   2.203
SITEIDUS10027                                 -0.33069    0.23768  -1.391
SITEIDUS10029                                  0.03777    0.10003   0.378
SITEIDUS10030                                  0.01878    0.09352   0.201
SITEIDUS10031                                 -0.26735    0.13852  -1.930
SITEIDUS10033                                  0.19930    0.13631   1.462
SITEIDUS10034                                  0.30245    0.15667   1.931
SITEIDUS10036                                 -0.36938    0.11498  -3.213
SITEIDUS10039                                  1.00520    0.32949   3.051
SITEIDUS10040                                  0.12201    0.17742   0.688
SITEIDUS10041                                  0.15199    0.14525   1.046
SITEIDUS10043                                 -0.28370    0.11056  -2.566
SITEIDUS10044                                  0.26565    0.20138   1.319
SITEIDUS10045                                 -0.13825    0.17227  -0.803
SITEIDUS10046                                 -0.09002    0.14859  -0.606
SITEIDUS10049                                  0.28183    0.14436   1.952
SITEIDUS10051                                 -0.09597    0.10495  -0.914
SITEIDUS10053                                 -0.55402    0.35330  -1.568
SITEIDUS10055                                 -0.42579    0.11334  -3.757
SITEIDUS10056                                 -0.31387    0.12409  -2.529
SITEIDUS10057                                  0.47336    0.12656   3.740
SITEIDUS10058                                  0.15978    0.11139   1.434
SITEIDUS10062                                 -0.12712    0.08208  -1.549
SITEIDUS10068                                 -0.30722    0.09731  -3.157
SITEIDUS10069                                  0.79177    0.19707   4.018
SITEIDUS10070                                 -0.02214    0.08083  -0.274
SITEIDUS10071                                 -0.13676    0.14748  -0.927
SITEIDUS10073                                 -0.51585    0.35468  -1.454
SITEIDUS10074                                 -0.15776    0.10491  -1.504
SITEIDUS10075                                 -0.07545    0.08233  -0.916
SITEIDUS10076                                  0.20851    0.13704   1.522
RACEASIAN                                     -0.08511    0.37347  -0.228
RACEBLACK OR AFRICAN AMERICAN                 -0.38612    0.36620  -1.054
RACEMULTIPLE                                  -0.70294    0.38410  -1.830
RACENATIVE HAWAIIAN OR OTHER PACIFIC ISLANDER -0.24321    0.43215  -0.563
RACENOT REPORTED                               0.08491    0.40171   0.211
RACEUNKNOWN                                    0.60616    0.49442   1.226
RACEWHITE                                     -0.43075    0.36130  -1.192
AGE                                            0.07715    0.01666   4.631
base_situation10-19                           -1.69274    0.17404  -9.726
base_situation20-39                           -0.82355    0.03766 -21.871
AVISITN2:TRT01ADummy A                        -1.00458    0.07913 -12.696
AVISITN8:TRT01ADummy A                        -0.65815    0.07929  -8.301
AVISITN15:TRT01ADummy A                       -0.69466    0.07974  -8.711
AVISITN22:TRT01ADummy A                       -0.82964    0.08014 -10.352
AVISITN28:TRT01ADummy A                       -0.86057    0.07967 -10.802
AVISITN999:TRT01ADummy A                      -0.84786    0.07867 -10.777
AVISITN2:TRT01ADummy B                        -0.92254    0.11080  -8.326
AVISITN8:TRT01ADummy B                        -0.57217    0.11103  -5.153
AVISITN15:TRT01ADummy B                       -0.58461    0.11103  -5.265
AVISITN22:TRT01ADummy B                       -0.75172    0.11206  -6.708
AVISITN28:TRT01ADummy B                       -0.72849    0.11229  -6.488
AVISITN999:TRT01ADummy B                      -0.70291    0.11031  -6.372
AVISITN2:TRT01ADummy C                        -0.96668    0.11200  -8.631
AVISITN8:TRT01ADummy C                        -0.72971    0.11249  -6.487
AVISITN15:TRT01ADummy C                       -0.70641    0.11223  -6.294
AVISITN22:TRT01ADummy C                       -0.87271    0.11358  -7.684
AVISITN28:TRT01ADummy C                       -0.88039    0.11251  -7.825
AVISITN999:TRT01ADummy C                      -0.85249    0.11102  -7.679
                                              Pr(&gt;|t|)    
(Intercept)                                   4.05e-06 ***
TRT01ADummy B                                 0.764480    
TRT01ADummy C                                 0.631244    
SITEIDUS10002                                 0.857208    
SITEIDUS10004                                 0.444936    
SITEIDUS10005                                 0.461023    
SITEIDUS10006                                 0.130631    
SITEIDUS10008                                 0.069240 .  
SITEIDUS10009                                 0.046537 *  
SITEIDUS10013                                 3.71e-07 ***
SITEIDUS10014                                 0.184772    
SITEIDUS10015                                 0.775630    
SITEIDUS10016                                 0.325749    
SITEIDUS10017                                 0.782303    
SITEIDUS10019                                 0.216802    
SITEIDUS10020                                 0.002515 ** 
SITEIDUS10021                                 0.010359 *  
SITEIDUS10023                                 0.239007    
SITEIDUS10025                                 0.027647 *  
SITEIDUS10027                                 0.164221    
SITEIDUS10029                                 0.705780    
SITEIDUS10030                                 0.840871    
SITEIDUS10031                                 0.053694 .  
SITEIDUS10033                                 0.143797    
SITEIDUS10034                                 0.053631 .  
SITEIDUS10036                                 0.001328 ** 
SITEIDUS10039                                 0.002302 ** 
SITEIDUS10040                                 0.491681    
SITEIDUS10041                                 0.295448    
SITEIDUS10043                                 0.010332 *  
SITEIDUS10044                                 0.187200    
SITEIDUS10045                                 0.422316    
SITEIDUS10046                                 0.544646    
SITEIDUS10049                                 0.050997 .  
SITEIDUS10051                                 0.360574    
SITEIDUS10053                                 0.116949    
SITEIDUS10055                                 0.000175 ***
SITEIDUS10056                                 0.011475 *  
SITEIDUS10057                                 0.000187 ***
SITEIDUS10058                                 0.151531    
SITEIDUS10062                                 0.121524    
SITEIDUS10068                                 0.001609 ** 
SITEIDUS10069                                 6.01e-05 ***
SITEIDUS10070                                 0.784170    
SITEIDUS10071                                 0.353804    
SITEIDUS10073                                 0.145940    
SITEIDUS10074                                 0.132736    
SITEIDUS10075                                 0.359513    
SITEIDUS10076                                 0.128221    
RACEASIAN                                     0.819740    
RACEBLACK OR AFRICAN AMERICAN                 0.291789    
RACEMULTIPLE                                  0.067334 .  
RACENATIVE HAWAIIAN OR OTHER PACIFIC ISLANDER 0.573612    
RACENOT REPORTED                              0.832604    
RACEUNKNOWN                                   0.220285    
RACEWHITE                                     0.233258    
AGE                                           3.78e-06 ***
base_situation10-19                            &lt; 2e-16 ***
base_situation20-39                            &lt; 2e-16 ***
AVISITN2:TRT01ADummy A                         &lt; 2e-16 ***
AVISITN8:TRT01ADummy A                         &lt; 2e-16 ***
AVISITN15:TRT01ADummy A                        &lt; 2e-16 ***
AVISITN22:TRT01ADummy A                        &lt; 2e-16 ***
AVISITN28:TRT01ADummy A                        &lt; 2e-16 ***
AVISITN999:TRT01ADummy A                       &lt; 2e-16 ***
AVISITN2:TRT01ADummy B                         &lt; 2e-16 ***
AVISITN8:TRT01ADummy B                        2.72e-07 ***
AVISITN15:TRT01ADummy B                       1.49e-07 ***
AVISITN22:TRT01ADummy B                       2.33e-11 ***
AVISITN28:TRT01ADummy B                       1.01e-10 ***
AVISITN999:TRT01ADummy B                      2.14e-10 ***
AVISITN2:TRT01ADummy C                         &lt; 2e-16 ***
AVISITN8:TRT01ADummy C                        1.01e-10 ***
AVISITN15:TRT01ADummy C                       3.52e-10 ***
AVISITN22:TRT01ADummy C                       2.05e-14 ***
AVISITN28:TRT01ADummy C                       6.87e-15 ***
AVISITN999:TRT01ADummy C                      2.13e-14 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.8545 on 3137 degrees of freedom
  (1 observation deleted due to missingness)
Multiple R-squared:  0.2873,    Adjusted R-squared:  0.2701 
F-statistic: 16.64 on 76 and 3137 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(fit_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8188.17</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">BIC</span>(fit_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8662.041</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logLik</span>(fit_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'log Lik.' -4016.085 (df=78)</code></pre>
</div>
</div>
<section id="主要疗效分析day28" class="level2">
<h2 class="anchored" data-anchor-id="主要疗效分析day28">主要疗效分析（Day28）</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mmrm() registered as emmeans extension</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Welcome to emmeans.
Caution: You lose important information if you filter this package's results.
See '? untidy'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mmrm)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'tidyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked _by_ '.GlobalEnv':

    table1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: viridisLite</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grid)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'gridExtra'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    combine</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 获取Day28的最小二乘均值</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>emm_day28 <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  fit, </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">specs =</span> <span class="sc">~</span> TRT01A <span class="sc">|</span> AVISITN,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">at =</span> <span class="fu">list</span>(<span class="at">AVISITN =</span> <span class="st">"28"</span>) <span class="co"># "28"是AVISITN中Day28对应的水平（减20000后）</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 治疗组与安慰剂对比</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>contrast_specs <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Esk56_vs_Placebo"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Esk84_vs_Placebo"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>contrast_results <span class="ot">&lt;-</span> <span class="fu">contrast</span>(</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>  emm_day28,</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> contrast_specs,</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">adjust =</span> <span class="st">"none"</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="at">infer =</span> <span class="cn">TRUE</span>) <span class="co"># 包含置信区间和p值</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 显示对比结果</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(contrast_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AVISITN = 28:
 contrast         estimate     SE  df lower.CL upper.CL t.ratio p.value
 Esk56_vs_Placebo   -0.841 0.0992 651   -1.036   -0.647  -8.482  &lt;.0001
 Esk84_vs_Placebo   -0.798 0.0791 596   -0.954   -0.643 -10.098  &lt;.0001

Results are averaged over the levels of: SEX, SITEID, RACE, base_situation 
Confidence level used: 0.95 </code></pre>
</div>
</div>
</section>
<section id="疗效趋势可视化及森林图" class="level2">
<h2 class="anchored" data-anchor-id="疗效趋势可视化及森林图">疗效趋势可视化及森林图</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 获取各时间点预测值</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co">#admadrs$AVISITN &lt;- droplevels(admadrs$AVISITN)</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>emm_trend <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  fit,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">specs =</span> <span class="sc">~</span> TRT01A <span class="sc">|</span> AVISITN, </span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">at =</span> <span class="fu">list</span>(<span class="at">AVISITN =</span> <span class="fu">levels</span>(admadrs<span class="sc">$</span>AVISITN)),<span class="co"># 使用所有时间点</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">nuisance =</span> <span class="st">"RACE"</span>) <span class="sc">%&gt;%</span> <span class="co"># 将RACE设为无关因素保证行数不超过10000</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制疗效趋势图</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>(p_trend <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(emm_trend, <span class="fu">aes</span>(<span class="at">x =</span> AVISITN, <span class="at">y =</span> emmean, </span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">color =</span> TRT01A, <span class="at">group =</span> TRT01A)) <span class="sc">+</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower.CL, <span class="at">ymax =</span> upper.CL), </span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> <span class="fl">0.2</span>, </span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(<span class="at">discrete =</span> <span class="cn">TRUE</span>, </span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Placebo"</span>, <span class="st">"56mg"</span>, <span class="st">"84mg"</span>)) <span class="sc">+</span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Treatment Effect Over Time"</span>,</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Study Visit (Day)"</span>, </span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Adjusted Mean Change from Baseline (LS Means)"</span>, </span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Treatment Group"</span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main-code_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制森林图</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>contrast_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(contrast_results)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>contrast_df<span class="sc">$</span>Comparison <span class="ot">&lt;-</span> <span class="fu">rownames</span>(contrast_df)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>(p_forest <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(contrast_df, </span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">y =</span> Comparison, </span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">xmin =</span> lower.CL, <span class="at">xmax =</span> upper.CL)) <span class="sc">+</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"grey50"</span>) <span class="sc">+</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbarh</span>(<span class="at">height =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"#440154"</span>) <span class="sc">+</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"56mg vs Placebo"</span>, <span class="st">"84mg vs Placebo"</span>)) <span class="sc">+</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Treatment Comparisons at Day 28"</span>,</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Treatment Difference (95% CI)"</span>, </span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">""</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main-code_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 组合图形</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p_trend, p_forest, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main-code_files/figure-html/unnamed-chunk-7-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 保存图形（PDF格式）</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"treatment_analysis.pdf"</span>, </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">arrangeGrob</span>(p_trend, p_forest, <span class="at">ncol =</span> <span class="dv">1</span>), </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">8</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 保存统计结果</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(contrast_results, <span class="st">"treatment_contrasts.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="治疗组vs安慰剂的估计边际均值和差异计算及可视化" class="level2">
<h2 class="anchored" data-anchor-id="治疗组vs安慰剂的估计边际均值和差异计算及可视化">治疗组vs安慰剂的估计边际均值和差异计算及可视化</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 将Day 28对应的AVISITN水平赋值</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>day28_level <span class="ot">&lt;-</span> <span class="st">"28"</span> </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算Day 28时的估计边际均值</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>em_day28 <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(fit, <span class="sc">~</span> TRT01A <span class="sc">|</span> AVISITN, <span class="at">at =</span> <span class="fu">list</span>(<span class="at">AVISITN =</span> day28_level))</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(em_day28)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AVISITN = 28:
 TRT01A  emmean    SE   df lower.CL upper.CL
 Dummy A -0.266 0.129  798   -0.519  -0.0126
 Dummy B -1.107 0.157 1000   -1.416  -0.7989
 Dummy C -1.064 0.147  979   -1.352  -0.7764

Results are averaged over the levels of: SEX, SITEID, RACE, base_situation 
Confidence level used: 0.95 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算治疗组vs安慰剂在Day28时的差异</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>contrasts_day28 <span class="ot">&lt;-</span> <span class="fu">contrast</span>(em_day28, <span class="at">method =</span> <span class="st">"trt.vs.ctrl"</span>, <span class="at">ref =</span> <span class="dv">1</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(contrasts_day28)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AVISITN = 28:
 contrast          estimate     SE  df t.ratio p.value
 Dummy B - Dummy A   -0.841 0.0992 651  -8.482  &lt;.0001
 Dummy C - Dummy A   -0.798 0.0791 596 -10.098  &lt;.0001

Results are averaged over the levels of: SEX, SITEID, RACE, base_situation 
P value adjustment: dunnettx method for 2 tests </code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算所有时间点的估计边际均值</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>em_all <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(fit, <span class="sc">~</span> TRT01A <span class="sc">|</span> AVISITN, <span class="at">nuisance =</span> <span class="st">"RACE"</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(em_all)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AVISITN = 0:
 TRT01A  emmean    SE   df lower.CL upper.CL
 Dummy A  0.304 0.103  416   0.1020   0.5053
 Dummy B  0.305 0.105  417   0.0994   0.5113
 Dummy C  0.353 0.106  417   0.1445   0.5616

AVISITN = 2:
 TRT01A  emmean    SE   df lower.CL upper.CL
 Dummy A -0.703 0.117  634  -0.9325  -0.4728
 Dummy B -1.396 0.149  883  -1.6881  -1.1032
 Dummy C -1.237 0.147  992  -1.5249  -0.9488

AVISITN = 8:
 TRT01A  emmean    SE   df lower.CL upper.CL
 Dummy A -0.631 0.132  823  -0.8899  -0.3720
 Dummy B -1.327 0.155 1028  -1.6310  -1.0222
 Dummy C -1.404 0.150 1035  -1.6972  -1.1103

AVISITN = 15:
 TRT01A  emmean    SE   df lower.CL upper.CL
 Dummy A -0.677 0.132  829  -0.9371  -0.4176
 Dummy B -1.419 0.160 1049  -1.7321  -1.1051
 Dummy C -1.467 0.184  763  -1.8276  -1.1055

AVISITN = 22:
 TRT01A  emmean    SE   df lower.CL upper.CL
 Dummy A -0.347 0.116  614  -0.5746  -0.1202
 Dummy B -1.188 0.152  884  -1.4870  -0.8897
 Dummy C -0.993 0.150  982  -1.2870  -0.6987

AVISITN = 28:
 TRT01A  emmean    SE   df lower.CL upper.CL
 Dummy A -0.266 0.129  798  -0.5193  -0.0126
 Dummy B -1.107 0.157 1000  -1.4157  -0.7989
 Dummy C -1.064 0.147  979  -1.3520  -0.7764

AVISITN = 999:
 TRT01A  emmean    SE   df lower.CL upper.CL
 Dummy A -0.413 0.130  805  -0.6673  -0.1587
 Dummy B -1.114 0.157  980  -1.4215  -0.8068
 Dummy C -1.214 0.184  758  -1.5761  -0.8519

Results are averaged over the levels of: 1 nuisance factors, SEX, SITEID, base_situation 
Confidence level used: 0.95 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 各组在各时间点的均值比较</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>contrasts_all <span class="ot">&lt;-</span> <span class="fu">contrast</span>(em_all, <span class="at">method =</span> <span class="st">"trt.vs.ctrl"</span>, <span class="at">ref =</span> <span class="dv">1</span>)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(contrasts_all)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AVISITN = 0:
 contrast          estimate     SE  df t.ratio p.value
 Dummy B - Dummy A  0.00171 0.0411 415   0.042  0.9972
 Dummy C - Dummy A  0.04943 0.0418 416   1.183  0.3944

AVISITN = 2:
 contrast          estimate     SE  df t.ratio p.value
 Dummy B - Dummy A -0.69297 0.0748 588  -9.270  &lt;.0001
 Dummy C - Dummy A -0.53418 0.0923 670  -5.788  &lt;.0001

AVISITN = 8:
 contrast          estimate     SE  df t.ratio p.value
 Dummy B - Dummy A -0.69563 0.0926 668  -7.511  &lt;.0001
 Dummy C - Dummy A -0.77280 0.0796 596  -9.714  &lt;.0001

AVISITN = 15:
 contrast          estimate     SE  df t.ratio p.value
 Dummy B - Dummy A -0.74127 0.0962 509  -7.705  &lt;.0001
 Dummy C - Dummy A -0.78919 0.0970 516  -8.134  &lt;.0001

AVISITN = 22:
 contrast          estimate     SE  df t.ratio p.value
 Dummy B - Dummy A -0.84093 0.0788 590 -10.675  &lt;.0001
 Dummy C - Dummy A -0.64546 0.0991 657  -6.515  &lt;.0001

AVISITN = 28:
 contrast          estimate     SE  df t.ratio p.value
 Dummy B - Dummy A -0.84138 0.0992 651  -8.482  &lt;.0001
 Dummy C - Dummy A -0.79832 0.0791 596 -10.098  &lt;.0001

AVISITN = 999:
 contrast          estimate     SE  df t.ratio p.value
 Dummy B - Dummy A -0.70119 0.0947 512  -7.401  &lt;.0001
 Dummy C - Dummy A -0.80107 0.0953 515  -8.406  &lt;.0001

Results are averaged over the levels of: 1 nuisance factors, SEX, SITEID, base_situation 
P value adjustment: dunnettx method for 2 tests </code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 将结果转换为数据框以便绘图</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>em_all_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(em_all)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建一个时间轴变量，将AVISITN转换为数值以便绘图</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>em_all_df<span class="sc">$</span>Time <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(em_all_df<span class="sc">$</span>AVISITN))</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制各治疗组随时间的MADRS变化趋势图</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(em_all_df, <span class="fu">aes</span>(<span class="at">x =</span> AVISITN, <span class="at">y =</span> emmean, <span class="at">color =</span> TRT01A, <span class="at">group =</span> TRT01A)) <span class="sc">+</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> emmean <span class="sc">-</span> SE, <span class="at">ymax =</span> emmean <span class="sc">+</span> SE), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Change from Baseline in MADRS Total Score Over Time"</span>,</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Day"</span>,</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Estimated Mean Change from Baseline"</span>,</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Treatment Group"</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(<span class="at">discrete =</span> <span class="cn">TRUE</span>, <span class="at">option =</span> <span class="st">"D"</span>, </span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Placebo"</span>, <span class="st">"Esketamine 56 mg"</span>, <span class="st">"Esketamine 84 mg"</span>)) <span class="sc">+</span></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main-code_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 保存图片</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"MADRS_change_over_time.png"</span>, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建Day 28时的柱状图比较</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>day28_df <span class="ot">&lt;-</span> <span class="fu">subset</span>(em_all_df, AVISITN <span class="sc">==</span> day28_level)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 将各组在各时间点的均值比较结果转换为数据框以便绘图</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>contrasts_day28_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(contrasts_day28)</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制Day 28时的柱状图</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(day28_df, <span class="fu">aes</span>(<span class="at">x =</span> TRT01A, <span class="at">y =</span> emmean, <span class="at">fill =</span> TRT01A)) <span class="sc">+</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> emmean <span class="sc">-</span> SE, <span class="at">ymax =</span> emmean <span class="sc">+</span> SE), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Change from Baseline in MADRS Total Score at Day 28"</span>,</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Treatment Group"</span>,</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Estimated Mean Change from Baseline"</span>,</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Treatment Group"</span></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(<span class="at">discrete =</span> <span class="cn">TRUE</span>, <span class="at">option =</span> <span class="st">"D"</span>,</span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Placebo"</span>, <span class="st">"Esketamine 56 mg"</span>, <span class="st">"Esketamine 84 mg"</span>)) <span class="sc">+</span></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制治疗组vs安慰剂的差异图</span></span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(contrasts_day28_df, <span class="fu">aes</span>(<span class="at">x =</span> contrast, <span class="at">y =</span> estimate, <span class="at">fill =</span> contrast)) <span class="sc">+</span></span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> estimate <span class="sc">-</span> SE, <span class="at">ymax =</span> estimate <span class="sc">+</span> SE), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Treatment Effect vs Placebo at Day 28"</span>,</span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Contrast"</span>,</span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Estimated Difference"</span>,</span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Contrast"</span></span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(<span class="at">discrete =</span> <span class="cn">TRUE</span>, <span class="at">option =</span> <span class="st">"E"</span>) <span class="sc">+</span></span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb65-41"><a href="#cb65-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb65-42"><a href="#cb65-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb65-43"><a href="#cb65-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb65-44"><a href="#cb65-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb65-45"><a href="#cb65-45" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb65-46"><a href="#cb65-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>)</span>
<span id="cb65-47"><a href="#cb65-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-48"><a href="#cb65-48" aria-hidden="true" tabindex="-1"></a><span class="co"># 将两个图组合在一起</span></span>
<span id="cb65-49"><a href="#cb65-49" aria-hidden="true" tabindex="-1"></a>combined_plot <span class="ot">&lt;-</span> <span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main-code_files/figure-html/unnamed-chunk-8-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 保存组合图</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Day28_treatment_effect.png"</span>, combined_plot, <span class="at">width =</span> <span class="dv">12</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建森林图展示各时间点的治疗效果</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>contrasts_all_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(contrasts_all)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>contrasts_all_df<span class="sc">$</span>Time <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(contrasts_all_df<span class="sc">$</span>AVISITN))</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 森林图</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(contrasts_all_df, <span class="fu">aes</span>(<span class="at">x =</span> AVISITN , <span class="at">y =</span> estimate, <span class="at">color =</span> contrast)) <span class="sc">+</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> estimate <span class="sc">-</span> SE<span class="sc">*</span><span class="fl">1.96</span>, <span class="at">ymax =</span> estimate <span class="sc">+</span> SE<span class="sc">*</span><span class="fl">1.96</span>), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> contrast), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> contrast, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Treatment Effect vs Placebo Over Time"</span>,</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Day"</span>,</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Estimated Difference vs Placebo"</span>,</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Treatment Group"</span></span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(<span class="at">discrete =</span> <span class="cn">TRUE</span>, <span class="at">option =</span> <span class="st">"D"</span>) <span class="sc">+</span></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"lightgrey"</span>),</span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main-code_files/figure-html/unnamed-chunk-8-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 保存森林图</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Treatment_effect_forest_plot.png"</span>, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">8</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建热图展示p值</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 提取所有时间点的p值</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>p_values <span class="ot">&lt;-</span> contrasts_all_df</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>p_values<span class="sc">$</span>sig <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(p_values<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.001</span>, <span class="st">"***"</span>,</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">ifelse</span>(p_values<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.01</span>, <span class="st">"**"</span>,</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">ifelse</span>(p_values<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="st">"*"</span>, <span class="st">"ns"</span>)))</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 处理热图所需数据</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>p_values_wide <span class="ot">&lt;-</span> p_values <span class="sc">%&gt;%</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(AVISITN, contrast, p.value) <span class="sc">%&gt;%</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> contrast, <span class="at">values_from =</span> p.value)</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制p值热图</span></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>p_values_long <span class="ot">&lt;-</span> p_values <span class="sc">%&gt;%</span></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Time, contrast, p.value, sig)</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(p_values_long, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(Time), <span class="at">y =</span> contrast, <span class="at">fill =</span> <span class="sc">-</span><span class="fu">log10</span>(p.value))) <span class="sc">+</span></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> sig), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(<span class="at">option =</span> <span class="st">"C"</span>, <span class="at">name =</span> <span class="st">"-log10(p-value)"</span>) <span class="sc">+</span></span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Statistical Significance of Treatment Effect vs Placebo"</span>,</span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Day"</span>,</span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Treatment Group"</span>,</span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"* p&lt;0.05, ** p&lt;0.01, *** p&lt;0.001, ns: not significant"</span></span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb67-32"><a href="#cb67-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb67-33"><a href="#cb67-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb67-34"><a href="#cb67-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span></span>
<span id="cb67-35"><a href="#cb67-35" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main-code_files/figure-html/unnamed-chunk-8-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 保存热图</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Treatment_significance_heatmap.png"</span>, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 模型诊断图</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 提取残差</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>residuals <span class="ot">&lt;-</span> <span class="fu">residuals</span>(fit)</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>fitted_values <span class="ot">&lt;-</span> <span class="fu">fitted</span>(fit)</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建诊断数据框</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>diag_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">Fitted =</span> fitted_values,</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">Residuals =</span> residuals</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制残差图</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(diag_df, <span class="fu">aes</span>(<span class="at">x =</span> Fitted, <span class="at">y =</span> Residuals)) <span class="sc">+</span></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Residuals vs Fitted Values"</span>,</span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Fitted Values"</span>,</span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Residuals"</span></span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制残差的QQ图</span></span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(diag_df, <span class="fu">aes</span>(<span class="at">sample =</span> Residuals)) <span class="sc">+</span></span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq</span>() <span class="sc">+</span></span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq_line</span>() <span class="sc">+</span></span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Normal Q-Q Plot of Residuals"</span>,</span>
<span id="cb68-37"><a href="#cb68-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Theoretical Quantiles"</span>,</span>
<span id="cb68-38"><a href="#cb68-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Sample Quantiles"</span></span>
<span id="cb68-39"><a href="#cb68-39" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb68-40"><a href="#cb68-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb68-41"><a href="#cb68-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb68-42"><a href="#cb68-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb68-43"><a href="#cb68-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb68-44"><a href="#cb68-44" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb68-45"><a href="#cb68-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-46"><a href="#cb68-46" aria-hidden="true" tabindex="-1"></a><span class="co"># 组合诊断图</span></span>
<span id="cb68-47"><a href="#cb68-47" aria-hidden="true" tabindex="-1"></a>diag_plot <span class="ot">&lt;-</span> <span class="fu">grid.arrange</span>(p3, p4, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main-code_files/figure-html/unnamed-chunk-8-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 保存诊断图</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Model_diagnostics.png"</span>, diag_plot, <span class="at">width =</span> <span class="dv">12</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="数据可视化有图例和解释" class="level2">
<h2 class="anchored" data-anchor-id="数据可视化有图例和解释">数据可视化（有图例和解释）</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 各治疗组随时间的MADRS变化趋势图</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 输出emmeans结果数据</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>em_all_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AVISITN = 0:
 TRT01A      emmean        SE      df   lower.CL   upper.CL Time
 Dummy A  0.3036347 0.1025859  415.71  0.1019829  0.5052865    0
 Dummy B  0.3053490 0.1047895  416.57  0.0993668  0.5113311    0
 Dummy C  0.3530675 0.1061115  416.77  0.1444871  0.5616480    0

AVISITN = 2:
 TRT01A      emmean        SE      df   lower.CL   upper.CL Time
 Dummy A -0.7026543 0.1170686  634.38 -0.9325430 -0.4727655    2
 Dummy B -1.3956254 0.1489953  883.30 -1.6880515 -1.1031993    2
 Dummy C -1.2368376 0.1467976  992.47 -1.5249070 -0.9487683    2

AVISITN = 8:
 TRT01A      emmean        SE      df   lower.CL   upper.CL Time
 Dummy A -0.6309696 0.1319135  823.38 -0.8898959 -0.3720433    8
 Dummy B -1.3266031 0.1551385 1028.50 -1.6310271 -1.0221791    8
 Dummy C -1.4037658 0.1495618 1035.19 -1.6972447 -1.1102869    8

AVISITN = 15:
 TRT01A      emmean        SE      df   lower.CL   upper.CL Time
 Dummy A -0.6773596 0.1323395  828.55 -0.9371198 -0.4175994   15
 Dummy B -1.4186303 0.1597666 1049.01 -1.7321288 -1.1051319   15
 Dummy C -1.4665458 0.1839236  762.97 -1.8276022 -1.1054894   15

AVISITN = 22:
 TRT01A      emmean        SE      df   lower.CL   upper.CL Time
 Dummy A -0.3473856 0.1156954  613.79 -0.5745923 -0.1201788   22
 Dummy B -1.1883160 0.1521635  884.23 -1.4869597 -0.8896723   22
 Dummy C -0.9928504 0.1499149  981.72 -1.2870410 -0.6986599   22

AVISITN = 28:
 TRT01A      emmean        SE      df   lower.CL   upper.CL Time
 Dummy A -0.2659051 0.1290646  798.18 -0.5192512 -0.0125591   28
 Dummy B -1.1072886 0.1571637  999.66 -1.4156972 -0.7988800   28
 Dummy C -1.0642296 0.1466599  979.15 -1.3520335 -0.7764257   28

AVISITN = 999:
 TRT01A      emmean        SE      df   lower.CL   upper.CL Time
 Dummy A -0.4129694 0.1295510  804.86 -0.6672671 -0.1586717  999
 Dummy B -1.1141616 0.1566069  980.15 -1.4214850 -0.8068383  999
 Dummy C -1.2140361 0.1844488  757.54 -1.5761277 -0.8519445  999

Results are averaged over the levels of: 1 nuisance factors, SEX, SITEID, base_situation 
Confidence level used: 0.95 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘图</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(em_all_df, <span class="fu">aes</span>(<span class="at">x =</span> AVISITN, <span class="at">y =</span> emmean, <span class="at">color =</span> TRT01A, <span class="at">group =</span> TRT01A)) <span class="sc">+</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> emmean <span class="sc">-</span> SE, <span class="at">ymax =</span> emmean <span class="sc">+</span> SE), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Change from Baseline in MADRS Total Score Over Time"</span>,</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Mixed Model for Repeated Measures (MMRM) Analysis"</span>,</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Study Day"</span>,</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Estimated Mean Change from Baseline"</span>,</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Treatment Group"</span>,</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Note: Error bars represent standard errors. Negative values indicate improvement in depressive symptoms."</span></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(<span class="at">discrete =</span> <span class="cn">TRUE</span>, <span class="at">option =</span> <span class="st">"D"</span>, </span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Placebo"</span>, <span class="st">"Esketamine 56 mg"</span>, <span class="st">"Esketamine 84 mg"</span>)) <span class="sc">+</span></span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="st">"grey80"</span>),</span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"italic"</span>)</span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 添加解释文本</span></span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">min</span>(<span class="fu">as.numeric</span>(<span class="fu">as.character</span>(em_all_df<span class="sc">$</span>AVISITN))) <span class="sc">+</span> <span class="dv">2</span>, </span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">min</span>(em_all_df<span class="sc">$</span>emmean) <span class="sc">*</span> <span class="fl">0.8</span>, </span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Lower values indicate greater</span><span class="sc">\n</span><span class="st">improvement in depression"</span>, </span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">fontface =</span> <span class="st">"italic"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main-code_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 保存图片</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"MADRS_change_over_time_with_legend.png"</span>, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 输出Day 28时的估计边际均值</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>day28_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    TRT01A AVISITN     emmean        SE       df   lower.CL    upper.CL Time
16 Dummy A      28 -0.2659051 0.1290646 798.1815 -0.5192512 -0.01255906   28
17 Dummy B      28 -1.1072886 0.1571637 999.6623 -1.4156972 -0.79888004   28
18 Dummy C      28 -1.0642296 0.1466599 979.1475 -1.3520335 -0.77642572   28</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Day 28时的柱状图</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(day28_df, <span class="fu">aes</span>(<span class="at">x =</span> TRT01A, <span class="at">y =</span> emmean, <span class="at">fill =</span> TRT01A)) <span class="sc">+</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> emmean <span class="sc">-</span> SE, <span class="at">ymax =</span> emmean <span class="sc">+</span> SE), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Change from Baseline in MADRS Total Score at Day 28"</span>,</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Estimated Marginal Means with Standard Errors"</span>,</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Treatment Group"</span>,</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Estimated Mean Change from Baseline"</span>,</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Treatment Group"</span>,</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Note: Error bars represent standard errors. Negative values indicate improvement in depressive symptoms."</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(<span class="at">discrete =</span> <span class="cn">TRUE</span>, <span class="at">option =</span> <span class="st">"D"</span>,</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Placebo"</span>, <span class="st">"Esketamine 56 mg"</span>, <span class="st">"Esketamine 84 mg"</span>)) <span class="sc">+</span></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="st">"grey80"</span>),</span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"italic"</span>),</span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 添加标签</span></span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.1f"</span>, emmean)), <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.7</span>), </span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>)</span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-30"><a href="#cb76-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-31"><a href="#cb76-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 输出绘图数据</span></span>
<span id="cb76-32"><a href="#cb76-32" aria-hidden="true" tabindex="-1"></a>contrasts_day28_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AVISITN = 28:
 contrast            estimate         SE     df t.ratio p.value
 Dummy B - Dummy A -0.8413835 0.09919806 650.97  -8.482  &lt;.0001
 Dummy C - Dummy A -0.7983245 0.07905644 595.89 -10.098  &lt;.0001

Results are averaged over the levels of: SEX, SITEID, RACE, base_situation 
P value adjustment: dunnettx method for 2 tests </code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制治疗组vs安慰剂的差异图</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(contrasts_day28_df, <span class="fu">aes</span>(<span class="at">x =</span> contrast, <span class="at">y =</span> estimate, <span class="at">fill =</span> contrast)) <span class="sc">+</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> estimate <span class="sc">-</span> SE, <span class="at">ymax =</span> estimate <span class="sc">+</span> SE), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Treatment Effect vs Placebo at Day 28"</span>,</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Difference in Estimated Means with Standard Errors"</span>,</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Treatment Comparison"</span>,</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Estimated Difference vs Placebo"</span>,</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Treatment Comparison"</span>,</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Note: Values below zero favor active treatment over placebo.</span><span class="sc">\n</span><span class="st">Red dashed line represents no difference from placebo."</span></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(<span class="at">discrete =</span> <span class="cn">TRUE</span>, <span class="at">option =</span> <span class="st">"E"</span>,</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Esketamine 56 mg vs Placebo"</span>, <span class="st">"Esketamine 84 mg vs Placebo"</span>)) <span class="sc">+</span></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="st">"grey80"</span>),</span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"italic"</span>),</span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 添加p值和效应量标签</span></span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"Diff: %.1f</span><span class="sc">\n</span><span class="st">p = %.3f"</span>, estimate, p.value)), </span>
<span id="cb78-29"><a href="#cb78-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.7</span>), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.8</span>, <span class="at">size =</span> <span class="fl">3.5</span>)</span>
<span id="cb78-30"><a href="#cb78-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-31"><a href="#cb78-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用patchwork组合两个图</span></span>
<span id="cb78-32"><a href="#cb78-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb78-33"><a href="#cb78-33" aria-hidden="true" tabindex="-1"></a>combined_plot <span class="ot">&lt;-</span> p1 <span class="sc">+</span> p2 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb78-34"><a href="#cb78-34" aria-hidden="true" tabindex="-1"></a>combined_plot <span class="ot">&lt;-</span> combined_plot <span class="sc">+</span> <span class="fu">plot_annotation</span>(</span>
<span id="cb78-35"><a href="#cb78-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"MADRS Score Change and Treatment Effect at Day 28"</span>,</span>
<span id="cb78-36"><a href="#cb78-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">theme =</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>))</span>
<span id="cb78-37"><a href="#cb78-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-38"><a href="#cb78-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-39"><a href="#cb78-39" aria-hidden="true" tabindex="-1"></a><span class="co"># 保存组合图</span></span>
<span id="cb78-40"><a href="#cb78-40" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Day28_treatment_effect_with_legend.png"</span>, combined_plot, <span class="at">width =</span> <span class="dv">12</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb78-41"><a href="#cb78-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-42"><a href="#cb78-42" aria-hidden="true" tabindex="-1"></a><span class="co"># 输出绘图数据</span></span>
<span id="cb78-43"><a href="#cb78-43" aria-hidden="true" tabindex="-1"></a>contrasts_all_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AVISITN = 0:
 contrast            estimate         SE     df t.ratio p.value Time
 Dummy B - Dummy A  0.0017143 0.04113726 415.00   0.042  0.9972    0
 Dummy C - Dummy A  0.0494328 0.04177930 415.89   1.183  0.3944    0

AVISITN = 2:
 contrast            estimate         SE     df t.ratio p.value Time
 Dummy B - Dummy A -0.6929711 0.07475349 588.39  -9.270  &lt;.0001    2
 Dummy C - Dummy A -0.5341834 0.09229578 670.43  -5.788  &lt;.0001    2

AVISITN = 8:
 contrast            estimate         SE     df t.ratio p.value Time
 Dummy B - Dummy A -0.6956335 0.09261148 668.33  -7.511  &lt;.0001    8
 Dummy C - Dummy A -0.7727962 0.07955698 595.88  -9.714  &lt;.0001    8

AVISITN = 15:
 contrast            estimate         SE     df t.ratio p.value Time
 Dummy B - Dummy A -0.7412707 0.09620677 508.54  -7.705  &lt;.0001   15
 Dummy C - Dummy A -0.7891862 0.09702519 515.94  -8.134  &lt;.0001   15

AVISITN = 22:
 contrast            estimate         SE     df t.ratio p.value Time
 Dummy B - Dummy A -0.8409304 0.07877781 589.92 -10.675  &lt;.0001   22
 Dummy C - Dummy A -0.6454649 0.09907534 656.61  -6.515  &lt;.0001   22

AVISITN = 28:
 contrast            estimate         SE     df t.ratio p.value Time
 Dummy B - Dummy A -0.8413835 0.09919806 650.97  -8.482  &lt;.0001   28
 Dummy C - Dummy A -0.7983245 0.07905644 595.89 -10.098  &lt;.0001   28

AVISITN = 999:
 contrast            estimate         SE     df t.ratio p.value Time
 Dummy B - Dummy A -0.7011922 0.09474272 512.36  -7.401  &lt;.0001  999
 Dummy C - Dummy A -0.8010667 0.09530024 514.97  -8.406  &lt;.0001  999

Results are averaged over the levels of: 1 nuisance factors, SEX, SITEID, base_situation 
P value adjustment: dunnettx method for 2 tests </code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建森林图展示各时间点的治疗效果</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(contrasts_all_df, <span class="fu">aes</span>(<span class="at">x =</span> AVISITN, <span class="at">y =</span> estimate, <span class="at">color =</span> contrast)) <span class="sc">+</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> estimate <span class="sc">-</span> SE<span class="sc">*</span><span class="fl">1.96</span>, <span class="at">ymax =</span> estimate <span class="sc">+</span> SE<span class="sc">*</span><span class="fl">1.96</span>), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> contrast), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> contrast, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Treatment Effect vs Placebo Over Time"</span>,</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Estimated Differences with 95% Confidence Intervals"</span>,</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Study Day"</span>,</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Estimated Difference vs Placebo"</span>,</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Treatment Comparison"</span>,</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Note: Points below zero favor active treatment over placebo."</span>,</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Error bars represent 95% confidence intervals."</span>,</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Non-overlapping confidence intervals with red dashed line (zero) indicate statistical significance."</span>)</span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(<span class="at">discrete =</span> <span class="cn">TRUE</span>, <span class="at">option =</span> <span class="st">"D"</span>,</span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Esketamine 56 mg vs Placebo"</span>, <span class="st">"Esketamine 84 mg vs Placebo"</span>)) <span class="sc">+</span></span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="st">"grey80"</span>),</span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"lightgrey"</span>),</span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"italic"</span>)</span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 添加p值标签</span></span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"p = %.3f"</span>, p.value)), </span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.8</span>, </span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main-code_files/figure-html/unnamed-chunk-9-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 保存森林图</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Treatment_effect_forest_plot_with_legend.png"</span>, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">8</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建热图展示p值</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 提取所有时间点的p值</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>p_values <span class="ot">&lt;-</span> contrasts_all_df</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>p_values<span class="sc">$</span>sig <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(p_values<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.001</span>, <span class="st">"***"</span>,</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">ifelse</span>(p_values<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.01</span>, <span class="st">"**"</span>,</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">ifelse</span>(p_values<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="st">"*"</span>, <span class="st">"ns"</span>)))</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 数据准备</span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>p_values_long <span class="ot">&lt;-</span> p_values <span class="sc">%&gt;%</span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Time, contrast, p.value, sig)</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 添加-log10(p值)列</span></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>p_values_long<span class="sc">$</span>neg_log10_p <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">log10</span>(p_values_long<span class="sc">$</span>p.value)</span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>p_values_long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Time          contrast      p.value sig  neg_log10_p
1     0 Dummy B - Dummy A 9.971599e-01  ns  0.001235183
2     0 Dummy C - Dummy A 3.943676e-01  ns  0.404098792
3     2 Dummy B - Dummy A 2.484033e-10 ***  9.604842643
4     2 Dummy C - Dummy A 2.131253e-08 ***  7.671365020
5     8 Dummy B - Dummy A 1.882938e-13 *** 12.725163922
6     8 Dummy C - Dummy A 2.354221e-10 ***  9.628152722
7    15 Dummy B - Dummy A 8.864287e-11 *** 10.052356187
8    15 Dummy C - Dummy A 1.091197e-10 ***  9.962096784
9    22 Dummy B - Dummy A 2.467375e-10 ***  9.607764806
10   22 Dummy C - Dummy A 1.448419e-10 ***  9.839105738
11   28 Dummy B - Dummy A 2.220446e-16 *** 15.653559775
12   28 Dummy C - Dummy A 2.352738e-10 ***  9.628426432
13  999 Dummy B - Dummy A 1.000091e-10 ***  9.999960428
14  999 Dummy C - Dummy A 1.063928e-10 ***  9.973087829</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制p值热图</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(p_values_long, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(Time), <span class="at">y =</span> contrast, <span class="at">fill =</span>  <span class="sc">-</span><span class="fu">log10</span>(p.value))) <span class="sc">+</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 根据显著性调整文本颜色</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> sig, <span class="at">color =</span> <span class="fu">ifelse</span>(p.value <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="st">"white"</span>, <span class="st">"black"</span>)), <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 手动设置文本颜色</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_identity</span>() <span class="sc">+</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 设置小p值(高-log10(p值))为深色</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(<span class="at">option =</span> <span class="st">"C"</span>, <span class="at">name =</span> <span class="st">"-log10(p-value)"</span>, <span class="at">direction =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Statistical Significance of Treatment Effect vs Placebo"</span>,</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"p-values Transformed to -log10 Scale for Visual Clarity"</span>,</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Study Day"</span>,</span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Treatment Comparison"</span>,</span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"* p&lt;0.05, ** p&lt;0.01, *** p&lt;0.001, ns: not significant"</span>,</span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Darker colors represent smaller p-values (higher statistical significance)"</span>,</span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"The -log10 transformation converts p=0.05 to 1.3, p=0.01 to 2, p=0.001 to 3, etc."</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"italic"</span>),</span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb83-27"><a href="#cb83-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="st">"grey80"</span>)</span>
<span id="cb83-28"><a href="#cb83-28" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main-code_files/figure-html/unnamed-chunk-9-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 保存热图</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Treatment_significance_heatmap_with_legend.png"</span>, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建模型诊断图</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 提取残差</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>residuals <span class="ot">&lt;-</span> <span class="fu">residuals</span>(fit)</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>fitted_values <span class="ot">&lt;-</span> <span class="fu">fitted</span>(fit)</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建诊断数据框</span></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>diag_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">Fitted =</span> fitted_values,</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">Residuals =</span> residuals</span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 为QQ图准备数据</span></span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>qq_data <span class="ot">&lt;-</span> <span class="fu">qqnorm</span>(residuals, <span class="at">plot.it =</span> <span class="cn">FALSE</span>)</span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a>qq_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Theoretical =</span> qq_data<span class="sc">$</span>x, <span class="at">Sample =</span> qq_data<span class="sc">$</span>y)</span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制残差图</span></span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(diag_df, <span class="fu">aes</span>(<span class="at">x =</span> Fitted, <span class="at">y =</span> Residuals)) <span class="sc">+</span></span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">fill =</span> <span class="st">"pink"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Residuals vs Fitted Values"</span>,</span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Assessment of Homoscedasticity and Linearity"</span>,</span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Fitted Values"</span>,</span>
<span id="cb84-32"><a href="#cb84-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Residuals"</span>,</span>
<span id="cb84-33"><a href="#cb84-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Note: Points should be randomly scattered around zero line (red dashed line).</span><span class="sc">\n</span><span class="st">The smooth curve (red) should be approximately horizontal."</span></span>
<span id="cb84-34"><a href="#cb84-34" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb84-35"><a href="#cb84-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb84-36"><a href="#cb84-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb84-37"><a href="#cb84-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb84-38"><a href="#cb84-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb84-39"><a href="#cb84-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb84-40"><a href="#cb84-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"italic"</span>)</span>
<span id="cb84-41"><a href="#cb84-41" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb84-42"><a href="#cb84-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 添加解释性文本</span></span>
<span id="cb84-43"><a href="#cb84-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">min</span>(fitted_values) <span class="sc">+</span> <span class="fl">0.1</span><span class="sc">*</span>(<span class="fu">max</span>(fitted_values)<span class="sc">-</span><span class="fu">min</span>(fitted_values)), </span>
<span id="cb84-44"><a href="#cb84-44" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">max</span>(residuals)<span class="sc">*</span><span class="fl">0.8</span>, </span>
<span id="cb84-45"><a href="#cb84-45" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Ideal pattern: Random scatter</span><span class="sc">\n</span><span class="st">around the zero line with no pattern"</span>, </span>
<span id="cb84-46"><a href="#cb84-46" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">fontface =</span> <span class="st">"italic"</span>)</span>
<span id="cb84-47"><a href="#cb84-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-48"><a href="#cb84-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-49"><a href="#cb84-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-50"><a href="#cb84-50" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制残差的QQ图</span></span>
<span id="cb84-51"><a href="#cb84-51" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(qq_df, <span class="fu">aes</span>(<span class="at">x =</span> Theoretical, <span class="at">y =</span> Sample)) <span class="sc">+</span></span>
<span id="cb84-52"><a href="#cb84-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span> </span>
<span id="cb84-53"><a href="#cb84-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb84-54"><a href="#cb84-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb84-55"><a href="#cb84-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Normal Q-Q Plot of Residuals"</span>,</span>
<span id="cb84-56"><a href="#cb84-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Assessment of Normality Assumption"</span>,</span>
<span id="cb84-57"><a href="#cb84-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Theoretical Quantiles"</span>,</span>
<span id="cb84-58"><a href="#cb84-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Sample Quantiles"</span>,</span>
<span id="cb84-59"><a href="#cb84-59" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb84-60"><a href="#cb84-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb84-61"><a href="#cb84-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb84-62"><a href="#cb84-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb84-63"><a href="#cb84-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb84-64"><a href="#cb84-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb84-65"><a href="#cb84-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"italic"</span>)</span>
<span id="cb84-66"><a href="#cb84-66" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb84-67"><a href="#cb84-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-68"><a href="#cb84-68" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用patchwork组合诊断图</span></span>
<span id="cb84-69"><a href="#cb84-69" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb84-70"><a href="#cb84-70" aria-hidden="true" tabindex="-1"></a>diag_plot <span class="ot">&lt;-</span> p3 <span class="sc">+</span> p4 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb84-71"><a href="#cb84-71" aria-hidden="true" tabindex="-1"></a>diag_plot <span class="ot">&lt;-</span> diag_plot <span class="sc">+</span> <span class="fu">plot_annotation</span>(</span>
<span id="cb84-72"><a href="#cb84-72" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"MMRM Model Diagnostic Plots"</span>,</span>
<span id="cb84-73"><a href="#cb84-73" aria-hidden="true" tabindex="-1"></a>  <span class="at">subtitle =</span> <span class="st">"Assessing Model Assumptions for Valid Statistical Inference"</span>,</span>
<span id="cb84-74"><a href="#cb84-74" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"These diagnostic plots help validate the assumptions of the Mixed Model for Repeated Measures (MMRM) analysis."</span>,</span>
<span id="cb84-75"><a href="#cb84-75" aria-hidden="true" tabindex="-1"></a>  <span class="at">theme =</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb84-76"><a href="#cb84-76" aria-hidden="true" tabindex="-1"></a>               <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb84-77"><a href="#cb84-77" aria-hidden="true" tabindex="-1"></a>               <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"italic"</span>))</span>
<span id="cb84-78"><a href="#cb84-78" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb84-79"><a href="#cb84-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-80"><a href="#cb84-80" aria-hidden="true" tabindex="-1"></a>diag_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main-code_files/figure-html/unnamed-chunk-9-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>